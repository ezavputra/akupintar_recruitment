/*! For license information please see ertc.js.LICENSE.txt */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ertc",[],t):"object"==typeof exports?exports.ertc=t():e.ertc=t()}(window,(function(){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,r),a.l=!0,a.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)r.d(n,a,function(t){return e[t]}.bind(null,a));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=31)}([function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.CommonConstants=t.GroupApiConstant=t.ChatSettingsApiConstant=t.ChatReportApiConstant=t.ChatApiConstant=t.ProvisioningApiConstant=t.UserApiConstants=void 0;class n{static getSubUrl(e){return e.ServerDetails.userServer.url+i.Version+i.tenantSubUrl+e.tenantId}static get_UserLoginUrl(e){return n.getSubUrl(e)+n.userSubUrl+"login"}static get_ForgetPasswordUrl(e){return n.getSubUrl(e)+n.userSubUrl+"forgotPassword"}static get_ChangePasswordUrl(e){return n.getSubUrl(e)+n.userSubUrl+e.userId+"/changePassword"}static get_RefreshTokenUrl(e){return n.getSubUrl(e)+n.userSubUrl+e.userId+"/refreshToken"}static get_ChatUserUrl(e){return n.getSubUrl(e)+n.userSubUrl+e.userId+"/getChatUsers"}static get_LogoutUrl(e){return n.getSubUrl(e)+"/users/"+e.userId+"/logout"}static get_UpdateUserUrl(e){return n.getSubUrl(e)+"/users/"+e.userId+"/updateUser"}static get_ImageUrl(e,t){return e.ServerDetails.userServer.url+"v1/"+t}}t.UserApiConstants=n,n.userSubUrl="/users/";t.ProvisioningApiConstant=class{static get_TenantAccountUrl(e){return"https://prov.ripbullertc.com/v1/tenants/get-tenant-details/"+e.tenantUrl}};class a{static getSubUrl(e){return e.ServerDetails.chatServer.url+i.Version+i.tenantSubUrl+e.tenantId}static get_eRTCUser(e){return a.getSubUrl(e)+"/user"}static get_eRTCUpdateUser(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId}static get_eRTCLogoutUser(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId+"/logout"}static get_eRTCUserRefreshToken(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId+"/refreshToken"}static get_eRTCUserBlockUnblock(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId+"/blockUnblock/{action}"}static get_eRTCBlockedUsers(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId+"/blockedUsers"}static get_eRTCChatUserDetails(e){return a.getSubUrl(e)+"/user/"+e.eRTCUserId+"/chatUserDetails"}static get_eRTCUserChat(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat"}static get_eRTCUserChatE2eEncrypted(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/e2eEncrypted"}static get_eRTCUserChatMultiple(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/mutiple"}static get_eRTCCreateThread(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/thread"}static get_eRTCUpdateThread(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/thread/{threadId}"}static get_mediaUrl(e,t){return e.ServerDetails.chatServer.url+"v1/"+t}static get_eRTCChatReaction(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/reaction"}static get_eRTCChatHistory(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/{threadId}/history"}static get_eRTCAllChatHistory(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/history"}static get_eRTCThreadHistory(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/thread/history"}static get_eRTCDeleteChat(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat"}static get_eRTCUpdateChat(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat"}static get_eRTCSearchChat(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/chat/search"}}t.ChatApiConstant=a;class s{static getSubUrl(e){return e.ServerDetails.chatServer.url+i.Version+i.tenantSubUrl+e.tenantId}static ChatReports(e){return s.getSubUrl(e)+"/"+e.eRTCUserId+"/chatReports"}static ChatReportById(e,t){return s.getSubUrl(e)+"/"+e.eRTCUserId+"/chatReports/"+t}static ResolveChatReportById(e,t,r){return s.getSubUrl(e)+"/"+e.eRTCUserId+"/chatReports/"+t+"/allowIgnore/"+r}}t.ChatReportApiConstant=s;class o{static getSubUrl(e){return e.ServerDetails.chatServer.url+i.Version+i.tenantSubUrl+e.tenantId}static getChatSettings(e){return o.getSubUrl(e)+"/"+e.eRTCUserId+"/chatSettings"}}t.ChatSettingsApiConstant=o;t.GroupApiConstant=class{static getSubUrl(e){return e.ServerDetails.chatServer.url+i.Version+i.tenantSubUrl+e.tenantId}static group_createUpdate(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group"}static group_addParticipants(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{groupId}/addParticipants"}static group_removeProfilePic(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{groupId}/removeProfilePic"}static group_removeParticipants(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{groupId}/removeParticipants"}static group_getByGroupId(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{groupId}"}static group_groupByThreadI(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{threadId}/groupByThreadId"}static group_userGroups(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/userGroups"}static group_makeDismissAdmin(e){return a.getSubUrl(e)+"/"+e.eRTCUserId+"/group/{groupId}/makeDismissAdmin/{action}"}};class i{}t.CommonConstants=i,i.JSSDKLocalStorageObjectName="JS-SDK-CONFIG",i.JSSDKUserAccessToken="JS-SDK-USER-ACCESS-TOKEN",i.JSSDKUserServerRefreshToken="JS-SDK-USER-REFRESH-TOKEN",i.JSSDKChatAccessToken="JS-SDK-CHAT-ACCESS-TOKEN",i.JSSDKChatServerRefreshToken="JS-SDK-CHAT-REFRESH-TOKEN",i.JSSDKPackageName="JS-SDK-Package-Name",i.JSSDKTenantUrl="prov.ripbullertc.com",i.LoginType="email",i.Version="V1",i.CHAT_TOPIC="chat:",i.MSG_READ_STATUS_TOPIC="msgReadStatus",i.TYPING_STATUS_TOPIC="typingStatus",i.AVAILABILITY_STATUS_TOPIC="availabilityStatus",i.CHAT_REACTION="chatReaction",i.GROUP_UPDATED="groupUpdated",i.CHAT_UPDATED="chatUpdate",i.USERDB_UPDATED="userDbUpdated",i.USER_SELF_UPDATE="userSelfUpdate",i.tenantSubUrl="/tenants/",i.mqttVersion="m1",i.FarwardSlash="/",i.Colon=":",i.QOS_Exactly_Once=2,i.JSSDKFCMAccessToken="JS-SDK-FCM-ACCESS-TOKEN",i.JSSDKUser="JS-SDK-USER",i.JSSDKChatUser="JS-SDK-CHATUSER",i.JSSDKChatUsers="JS-SDK-CUSERS",i.JSSDKUserGroups="JS-SDK-UGROUPS",i.ANDROID="ANDROID",i.ANDROID_OS=":android",i.ANDROID_QA="AndroidQADevice",i.CLINET_MSG_SENT="clientMsgSent",i.CLINET_MSG_E2E_SENT="clientMsgE2ESent",i.CLINET_REACTION_SENT="clientReactionSent",i.CHAT_ReportUpdated="chatReportUpdated",i.CHAT_SettingUpdated="chatSettingUpdated",i.CLIENT_Announcement="announcement"},function(e,t,r){"use strict";var n=r(17),a=Object.prototype.toString;function s(e){return"[object Array]"===a.call(e)}function o(e){return void 0===e}function i(e){return null!==e&&"object"==typeof e}function u(e){return"[object Function]"===a.call(e)}function c(e,t){if(null!=e)if("object"!=typeof e&&(e=[e]),s(e))for(var r=0,n=e.length;r<n;r++)t.call(null,e[r],r,e);else for(var a in e)Object.prototype.hasOwnProperty.call(e,a)&&t.call(null,e[a],a,e)}e.exports={isArray:s,isArrayBuffer:function(e){return"[object ArrayBuffer]"===a.call(e)},isBuffer:function(e){return null!==e&&!o(e)&&null!==e.constructor&&!o(e.constructor)&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)},isFormData:function(e){return"undefined"!=typeof FormData&&e instanceof FormData},isArrayBufferView:function(e){return"undefined"!=typeof ArrayBuffer&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&e.buffer instanceof ArrayBuffer},isString:function(e){return"string"==typeof e},isNumber:function(e){return"number"==typeof e},isObject:i,isUndefined:o,isDate:function(e){return"[object Date]"===a.call(e)},isFile:function(e){return"[object File]"===a.call(e)},isBlob:function(e){return"[object Blob]"===a.call(e)},isFunction:u,isStream:function(e){return i(e)&&u(e.pipe)},isURLSearchParams:function(e){return"undefined"!=typeof URLSearchParams&&e instanceof URLSearchParams},isStandardBrowserEnv:function(){return("undefined"==typeof navigator||"ReactNative"!==navigator.product&&"NativeScript"!==navigator.product&&"NS"!==navigator.product)&&("undefined"!=typeof window&&"undefined"!=typeof document)},forEach:c,merge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]=r}for(var n=0,a=arguments.length;n<a;n++)c(arguments[n],r);return t},deepMerge:function e(){var t={};function r(r,n){"object"==typeof t[n]&&"object"==typeof r?t[n]=e(t[n],r):t[n]="object"==typeof r?e({},r):r}for(var n=0,a=arguments.length;n<a;n++)c(arguments[n],r);return t},extend:function(e,t,r){return c(t,(function(t,a){e[a]=r&&"function"==typeof t?n(t,r):t})),e},trim:function(e){return e.replace(/^\s*/,"").replace(/\s*$/,"")}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.LocalStorageHelper=void 0;t.LocalStorageHelper=class{static get_Object(e){if(localStorage.getItem(e)){var t=localStorage.getItem(e);return JSON.parse(t)}return null}static set_Object(e,t){var r=JSON.stringify(t);localStorage.setItem(e,r)}static get_ObjectToken(e){var t=localStorage.getItem(e);return JSON.parse(t)}static set_ObjectToken(e,t){var r=JSON.stringify(t);localStorage.setItem(e,r)}static RemoveItem(e){localStorage.removeItem(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.MentionType=t.ChatReactionType=t.ChatType=t.ertcError=t.MessageStatus=t.MessageType=t.ChatEventType=void 0,function(e){e.INCOMING="incoming",e.OUTGOING="outgoing",e.CHAT_META_DATA="chat_meta_data"}(t.ChatEventType||(t.ChatEventType={})),function(e){e.Text="text",e.Contact="contact",e.Location="location",e.Image="image",e.Audio="audio",e.Video="video",e.Sticker="sticker",e.File="file",e.Smile="smile",e.Gify="gify",e.Gif="gif"}(t.MessageType||(t.MessageType={})),function(e){e.NONE="none",e.SENDING="sending",e.UPLOADING="uploading",e.SENT="sent",e.DELIVERED="delivered",e.SEEN="seen",e.FAILED="failed"}(t.MessageStatus||(t.MessageStatus={}));t.ertcError=class{constructor(e,t){this.errorCode=e,this.message=t}},function(e){e.SINGLE="single",e.GROUP="group",e.CHAT_THREAD="chat_thread",e.SINGLE_CHAT_THREAD="single_chat_thread",e.GROUP_CHAT_THREAD="group_chat_thread"}(t.ChatType||(t.ChatType={})),function(e){e.SET="set",e.CLEAR="clear"}(t.ChatReactionType||(t.ChatReactionType={})),function(e){e.CHANNEL="channel",e.HERE="here"}(t.MentionType||(t.MentionType={}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ConfigHelper=void 0;const n=r(0),a=r(2);class s{static get_Config(){return null!=this.sdkConfig||(this.sdkConfig=a.LocalStorageHelper.get_Object(n.CommonConstants.JSSDKLocalStorageObjectName)),this.sdkConfig}static set_Config(e){this.sdkConfig=e,a.LocalStorageHelper.set_Object(n.CommonConstants.JSSDKLocalStorageObjectName,e)}static clear_Config(){this.sdkConfig=null,a.LocalStorageHelper.RemoveItem(n.CommonConstants.JSSDKLocalStorageObjectName)}}t.ConfigHelper=s,s.sdkConfig=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserHelper=void 0;const n=r(2),a=r(0);t.UserHelper=class{static get_CurrentUser(){return n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUser)}static get_CurrentChatUser(){return n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKChatUser)}static clear_CurrentUser(){n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUser)}static clear_CurrentChatUser(){n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatUser)}static set_CurrentUser(e){n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUser,e)}static get_CurrentChatUsers(){let e=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKChatUsers);return null!=e&&null!=e||(e=[]),e}static set_CurrentChatUsers(e){n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKChatUsers,e)}static filter_CurrentChatUsersById(e){return this.get_CurrentChatUsers().filter(t=>t.ertcId===e)}static clear_CurrentChatUsers(){n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatUsers)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Guid=void 0;class n{constructor(e){this.value=this.empty,e&&n.isValid(e)&&(this.value=e)}static newGuid(){return new n("xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,e=>{const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)}))}static get empty(){return"00000000-0000-0000-0000-000000000000"}get empty(){return n.empty}static isValid(e){return/^[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)}toString(){return this.value}toJSON(){return this.value}}t.Guid=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypingModuleFeatures=t.UserModuleFeatures=t.GroupModuleFeatures=t.ChatModuleFeatures=t.TenantFeatures=void 0;const n=r(3),a=r(4);t.TenantFeatures=class{constructor(){this.sdkconfig=null,this.sdkconfig=a.ConfigHelper.get_Config(),null!=this.sdkconfig||console.log("Module is not initialized")}};t.ChatModuleFeatures=class{constructor(){this.sdkconfig=null,this.sdkconfig=a.ConfigHelper.get_Config(),null!=this.sdkconfig||console.log("Module is not initialized")}isSubscriptionAvailable(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.groupChat.enabled}canSendContact(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.contact.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.contact.groupChat.enabled}canSendLocation(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.location.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.location.groupChat.enabled}canSendImage(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.image.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.image.groupChat.enabled}canSendAudio(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.audio.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.audio.groupChat.enabled}canSendVideo(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.video.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.video.groupChat.enabled}canSendDocument(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.document.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.document.groupChat.enabled}canSendGIF(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.chatAttachment.gify.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.chatAttachment.gify.groupChat.enabled}canSendAlerts(){return this.sdkconfig.TenantInfoResult.config.features.readReceipt.readAlert.enabled}canBlockUsers(){return this.sdkconfig.TenantInfoResult.config.features.blockUser.enabled}canUseStarredMessaging(){return this.sdkconfig.TenantInfoResult.config.features.starredChat.enabled}canReplyThread(){return this.sdkconfig.TenantInfoResult.config.features.replyThread.enabled}canUsermention(){return this.sdkconfig.TenantInfoResult.config.features.userMentions.enabled}canUserMentionForChat(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.userMentions.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.userMentions.groupChat.enabled}canForwardChat(){return this.sdkconfig.TenantInfoResult.config.features.forwardChat.enabled}canForwardTextChat(e){return e==n.ChatType.SINGLE||e==n.ChatType.SINGLE_CHAT_THREAD?this.sdkconfig.TenantInfoResult.config.features.forwardChat.text.chat.enabled:this.sdkconfig.TenantInfoResult.config.features.forwardChat.text.groupChat.enabled}canSendReaction(){return this.sdkconfig.TenantInfoResult.config.features.chatReactions.enabled}canDeleteChat(){return this.sdkconfig.TenantInfoResult.config.features.deleteChat.enabled}canDeleteChatForSelf(){return this.sdkconfig.TenantInfoResult.config.features.deleteChat.deleteForSelf.enabled}canDeleteChatForEveryone(){return this.sdkconfig.TenantInfoResult.config.features.deleteChat.deleteForEveryone.enabled}canSearch(){return!0}};t.GroupModuleFeatures=class{constructor(){this.sdkconfig=null,this.sdkconfig=a.ConfigHelper.get_Config(),null!=this.sdkconfig||console.log("Module is not initialized")}isSubscriptionAvailable(){return this.sdkconfig.TenantInfoResult.config.features.groupChat.enabled}};t.UserModuleFeatures=class{constructor(){this.sdkconfig=null,this.sdkconfig=a.ConfigHelper.get_Config(),null!=this.sdkconfig||console.log("Module is not initialized")}isSubscriptionAvailable(){return this.sdkconfig.TenantInfoResult.config.features.userProfile.enabled}canUpdateProfile(){return this.sdkconfig.TenantInfoResult.config.features.userProfile.enabled&&this.sdkconfig.TenantInfoResult.config.features.userProfile.image.enabled}canBlockUser(){return this.sdkconfig.TenantInfoResult.config.features.blockUser.enabled}canGetAvailabilityStatus(){return this.sdkconfig.TenantInfoResult.config.features.userProfile.availabilityStatus.enabled}};t.TypingModuleFeatures=class{constructor(){this.sdkconfig=null,this.sdkconfig=a.ConfigHelper.get_Config(),null!=this.sdkconfig||console.log("Module is not initialized")}isSubscriptionAvailable(){return this.sdkconfig.TenantInfoResult.config.features.typingStatus.enabled}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BaseApiService=void 0;const n=r(34),a=r(26),s=r(0),o=r(2),i=r(6),u=r(3),c=r(9);class l{static getRequest(e,t){let r=n.default.create();return l.createAxiosResponseInterceptor(t,r),r.get(e,l.addHeaders(t,l.selectAuthCode(t,e),e))}static postRequest(e,t,r){let a=n.default.create();l.createAxiosResponseInterceptor(r,a);let s=l.addHeaders(r,l.selectAuthCode(r,e),e);return s.headers["Content-Type"]="application/json",a.post(e,t,s)}static postRequestToExternalApi(e,t){return n.default.create().post(e,t,{headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"*"}})}static deleteRequest(e,t,r){let a=n.default.create();l.createAxiosResponseInterceptor(r,a);let s=l.addHeaders(r,l.selectAuthCode(r,e),e);return null!=t&&(s.data=t),s.headers["Content-Type"]="application/json",a.delete(e,s)}static putRequest(e,t,r){let a=n.default.create();l.createAxiosResponseInterceptor(r,a);let s=l.addHeaders(r,l.selectAuthCode(r,e),e);return null!=t&&(s.data=t),s.headers["Content-Type"]="application/json",a.put(e,t,s)}static postFormDataRequest(e,t,r){let a=n.default.create();l.createAxiosResponseInterceptor(r,a);let s=l.addHeaders(r,l.selectAuthCode(r,e),e);return s.headers["Content-Type"]="multipart/form-data",a.post(e,t,s)}static addHeaders(e,t,r){let n=Math.round((new Date).getTime()),u="";r.includes(s.CommonConstants.JSSDKTenantUrl)?u=e.accessCode:r.includes(e.ServerDetails.userServer.url)?u=e.ServerDetails.userServer.apiKey:r.includes(e.ServerDetails.chatServer.url)&&(u=e.ServerDetails.chatServer.apiKey);let c=o.LocalStorageHelper.get_Object(s.CommonConstants.JSSDKPackageName);if(null!=c&&""!=c&&null!=c){var l={headers:{"Content-Type":"application/json","X-Request-Signature":a.HeaderUtils.getHeaderSignature(u,c,n),"X-nonce":n,deviceid:e.deviceId,"X-Request-ID":i.Guid.newGuid(),"Access-Control-Allow-Origin":"*"}};return null!=t&&""!=t&&(l.headers.Authorization="Bearer "+t),l}console.log("Package name is required.")}static createAxiosResponseInterceptor(e,t){t.interceptors.response.use(e=>e,t=>{if(t.config&&t.response&&401===t.response.status){let r=null;if(t.config.url.includes(e.ServerDetails.userServer.url))return r=o.LocalStorageHelper.get_ObjectToken(s.CommonConstants.JSSDKUserServerRefreshToken),n.default.get(s.UserApiConstants.get_RefreshTokenUrl(e),l.addHeaders(e,r,s.UserApiConstants.get_RefreshTokenUrl(e))).then(e=>(t.config.headers.Authorization="Bearer "+e.data.result.accessToken,o.LocalStorageHelper.set_ObjectToken(s.CommonConstants.JSSDKUserAccessToken,e.data.result.accessToken),o.LocalStorageHelper.set_ObjectToken(s.CommonConstants.JSSDKUserServerRefreshToken,e.data.result.refreshToken),n.default.request(t.config))).catch(e=>{if(console.log(e),e.config&&e.response&&403===e.response.status){let t=e.response.data.msg;return c.EventManager.publish("ForceLogout",t),Promise.reject(new u.ertcError(e.response.status,t))}});if(t.config.url.includes(e.ServerDetails.chatServer.url))return r=o.LocalStorageHelper.get_ObjectToken(s.CommonConstants.JSSDKChatServerRefreshToken),s.UserApiConstants.get_RefreshTokenUrl(e),n.default.get(s.ChatApiConstant.get_eRTCUserRefreshToken(e),l.addHeaders(e,r,s.ChatApiConstant.get_eRTCUserRefreshToken(e))).then(e=>(t.config.headers.Authorization="Bearer "+e.data.result.accessToken,o.LocalStorageHelper.set_ObjectToken(s.CommonConstants.JSSDKChatAccessToken,e.data.result.accessToken),o.LocalStorageHelper.set_ObjectToken(s.CommonConstants.JSSDKChatServerRefreshToken,e.data.result.refreshToken),n.default.request(t.config))).catch(e=>{if(console.log(e),e.config&&e.response&&403===e.response.status){let t=e.response.data.msg;return c.EventManager.publish("ForceLogout",t),Promise.reject(new u.ertcError(e.response.status,t))}});console.log(t.config)}else if(t.config&&t.response&&403===t.response.status){let e=t.response.data.msg;return c.EventManager.publish("ForceLogout",e),Promise.reject(new u.ertcError(t.response.status,e))}return Promise.reject(t)})}static selectAuthCode(e,t){let r="";return t.includes(s.CommonConstants.JSSDKTenantUrl)?r="":t.includes(e.ServerDetails.userServer.url)?r=o.LocalStorageHelper.get_ObjectToken(s.CommonConstants.JSSDKUserAccessToken):t.includes(e.ServerDetails.chatServer.url)&&(r=o.LocalStorageHelper.get_ObjectToken(s.CommonConstants.JSSDKChatAccessToken)),r}}t.BaseApiService=l},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.EventManager=void 0,t.EventManager=new function(){var e={};this.publish=function(t,r){var n=e[t];!1!=!!n&&n.forEach((function(e){e.call(this,r)}))},this.subscribe=function(t,r){var n=e[t];!1==!!n&&(n=e[t]=[]),n.push(r)},this.unsubscribe=function(t,r){var n=e[t];if(!1!=!!n){var a=n.indexOf(r);n.splice(a)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatSettingsApiService=t.ChatReportApiService=t.ChatApiService=void 0;const n=r(0),a=r(8);t.ChatApiService=class{constructor(e){this.sdkconfig=null,this.sdkconfig=e}GeteRTCUser(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCUser(this.sdkconfig),e,this.sdkconfig)}UpdateERTCUser(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCUpdateUser(this.sdkconfig),e,this.sdkconfig)}BlockUnblockERTCUser(e,t){let r=n.ChatApiConstant.get_eRTCUserBlockUnblock(this.sdkconfig).replace("{action}",t);return a.BaseApiService.postRequest(r,e,this.sdkconfig)}CreateThread(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCCreateThread(this.sdkconfig),e,this.sdkconfig)}GetThreadById(e){let t=n.ChatApiConstant.get_eRTCUpdateThread(this.sdkconfig).replace("{threadId}",e);return a.BaseApiService.getRequest(t,this.sdkconfig)}GetThread(e,t){let r=n.ChatApiConstant.get_eRTCUpdateThread(this.sdkconfig).replace("{threadId}",t);return a.BaseApiService.postRequest(r,e,this.sdkconfig)}CreateChat(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCUserChat(this.sdkconfig),e,this.sdkconfig)}CreateMutipleChat(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCUserChatMultiple(this.sdkconfig),e,this.sdkconfig)}CreateChatWithMedia(e){return a.BaseApiService.postFormDataRequest(n.ChatApiConstant.get_eRTCUserChat(this.sdkconfig),e,this.sdkconfig)}GetOtherChatUserDetails(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCChatUserDetails(this.sdkconfig),e,this.sdkconfig)}ChatReaction(e){return a.BaseApiService.postRequest(n.ChatApiConstant.get_eRTCChatReaction(this.sdkconfig),e,this.sdkconfig)}DeleteChat(e){return a.BaseApiService.deleteRequest(n.ChatApiConstant.get_eRTCDeleteChat(this.sdkconfig),e,this.sdkconfig)}GetChatHistory(e){let t=n.ChatApiConstant.get_eRTCChatHistory(this.sdkconfig);return t=""==e.threadId?n.ChatApiConstant.get_eRTCAllChatHistory(this.sdkconfig):t.replace("{threadId}",e.threadId),e.fetchAll||(null!=e.currentMsgId&&""!=e.currentMsgId&&null!=e.currentMsgId?(t=t+"?pageSize="+e.pagesize+"&currentMsgId="+e.currentMsgId+"&direction="+e.direction,e.includeCurrent?t+="&includeCurrentMsg=true":t+="&includeCurrentMsg=false"):t=t+"?pageSize="+e.pagesize+"&direction="+e.direction),null!=e.replyChatId&&""!=e.replyChatId&&null!=e.replyChatId&&(t=t+"&baseMsgUniqueId="+e.replyChatId),e.follow&&(t+="&follow=true"),null!=e.messageTypes&&e.messageTypes.length>0&&(t=t+"&msgType="+JSON.stringify(e.messageTypes)),null!=e.deep&&e.deep&&(t+="&deep=true"),null!=e.starred&&e.starred&&(t+="&starred=true"),null!=e.includeDeleted&&e.includeDeleted&&(t+="&includeDeleted=true"),a.BaseApiService.getRequest(t,this.sdkconfig)}GetThreadHistory(e,t,r,s){let o=n.ChatApiConstant.get_eRTCThreadHistory(this.sdkconfig);return s||(o=null!=e&&""!=e&&null!=e?o+"?skip="+t+"&limit="+r+"&threadType="+e:o+"?skip="+t+"&limit="+r),a.BaseApiService.getRequest(o,this.sdkconfig)}GetChatSearchHistory(e,t,r){let s=n.ChatApiConstant.get_eRTCSearchChat(this.sdkconfig);return s=s+"?skip="+t+"&limit="+r,a.BaseApiService.postRequest(s,e,this.sdkconfig)}UpdateChat(e){return a.BaseApiService.putRequest(n.ChatApiConstant.get_eRTCUpdateChat(this.sdkconfig),e,this.sdkconfig)}CreateMessageOnBroker(e,t){return a.BaseApiService.postRequestToExternalApi(e,t)}};t.ChatReportApiService=class{constructor(e){this.sdkconfig=null,this.sdkconfig=e}CreateChatReport(e){return a.BaseApiService.postRequest(n.ChatReportApiConstant.ChatReports(this.sdkconfig),e,this.sdkconfig)}UpdateChatReport(e,t){return a.BaseApiService.putRequest(n.ChatReportApiConstant.ChatReportById(this.sdkconfig,t),e,this.sdkconfig)}ResolveChatReport(e,t){return a.BaseApiService.putRequest(n.ChatReportApiConstant.ResolveChatReportById(this.sdkconfig,e,t),null,this.sdkconfig)}DeleteChatReport(e){return a.BaseApiService.deleteRequest(n.ChatReportApiConstant.ChatReportById(this.sdkconfig,e),null,this.sdkconfig)}GetChatReportById(e){return a.BaseApiService.getRequest(n.ChatReportApiConstant.ChatReportById(this.sdkconfig,e),this.sdkconfig)}ChatReportList(e,t,r,s,o,i){let u=n.ChatReportApiConstant.ChatReports(this.sdkconfig);return""==o&&(o="0"),""==i&&(i="20"),u=u+"?skip="+o+"&limit="+i,""!=e&&(u=u+"&threadId="+e),""!=t&&(u=u+"&category="+t),""!=r&&(u=u+"&status="+r),""!=s&&(u=u+"&msgType="+s),a.BaseApiService.getRequest(u,this.sdkconfig)}};t.ChatSettingsApiService=class{constructor(e){this.sdkconfig=null,this.sdkconfig=e}GetChatSettings(){return a.BaseApiService.getRequest(n.ChatSettingsApiConstant.getChatSettings(this.sdkconfig),this.sdkconfig)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.AttachmentConstants=t.TenantConstants=t.ModuleConstants=void 0;class n{}t.ModuleConstants=n,n.CHAT="Chat",n.SEND_TEXT="Send text",n.SEND="Send ",n.SEND_LOCATION="Location Sharing",n.SEND_CONTACT="Send contact",n.SEND_DOCUMENT="Send document",n.SEND_GIF="Send gif",n.ADD_TO_FAVOURITE="Add to favourite",n.READ_RECEIPT="Read receipt",n.BLOCK_USER="Block user",n.DOWNLOAD_MEDIA="Download media",n.CHAT_REACTION="Chat reaction",n.REPLY_THREAD="Reply thread",n.USER_MENTIONS="User mentions",n.FORWARD_CHAT="Forward chat",n.DELETE_CHAT="Delete chat",n.SEARCH_CHAT="Search chat",n.UPDATE_CHAT="Update chat",n.GROUP="Group",n.CREATE_GROUP="Create group",n.UPDATE_GROUP="Update group",n.ADD_PARTICIPANTS="Add participants to group",n.REMOVE_PARTICIPANTS="Remove participants from group",n.SET_ADMIN="Set as admin",n.REMOVE_ADMIN="Remove as admin",n.EXIT_GROUP="Exit from group",n.NAMESPACE="Namespace",n.LOGIN="Login",n.CHANGE_PASSWORD="Change password",n.FORGOT_PASSWORD="Forgot password",n.TYPING="Typing",n.USER_MODULE="User module",n.USER_PROFILE="User profile",n.AVAILABILITY_STATUS="User availability status",n.LOGOUT="Logout",n.GENERIC_MESSAGE="{PLACEHOLDER} is not available now. Please contact your administrator.";class a{}t.TenantConstants=a,a.CHAT_ENABLED="chat_enabled",a.GROUP_ENABLED="group_enabled",a.TYPING_STATUS="TYPING_STATUS",a.READ_RECEIPTS="READ_RECEIPTS",a.USER_PROFILE="user_profile",a.BLOCK_USER="block_user",a.STAR_MESSAGE="star_message",a.E2E_CHAT="e2e_chat",a.NOTIFICATION="NOTIFICATION",a.SEARCH_FILTER="SEARCH_FILTER",a.ATTACHMENT="ATTACHMENT";class s{}t.AttachmentConstants=s,s.TEXT="TEXT",s.LOCATION="LOCATION",s.CONTACT="CONTACT",s.GIFY="GIFY",s.IMAGE="IMAGE",s.AUDIO="AUDIO",s.VIDEO="VIDEO",s.DOCUMENT="DOCUMENT"},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.setCallBackMethod=t.PublishRelicEvent=t.TypingStatusOn=t.MessageSeen=t.MessageDelivered=t.getMqttClient=t.unsubscribe=t.Initialize=t.onSuccess=t.mqttClient=void 0;const n=r(26),a=r(0),s=r(2),o=r(6);function i(e){t.onSuccess(e)}t.mqttClient=null,t.Initialize=function(e,r,o,u,c,l){try{let u=Math.round((new Date).getTime()),c=s.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKPackageName);if(null==c||""==c||null==c)return void console.log("Package name is required.");var d=n.HeaderUtils.getHeaderSignature(l.ServerDetails.mqttServer.apiKey,c,u);let p=s.LocalStorageHelper.get_ObjectToken(a.CommonConstants.JSSDKChatAccessToken),f=e,g=d+a.CommonConstants.Colon+u+a.CommonConstants.Colon+p,m=r+a.CommonConstants.Colon+l.deviceId+a.CommonConstants.Colon+l.deviceType;t.mqttClient=new Paho.Client(o,m),t.mqttClient.onMessageArrived=i;var h={timeout:90,keepAliveInterval:200,cleanSession:!1,useSSL:!1,reconnect:!0,onSuccess:function(e){t.mqttClient.subscribe(a.CommonConstants.CHAT_TOPIC+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.MSG_READ_STATUS_TOPIC+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.TYPING_STATUS_TOPIC+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.AVAILABILITY_STATUS_TOPIC+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.CHAT_REACTION+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.GROUP_UPDATED+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.CHAT_UPDATED+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.USERDB_UPDATED+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.USER_SELF_UPDATE+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.CLIENT_Announcement+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.CHAT_ReportUpdated+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once}),t.mqttClient.subscribe(a.CommonConstants.CHAT_SettingUpdated+a.CommonConstants.Colon+m,{qos:a.CommonConstants.QOS_Exactly_Once})},onFailure:function(e){console.log(e)},userName:f,password:g};t.mqttClient.connect(h)}catch(e){console.log(e)}},t.unsubscribe=function(e){try{null!=t.mqttClient&&(t.mqttClient.disconnect(),t.mqttClient=null)}catch(e){console.log(e)}},t.getMqttClient=function(){return t.mqttClient},t.MessageDelivered=function(e){try{null!=t.mqttClient&&t.mqttClient.publish("msgReadStatus",JSON.stringify(e))}catch(e){console.log(e)}},t.MessageSeen=function(e){try{null!=t.mqttClient&&t.mqttClient.publish("msgReadStatus",JSON.stringify(e))}catch(e){console.log(e)}},t.TypingStatusOn=function(e){try{null!=t.mqttClient&&t.mqttClient.publish("typingStatus",JSON.stringify(e))}catch(e){console.log(e)}},t.PublishRelicEvent=function(e,r){try{if(null!=t.mqttClient){o.Guid.newGuid().toString();Math.round((new Date).getTime());t.mqttClient.publish("typingStatus",JSON.stringify(e))}}catch(e){console.log(e)}},t.setCallBackMethod=function(e){t.onSuccess=e}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.db=void 0;const n=r(55);class a extends n.default{constructor(){super("JSSDKDatabase"),this.version(6).stores({allMessages:"id, threadId, timestamp, isFavoriteMessage, message,[threadId+message]",threadHistory:"threadId"}),this.allMessages=this.table("allMessages"),this.threadHistory=this.table("threadHistory")}}t.db=new a},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModuleImp=void 0;const n=r(10),a=r(0),s=r(11),o=r(3),i=r(4),u=r(13),c=r(7),l=r(6),d=r(2),h=r(56),p=r(15),f=r(5),g=r(27),m=r(12),C=r(9),v=r(29);t.ChatModuleImp=class{constructor(){this.sdkconfig=null,this.chatApiService=null,this.chatModuleFeatures=null,this.sdkconfig=i.ConfigHelper.get_Config(),null!=this.sdkconfig?(this.chatApiService=new n.ChatApiService(this.sdkconfig),this.chatModuleFeatures=new c.ChatModuleFeatures):console.log("Module is not initialized")}createThread(e){return new Promise((t,r)=>{this.chatModuleFeatures.isSubscriptionAvailable(o.ChatType.SINGLE)||r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.CHAT)));try{this.sdkconfig=i.ConfigHelper.get_Config();let n={sendereRTCUserId:this.sdkconfig.eRTCUserId,recipientAppUserId:e};this.chatApiService.CreateThread(n).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result;t(r.threadId)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}getThread(e){return new Promise((t,r)=>{try{this.chatApiService.GetThreadById(e).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,n=h.ThreadHelper.Transform_ThreadResultAPI_Result_To_ThreadSDKResult(r);t(n)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}sendMessage(e,t){return new Promise((r,n)=>{if(null!=t)switch(t.type){case o.MessageType.Text:return this.sendTextMessage(e,t,r,n);case o.MessageType.Image:return this.sendMedia(e,t,"image",r,n);case o.MessageType.Video:return this.sendMedia(e,t,"video",r,n);case o.MessageType.Audio:return this.sendMedia(e,t,"audio",r,n);case o.MessageType.File:return this.sendDocument(e,t,"file",r,n);case o.MessageType.Gify:case o.MessageType.Gif:return this.sendGIPHY(e,t,r,n);case o.MessageType.Contact:return this.sendContact(e,t,r,n);case o.MessageType.Location:return this.sendLocation(e,t,r,n);default:n(new o.ertcError("111","Message type not supported."))}})}sendReaction(e,t){var r=l.Guid.newGuid().toString();return new Promise((n,a)=>{if(!this.chatModuleFeatures.canSendReaction())return void a(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.CHAT_REACTION)));let i={msgUniqueId:t.msgId,action:t.chatReactionType,emojiCode:t.emojiCode,msgCorrelationId:r};this.chatApiService.ChatReaction(i).then(r=>{if(200==r.status&&r.data.success){let a=r.data.result,s={threadId:e,msgUniqueId:a.msgUniqueId,emojiCode:a.emojiCode,chatReactionType:t.chatReactionType};n(s)}else a(new o.ertcError(r.data.errorCode,r.data.msg))}).catch(e=>{a(e)})})}deleteChat(e){return new Promise((t,r)=>{if(!this.chatModuleFeatures.canDeleteChat())return void r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.DELETE_CHAT)));if("self"==e.deleteType&&!this.chatModuleFeatures.canDeleteChatForSelf())return void r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.DELETE_CHAT)));if("everyone"==e.deleteType&&!this.chatModuleFeatures.canDeleteChatForEveryone())return void r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.DELETE_CHAT)));let n=[];for(let t=0;t<e.msgIds.length;t++){const r=e.msgIds[t];n.push({msgUniqueId:r})}let a={deleteType:e.deleteType,msgCorrelationId:e.msgCorrelationId,threadId:e.threadId,chats:n};this.chatApiService.DeleteChat(a).then(n=>{if(200==n.status&&n.data.success){t(!0);for(let t=0;t<e.msgIds.length;t++){const r=e.msgIds[t];u.db.allMessages.delete(r).catch(e=>{})}}else r(new o.ertcError(n.data.errorCode,n.data.msg))}).catch(e=>{r(e)})})}sendTextMessage(e,t,r,n){this.chatModuleFeatures.isSubscriptionAvailable(t.chatType)||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_TEXT)));let a={threadId:e,sendereRTCUserId:f.UserHelper.get_CurrentChatUser().ertcId,msgType:"text",message:t.message,senderTimeStampMs:Math.round((new Date).getTime())};this.addReplyThread(t,a,r,n),this.addMentionRecord(t,a,r,n),this.addForwardMessage(t,a,r,n),this.executeRequest(a,t,r,n)}executeRequest(e,t,r,n){this.chatApiService.CreateChat(e).then(e=>{if(200==e.status&&e.data.success){let n=e.data.result,a=p.TransformHelper.CreateChatResult_To_MessageRecord(n,o.MessageStatus.SENT,t);u.db.allMessages.get(a.id,(function(e){null==e?u.db.allMessages.add(a,a.id).catch(e=>{}):u.db.allMessages.put(a,a.id).catch(e=>{})})),r(a)}else n(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})}addReplyThread(e,t,r,n){if(null!=e.parentMsgId&&""!=e.parentMsgId){if(!this.chatModuleFeatures.canReplyThread())return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.REPLY_THREAD)));let r={baseMsgUniqueId:e.parentMsgId,replyMsgConfig:e.sendToChannel};t.replyThreadFeatureData=r}}addMentionRecord(e,t,r,n){if(null!=e.mentioned_users&&e.mentioned_users.length>0){if(!this.chatModuleFeatures.canUsermention())return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.USER_MENTIONS)));if(!this.chatModuleFeatures.canUserMentionForChat(e.chatType))return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.USER_MENTIONS)));let r=[];for(let t=0;t<e.mentioned_users.length;t++){let n={type:"user",value:e.mentioned_users[t]};r.push(n)}t.mentions=r}}addForwardMessage(e,t,r,n){if(e.isForwarded&&""!=e.forwardedMsgId&&null!=e.forwardedMsgId){let r={originalMsgUniqueId:e.forwardedMsgId,isForwarded:e.isForwarded};t.forwardChatFeatureData=r}}executeRequestWithFormData(e,t,r,n){this.chatApiService.CreateChatWithMedia(e).then(e=>{if(200==e.status&&e.data.success){let n=e.data.result,a=p.TransformHelper.CreateChatResult_To_MessageRecord(n,o.MessageStatus.SENT,t);u.db.allMessages.get(a.id,(function(e){null==e?u.db.allMessages.add(a,a.id).catch(e=>{}):u.db.allMessages.put(a,a.id).catch(e=>{})})),r(a)}else n(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})}addReplyThreadWithFormData(e,t,r,n){if(null!=e.parentMsgId&&""!=e.parentMsgId){if(!this.chatModuleFeatures.canReplyThread())return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.REPLY_THREAD)));let r={baseMsgUniqueId:e.parentMsgId,replyMsgConfig:e.sendToChannel};t.append("replyThreadFeatureData",JSON.stringify(r))}}addMentionRecordWithFormData(e,t,r,n){if(null!=e.mentioned_users&&e.mentioned_users.length>0){if(!this.chatModuleFeatures.canUsermention())return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.USER_MENTIONS)));if(!this.chatModuleFeatures.canUserMentionForChat(e.chatType))return void n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.USER_MENTIONS)));let r=[];for(let t=0;t<e.mentioned_users.length;t++){const n=e.mentioned_users[t];let a={type:e.mentions,value:n};r.push(a)}t.append("mentions",JSON.stringify(r))}}addForwardMessageWithFormData(e,t,r,n){if(e.isForwarded&&""!=e.forwardedMsgId&&null!=e.forwardedMsgId){let r={originalMsgUniqueId:e.forwardedMsgId,isForwarded:e.isForwarded};if(t.append("forwardChatFeatureData",JSON.stringify(r)),null!=e.forwardedMedia&&null!=e.forwardedMedia){let r=i.ConfigHelper.get_Config();e.forwardedMedia.path=e.forwardedMedia.path.replace(r.ServerDetails.chatServer.url+"v1/",""),e.forwardedMedia.thumbnail=e.forwardedMedia.thumbnail.replace(r.ServerDetails.chatServer.url+"v1/","");let n={name:e.forwardedMedia.name,path:e.forwardedMedia.path};null!=e.forwardedMedia.thumbnail&&""!=e.forwardedMedia.thumbnail&&(n=e.forwardedMedia),t.delete("media"),t.append("media",JSON.stringify(n))}}}sendMedia(e,t,r,n,a){let s=f.UserHelper.get_CurrentChatUser(),o=new FormData;o.append("sendereRTCUserId",s.ertcId),o.append("threadId",e),o.append("media",t.media),o.append("msgType",r),o.append("senderTimeStampMs",Math.round((new Date).getTime()).toString()),this.addReplyThreadWithFormData(t,o,n,a),this.addMentionRecordWithFormData(t,o,n,a),this.addForwardMessageWithFormData(t,o,n,a),this.executeRequestWithFormData(o,t,n,a)}sendDocument(e,t,r,n,a){this.chatModuleFeatures.canSendDocument(t.chatType)||a(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_DOCUMENT)));let i=f.UserHelper.get_CurrentChatUser(),u=new FormData;u.append("sendereRTCUserId",i.ertcId),u.append("threadId",e),u.append("media",t.media),u.append("msgType",r),u.append("senderTimeStampMs",Math.round((new Date).getTime()).toString()),this.addReplyThreadWithFormData(t,u,n,a),this.addMentionRecordWithFormData(t,u,n,a),this.addForwardMessageWithFormData(t,u,n,a),this.executeRequestWithFormData(u,t,n,a)}sendGIPHY(e,t,r,n){this.chatModuleFeatures.canSendGIF(t.chatType)||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_GIF)));let a={threadId:e,sendereRTCUserId:f.UserHelper.get_CurrentChatUser().ertcId,msgType:"gify",gify:t.gifPath,senderTimeStampMs:Math.round((new Date).getTime())};this.addReplyThread(t,a,r,n),this.addMentionRecord(t,a,r,n),this.addForwardMessage(t,a,r,n),this.executeRequest(a,t,r,n)}sendContact(e,t,r,n){this.chatModuleFeatures.canSendContact(t.chatType)||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_CONTACT)));let a={name:t.contact.contactName,emails:t.contact.eMailRecords,numbers:t.contact.phoneNumberRecord},i={threadId:e,sendereRTCUserId:f.UserHelper.get_CurrentChatUser().ertcId,msgType:"contact",contact:a,senderTimeStampMs:Math.round((new Date).getTime())};this.addReplyThread(t,i,r,n),this.addMentionRecord(t,i,r,n),this.addForwardMessage(t,i,r,n),this.executeRequest(i,t,r,n)}sendLocation(e,t,r,n){this.chatModuleFeatures.canSendLocation(t.chatType)||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_LOCATION)));var a={address:t.location.address,latitude:t.location.latitude,longitude:t.location.longitude};let i={threadId:e,sendereRTCUserId:f.UserHelper.get_CurrentChatUser().ertcId,msgType:"location",location:a,senderTimeStampMs:Math.round((new Date).getTime())};this.addReplyThread(t,i,r,n),this.addMentionRecord(t,i,r,n),this.addForwardMessage(t,i,r,n),this.executeRequest(i,t,r,n)}sendMultipleMessages(e){return new Promise((t,r)=>{this.chatModuleFeatures.isSubscriptionAvailable(o.ChatType.SINGLE)||r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEND_TEXT)));let n=f.UserHelper.get_CurrentChatUser(),a=[];for(let t=0;t<e.length;t++){const r=e[t];var i={threadId:r.threadId,sendereRTCUserId:n.ertcId,msgType:r.msgType,senderTimeStampMs:Math.round((new Date).getTime())};if("text"===r.msgType)i.message=r.message;else if("gify"===r.msgType)i.gify=r.gifPath;else if("contact"===r.msgType){var u={name:r.contactName,emails:r.emailContactRecord,numbers:r.phoneContactRecord};i.contact=u}else"location"===r.msgType&&(i.location=r.locationRecord);a.push(i)}a.length>0&&this.chatApiService.CreateMutipleChat(a).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,n=[];for(let e=0;e<r.length;e++){const t=r[e];n.push(p.TransformHelper.CreateChatResult_To_MessageRecord(t.result,o.MessageStatus.SENT,null))}t(n)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})})}blockUnblockUser(e,t){return new Promise((r,n)=>{this.chatModuleFeatures.canBlockUsers()||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.BLOCK_USER)));let a={appUserId:t};this.chatApiService.BlockUnblockERTCUser(a,e).then(e=>{200==e.status&&e.data.success?(f.UserHelper.clear_CurrentChatUsers(),r(e.data.result.message)):n(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})})}LoginIntoChatServer(e){return new Promise((t,r)=>{this.sdkconfig=i.ConfigHelper.get_Config();var n=d.LocalStorageHelper.get_ObjectToken(a.CommonConstants.JSSDKFCMAccessToken);let s={appUserId:e,deviceId:this.sdkconfig.deviceId,deviceType:this.sdkconfig.deviceType};s.fcmToken=null!=n&&""!=n?n:"5399ae9500202296ccb39e6893cb93e29f0e4afa0525aa370ca4b177dba780a5",d.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatAccessToken),d.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatServerRefreshToken),this.chatApiService.GeteRTCUser(s).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result;this.sdkconfig.eRTCUserId=r.eRTCUserId,d.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKChatAccessToken,r.token.accessToken),d.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKChatServerRefreshToken,r.token.refreshToken),i.ConfigHelper.set_Config(this.sdkconfig),m.Initialize(this.sdkconfig.tenantId,r.eRTCUserId,this.sdkconfig.ServerDetails.mqttServer.url,this.sdkconfig.username,this.sdkconfig.deviceId,this.sdkconfig);var n={ertcId:r.eRTCUserId,UserChatId:r.appUserId,name:r.name,tenantId:r.tenantId};d.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKChatUser,n),t(n)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})})}InitializeQueue(){return new Promise((e,t)=>{try{null==m.getMqttClient()&&(this.sdkconfig=i.ConfigHelper.get_Config(),""!=this.sdkconfig.eRTCUserId&&m.Initialize(this.sdkconfig.tenantId,this.sdkconfig.eRTCUserId,this.sdkconfig.ServerDetails.mqttServer.url,this.sdkconfig.username,this.sdkconfig.deviceId,this.sdkconfig))}catch(e){t(e)}})}msgReadStatus(e,t){try{if((new c.ChatModuleFeatures).canSendAlerts()&&null!=m.getMqttClient()){let r=i.ConfigHelper.get_Config(),n=f.UserHelper.get_CurrentChatUser(),a=Math.round((new Date).getTime());const s={tenantId:e.tenantId,sendereRTCUserId:e.senderRecord.ertcId,msgUniqueId:e.id,threadId:e.threadId,eRTCUserId:n.ertcId,msgStatusEvent:t.toString(),timeStamp:a,deviceId:r.deviceId};if(null!=e.chatThreadMetadata){let t={baseMsgUniqueId:e.chatThreadMetadata.parentMsgId,replyMsgConfig:e.chatThreadMetadata.sendToChannel};s.replyThreadFeatureData=t}m.MessageDelivered(s),u.db.allMessages.update(e.id,{status:t.toString()})}}catch(e){console.log(e)}}getMessageFromLocalStorage(e){return new Promise((t,r)=>{u.db.allMessages.get(e,(function(e){null==e?r(null):t(e)}))})}getMessages(e){return new Promise((t,r)=>{try{u.db.allMessages.where("threadId").equals(e).toArray().then(e=>{let r=[];for(let t=0;t<e.length;t++){const n=e[t];if(null==n.chatThreadMetadata){let t=e.filter(e=>null!=e.chatThreadMetadata&&null!=e.chatThreadMetadata.parentMsgId&&e.chatThreadMetadata.parentMsgId==n.id);null!=t&&t.length>0&&(n.chatThreadMetadata={chatThreadCount:t.length})}if(null!=n.chatThreadMetadata){let t=e.filter(e=>null!=e.chatThreadMetadata&&null!=e.chatThreadMetadata.parentMsgId&&e.id==e.chatThreadMetadata.parentMsgId);if(null!=t&&t.length>0){let e="";switch(t[0].msgType){case o.MessageType.Audio:case o.MessageType.File:case o.MessageType.Video:e=t[0].mediaName;break;case o.MessageType.Gify:e="Gify";break;case o.MessageType.Text:e=t[0].message;break;case o.MessageType.Location:e="Location";break;case o.MessageType.Contact:e="Contact"}n.chatThreadMetadata.parentMsg=e}}r.push(n)}t(r)}).catch(e=>{r(e)})}catch(e){r(e)}})}markAsFavorite(e,t){return new Promise((r,n)=>{this.chatModuleFeatures.canUseStarredMessaging()||n(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.ADD_TO_FAVOURITE)));try{for(let r=0;r<e.length;r++){const n=e[r];u.db.allMessages.get(n.id,(function(e){null==e?(n.isFavoriteMessage=t,u.db.allMessages.add(n,n.id).catch(e=>{})):(n.isFavoriteMessage=t,u.db.allMessages.put(n,n.id).catch(e=>{}))}))}}catch(e){n(e)}})}getAllFavoriteMessages(e){return this.FollowThreads(e)}getAllFavoriteMessagesByThreadId(e){return new Promise((t,r)=>{this.chatModuleFeatures.canUseStarredMessaging()||r(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.ADD_TO_FAVOURITE)));try{u.db.allMessages.where("threadId").equals(e).toArray().then(e=>{let r=[];for(let t=0;t<e.length;t++){const n=e[t];n.isFavoriteMessage&&r.push(n)}t(r)}).catch(e=>{r(e)})}catch(e){r(e)}})}chatHistory(e){let t=i.ConfigHelper.get_Config();return null!=e.pagesize&&null!=e.pagesize||(e.pagesize=1),new Promise((r,a)=>{let s=new n.ChatApiService(t).GetThreadHistory(null,null,null,!0),i=this.chatApiService.GetChatHistory(e);Promise.all([s,i]).then(t=>{let n=t[0],s=t[1],i=null,c=null;if(200==n.status&&n.data.success){i=n.data.result;let t=i.threads.filter(t=>t.thread.threadId==e.threadId);null!=t&&t.length>0&&(c=t[0].thread,u.db.threadHistory.get(c.threadId,(function(e){null==e&&u.db.threadHistory.add(c,c.threadId).catch(e=>{})})))}if(200==s.status&&s.data.success){let t=s.data.result,n=[];if(null!=t&&null!=t.chats&&t.chats.length>0){for(let r=0;r<t.chats.length;r++){const a=t.chats[r];n.push(p.TransformHelper.buildMessageRecord(a,e.threadId,e.threadType,c))}let a={total:t.total,messages:n};r(a)}else{r({total:0,messages:n})}}else a(new o.ertcError(s.data.errorCode,s.data.msg))}).catch(e=>{a(e.message)})})}FollowThreads(e){let t=i.ConfigHelper.get_Config();return null!=e.pagesize&&null!=e.pagesize||(e.pagesize=1),new Promise((r,a)=>{let s=new n.ChatApiService(t).GetThreadHistory(null,null,null,!0),i=this.chatApiService.GetChatHistory(e);Promise.all([s,i]).then(e=>{let t=e[0],n=e[1],s=null;if(200==t.status&&t.data.success&&(s=t.data.result),200==n.status&&n.data.success){let e=n.data.result,t=[];if(null!=e&&null!=e.chats&&e.chats.length>0){for(let r=0;r<e.chats.length;r++){const n=e.chats[r];let a=null,o="",i=s.threads.filter(e=>e.thread.threadId==n.threadId);null!=i&&i.length>0&&(a=i[0].thread,o=i[0].thread.threadType),t.push(p.TransformHelper.buildMessageRecord(n,n.threadId,o,a))}let n={total:e.total,messages:t};r(n)}else{r({total:0,messages:t})}}else a(new o.ertcError(n.data.errorCode,n.data.msg))}).catch(e=>{a(e.message)})})}updateMessage(e){return new Promise((t,r)=>{let n={threadId:e.threadId,msgUniqueId:e.msgId};null!=e.isFavoriteMessage?n.isStarred=e.isFavoriteMessage:null!=e.follow?n.follow=e.follow:n.message=e.message,this.chatApiService.UpdateChat(n).then(e=>{200==e.status&&e.data.success?t(!0):r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})})}searchMessageHistory(e,t,r,n,a){return new Promise((i,u)=>{if(this.chatModuleFeatures.canSearch()){let s={searchQuery:{text:t},resultCategories:["messages"]};s.resultCategories="all"!=r?[r]:["messages","files"],null!=e&&""!=e&&null!=e&&(s.searchQuery.threadId=e),this.chatApiService.GetChatSearchHistory(s,n,a).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result.messages,r=e.data.result.files,n=e.data.result.channels,a={channels:[],files:[],messages:[],totalMessages:0,totalChannels:0,totalFiles:0};if(null!=t&&t.total>0){for(let e=0;e<t.chats.length;e++){const r=t.chats[e],n=t.threads.filter(e=>e.threadId===r.threadId);null!=n&&n.length>0&&a.messages.push(p.TransformHelper.buildMessageRecord(r,r.threadId,n[0].threadType,n[0]))}a.totalMessages=t.total}if(null!=r&&r.total>0){for(let e=0;e<r.chats.length;e++){const t=r.chats[e],n=r.threads.filter(e=>e.threadId===t.threadId);null!=n&&n.length>0&&a.files.push(p.TransformHelper.buildMessageRecord(t,t.threadId,n[0].threadType,n[0]))}a.totalFiles=r.total}if(null!=n&&n.groups.length>0){for(let e=0;e<n.groups.length;e++){const t=n.groups[e];a.channels.push(this.returnUserGroup(t))}a.totalChannels=n.groups.length}i(a)}else u(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{u(e)})}else u(new o.ertcError("111",s.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",s.ModuleConstants.SEARCH_CHAT)))})}returnUserGroup(e){return{groupId:e.groupId,tenantId:this.sdkconfig.tenantId,threadId:e.threadId,name:e.name,groupType:e.groupType,loginType:a.CommonConstants.LoginType,groupPic:null!=e.profilePic?a.ChatApiConstant.get_mediaUrl(this.sdkconfig,e.profilePic):null,groupThumb:null!=e.profilePicThumb?a.ChatApiConstant.get_mediaUrl(this.sdkconfig,e.profilePicThumb):null,freeze:null!=e.freeze&&e.freeze.enabled,deactivated:!1}}searchLocalMessageHistory(e,t){return new Promise((r,n)=>{if(null!=e&&""!=e&&null!=e)try{u.db.allMessages.where("threadId").equals(e).toArray().then(e=>{let n=[];if(null!=e&&e.length>0){var a=e.filter(e=>null!=e.message&&e.message.includes(t));if(null!=a&&a.length>0)for(let e=0;e<a.length;e++){const t=a[e];n.push(t)}}r(n)}).catch(e=>{n(e)})}catch(e){n(e)}else try{u.db.allMessages.where("message").startsWithIgnoreCase(t).toArray().then(e=>{let t=[];for(let r=0;r<e.length;r++){const n=e[r];t.push(n)}r(t)}).catch(e=>{n(e)})}catch(e){n(e)}})}threadHistory(e,t,r,n){return new Promise((a,s)=>{this.chatApiService.GetThreadHistory(e,t,r,n).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,r=[];if(null!=t&&t.total>0)for(let e=0;e<t.threads.length;e++){let n=t.threads[e].lastMessage,a=h.ThreadHelper.Transform_ThreadHistoryAPI_Result_To_ThreadSDKResult(t.threads[e].thread),s={thread:a,lastMessage:null==n?null:p.TransformHelper.buildMessageRecord(n,a.threadId,a.threadType,t.threads[e].thread)};r.push(s)}a(r)}else s(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{s(e)})})}chatSettings(){return new Promise((e,t)=>{let r=i.ConfigHelper.get_Config();new n.ChatSettingsApiService(r).GetChatSettings().then(r=>{200==r.status&&r.data.success?e(r.data.result):t(new o.ertcError(r.data.errorCode,r.data.msg))}).catch(e=>{t(e)})})}CreateMessageOnBroker(e,t){return new Promise((r,n)=>{i.ConfigHelper.get_Config();this.chatApiService.CreateMessageOnBroker(e,t).then(e=>{200==e.status&&e.data.success?r(!0):n(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})})}},m.setCallBackMethod((function(e){try{var t=JSON.parse(e.payloadString);if(e.destinationName.includes(a.CommonConstants.CHAT_TOPIC)){let e=t;v.FCMMqttCommonImp.processChatMessages(e)}else if(e.destinationName.includes(a.CommonConstants.MSG_READ_STATUS_TOPIC)){let e=t,r={id:e.msgUniqueId,tenantId:e.tenantId,threadId:e.threadId,ertcId:e.eRTCUserId,status:e.msgStatusEvent,timeStamp:e.timeStamp};null!=e.replyThreadFeatureData&&(r.chatThreadMetadata={parentMsgId:e.replyThreadFeatureData.baseMsgUniqueId,sendToChannel:e.replyThreadFeatureData.replyMsgConfig}),(new c.ChatModuleFeatures).canSendAlerts()&&(u.db.allMessages.update(e.msgUniqueId,{status:e.msgStatusEvent}),C.EventManager.publish("MessageRead",r))}else if(e.destinationName.includes(a.CommonConstants.TYPING_STATUS_TOPIC)){let e=t,r=(f.UserHelper.get_CurrentChatUser(),{threadId:e.threadId,typingStatus:e.typingStatusEvent,userId:e.eRTCUserId,name:e.name});C.EventManager.publish("TypingStatus",r)}else if(e.destinationName.includes(a.CommonConstants.AVAILABILITY_STATUS_TOPIC)){let e=t,n=null,a=f.UserHelper.get_CurrentChatUsers(),s=f.UserHelper.get_CurrentChatUser();if(null!=s&&s.ertcId===e.eRTCUserId)n=s;else{var r=a.filter(t=>t.ertcId===e.eRTCUserId);null!=r&&r.length>0&&(n=r[0])}null==n?n={UserChatId:e.appUserId,ertcId:e.eRTCUserId,availabilityStatus:e.availabilityStatus}:n.availabilityStatus=e.availabilityStatus,(new c.UserModuleFeatures).canGetAvailabilityStatus()&&C.EventManager.publish("Availability",n)}else if(e.destinationName.includes(a.CommonConstants.GROUP_UPDATED)){let e=t;v.FCMMqttCommonImp.processGroupUpdate(e)}else if(e.destinationName.includes(a.CommonConstants.CHAT_REACTION)){let e=t;v.FCMMqttCommonImp.processChatReaction(e)}else if(e.destinationName.includes(a.CommonConstants.CHAT_UPDATED)){let e=t;v.FCMMqttCommonImp.processChatUpdated(e)}else if(e.destinationName.includes(a.CommonConstants.USERDB_UPDATED))f.UserHelper.clear_CurrentChatUsers(),(new g.UserModule).GetChatUsers(!1).then(e=>{C.EventManager.publish("UserUpdated","UserUpdated")}).catch(e=>{console.log(e)});else if(e.destinationName.includes(a.CommonConstants.USER_SELF_UPDATE)){let e=t;v.FCMMqttCommonImp.processUserSelfUpdate(e)}else if(e.destinationName.includes("announcement")){let e=t;v.FCMMqttCommonImp.processAnnouncements(e)}else if(e.destinationName.includes("chatSettingUpdated")){let e=t;v.FCMMqttCommonImp.processChatSettingUpdated(e)}else if(e.destinationName.includes("chatReportUpdated")){let e=t;v.FCMMqttCommonImp.processChatReportUpdated(e)}}catch(e){console.log(e)}}))},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TransformHelper=void 0;const n=r(0),a=r(3),s=r(6),o=r(4),i=r(5);t.TransformHelper=class{static getGroupInfoChatRow(e,t){var r="";if(null!=e&&e.eventList.length>0&&null!=t.eventType){let u=i.UserHelper.get_CurrentChatUser(),c=t.eventType;if("frozen"==c||"deleted"==c||"unfrozen"==c||"activated"==c||"deactivated"==c)return null;let l=r=e.eventTriggeredByUser.eRTCUserId==u.ertcId?"You":e.eventTriggeredByUser.appUserId;if("profilePicChanged"==c)l+=" changed profile pic";else if("profilePicRemoved"==c)l+=" removed profile pic";else if("nameChanged"==c)l+=" changed group name";else if("descriptionChanged"==c)l+=" changed group description";else if("participantsRemoved"==c)if(e.eventTriggeredByUser.eRTCUserId==u.ertcId&&t.eventData.eventTriggeredOnUserList[0].eRTCUserId==u.ertcId)l+=" left";else{l+=" removed ";for(let e=0;e<t.eventData.eventTriggeredOnUserList.length;e++){l+=t.eventData.eventTriggeredOnUserList[e].appUserId+", "}l=l.trim().substring(0,l.length-2)}else if("participantsAdded"==c){l+=" added ";for(let e=0;e<t.eventData.eventTriggeredOnUserList.length;e++){const r=t.eventData.eventTriggeredOnUserList[e];u.ertcId==r.eRTCUserId?l+="you, ":l+=r.appUserId+", "}l=l.trim().substring(0,l.length-2)}else"adminMade"==c?l=t.eventData.eventTriggeredOnUserList[0].eRTCUserId==u.ertcId?"You are now an admin":t.eventData.eventTriggeredOnUserList[0].appUserId+" is now an admin":"adminDismissed"==c?l=t.eventData.eventTriggeredOnUserList[0].eRTCUserId==u.ertcId?"You are no longer an admin":t.eventData.eventTriggeredOnUserList[0].appUserId+" is no longer an admin":"created"==c?(l+=" created group "+t.eventData.changeData.name.new,u.UserChatId==e.eventTriggeredByUser.appUserId?a.ChatEventType.OUTGOING:(a.ChatEventType.INCOMING,l+=" "+r+" added you")):l="group updated";let d=Math.round((new Date).getTime());var n=s.Guid.newGuid().toString();let h=o.ConfigHelper.get_Config(),p=e.eventTriggeredByUser.appUserId;return{id:n,tenantId:h.tenantId,timestamp:d,message:l,read:0,threadType:"group",threadId:e.threadId,status:a.MessageStatus.SENT,msgType:"text",senderId:p,mediaPath:void 0,mediaThumbnail:void 0,locationRecord:void 0,contactName:void 0,phoneContactRecord:void 0,emailContactRecord:void 0,isFavoriteMessage:!1,gifPath:void 0,mediaName:void 0,chatEventType:a.ChatEventType.CHAT_META_DATA}}}static CreateChatResult_To_MessageRecord(e,t,r){try{if(null!=e){let s=o.ConfigHelper.get_Config(),i={id:e.msgUniqueId,threadId:e.threadId,tenantId:e.tenantId,msgType:e.msgType,timestamp:e.createdAt,status:t,follow:e.follow};if(null!=e.replyThreadFeatureData&&(i.chatThreadMetadata={parentMsgId:e.replyThreadFeatureData.baseMsgUniqueId,sendToChannel:e.replyThreadFeatureData.replyMsgConfig,parentMsg:"",chatThreadCount:0},null!=i.chatThreadMetadata.parentMsgId&&0==i.chatThreadMetadata.sendToChannel&&(i.chatThreadMetadata.parentMsg="Replied to thread"),e.replyThreadFeatureData.numOfReplies>0&&(i.hasChildThreads=!0)),null!=e.forwardChatFeatureData&&(i.forwardChatdata={parentMsgId:e.forwardChatFeatureData.originalMsgUniqueId,isForwarded:e.forwardChatFeatureData.isForwarded}),null!=r){let t="";switch(null!=r.media&&null!=r.media&&(t=r.media.name),r.type){case a.MessageType.Text:i.message=r.message;break;case a.MessageType.Image:case a.MessageType.Video:case a.MessageType.Audio:case a.MessageType.File:i.mediaName=t,i.mediaPath=null!=e.media&&null!=e.media?n.ChatApiConstant.get_mediaUrl(s,e.media.path):"",i.mediaThumbnail=null!=e.media&&null!=e.media&&null!=e.media.thumbnail?n.ChatApiConstant.get_mediaUrl(s,e.media.thumbnail):"";break;case a.MessageType.Gify:case a.MessageType.Gif:i.gifPath=r.gifPath;break;case a.MessageType.Contact:i.contactName=r.contact.contactName,i.emailContactRecord=r.contact.eMailRecords,i.phoneContactRecord=r.contact.phoneNumberRecord;break;case a.MessageType.Location:i.locationRecord=r.location}}return i}}catch(e){console.log(e)}}static buildMessageRecord(e,t,r,s){let i=o.ConfigHelper.get_Config(),u={id:e.msgUniqueId,tenantId:e.tenantId,timestamp:parseInt(e.createdAt),message:e.message,customData:e.customData,isEdited:e.isEdited,isFavoriteMessage:e.isStarred,isDeleted:e.isDeleted,read:0,threadType:r,threadId:t,status:a.MessageStatus.SENT,msgType:e.msgType,senderId:e.sendereRTCUserId,mediaPath:null!=e.media&&null!=e.media?n.ChatApiConstant.get_mediaUrl(i,e.media.path):"",mediaThumbnail:null!=e.media&&null!=e.media&&null!=e.media.thumbnail?n.ChatApiConstant.get_mediaUrl(i,e.media.thumbnail):"",locationRecord:e.location,contactName:null!=e.contact&&null!=e.contact?e.contact.name:"",phoneContactRecord:null!=e.contact&&null!=e.contact?e.contact.numbers:[],emailContactRecord:null!=e.contact&&null!=e.contact?e.contact.emails:[],gifPath:e.gify,mediaName:null!=e.media&&null!=e.media?e.media.name:"",follow:e.follow,chatReportId:e.chatReportId,chatReportStatus:e.chatReportStatus};null!=e.replyThreadFeatureData&&(u.chatThreadMetadata={parentMsgId:e.replyThreadFeatureData.baseMsgUniqueId,sendToChannel:e.replyThreadFeatureData.replyMsgConfig,parentMsg:"",chatThreadCount:0},null!=u.chatThreadMetadata.parentMsgId&&0==u.chatThreadMetadata.sendToChannel&&(u.chatThreadMetadata.parentMsg="Replied to thread"),e.replyThreadFeatureData.numOfReplies>0&&(u.hasChildThreads=!0)),null!=e.forwardChatFeatureData&&(u.forwardChatdata={parentMsgId:e.forwardChatFeatureData.originalMsgUniqueId,isForwarded:e.forwardChatFeatureData.isForwarded}),u.senderRecord={ertcId:null!=e.sendereRTCUserId&&null!=e.sendereRTCUserId?e.sendereRTCUserId:null!=e.sender?e.sender.eRTCUserId:""};let c=[];if(null!=e.reactions)for(let t=0;t<e.reactions.length;t++){const r=e.reactions[t];let n=[];for(let e=0;e<r.users.length;e++){var l={ertcId:r.users[e]};n.push(l)}let a={count:Number(r.count),emojiCode:r.emojiCode,userRecord:n};c.push(a)}return u.reactionData=c,u}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ProvisioningApiService=void 0;const n=r(0),a=r(8);t.ProvisioningApiService=class{getTenantInfo(e){return a.BaseApiService.getRequest(n.ProvisioningApiConstant.get_TenantAccountUrl(e),e)}}},function(e,t,r){"use strict";e.exports=function(e,t){return function(){for(var r=new Array(arguments.length),n=0;n<r.length;n++)r[n]=arguments[n];return e.apply(t,r)}}},function(e,t,r){"use strict";var n=r(1);function a(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}e.exports=function(e,t,r){if(!t)return e;var s;if(r)s=r(t);else if(n.isURLSearchParams(t))s=t.toString();else{var o=[];n.forEach(t,(function(e,t){null!=e&&(n.isArray(e)?t+="[]":e=[e],n.forEach(e,(function(e){n.isDate(e)?e=e.toISOString():n.isObject(e)&&(e=JSON.stringify(e)),o.push(a(t)+"="+a(e))})))})),s=o.join("&")}if(s){var i=e.indexOf("#");-1!==i&&(e=e.slice(0,i)),e+=(-1===e.indexOf("?")?"?":"&")+s}return e}},function(e,t,r){"use strict";e.exports=function(e){return!(!e||!e.__CANCEL__)}},function(e,t,r){"use strict";(function(t){var n=r(1),a=r(40),s={"Content-Type":"application/x-www-form-urlencoded"};function o(e,t){!n.isUndefined(e)&&n.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var i,u={adapter:(("undefined"!=typeof XMLHttpRequest||void 0!==t&&"[object process]"===Object.prototype.toString.call(t))&&(i=r(22)),i),transformRequest:[function(e,t){return a(t,"Accept"),a(t,"Content-Type"),n.isFormData(e)||n.isArrayBuffer(e)||n.isBuffer(e)||n.isStream(e)||n.isFile(e)||n.isBlob(e)?e:n.isArrayBufferView(e)?e.buffer:n.isURLSearchParams(e)?(o(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString()):n.isObject(e)?(o(t,"application/json;charset=utf-8"),JSON.stringify(e)):e}],transformResponse:[function(e){if("string"==typeof e)try{e=JSON.parse(e)}catch(e){}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,validateStatus:function(e){return e>=200&&e<300}};u.headers={common:{Accept:"application/json, text/plain, */*"}},n.forEach(["delete","get","head"],(function(e){u.headers[e]={}})),n.forEach(["post","put","patch"],(function(e){u.headers[e]=n.merge(s)})),e.exports=u}).call(this,r(21))},function(e,t){var r,n,a=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function i(e){if(r===setTimeout)return setTimeout(e,0);if((r===s||!r)&&setTimeout)return r=setTimeout,setTimeout(e,0);try{return r(e,0)}catch(t){try{return r.call(null,e,0)}catch(t){return r.call(this,e,0)}}}!function(){try{r="function"==typeof setTimeout?setTimeout:s}catch(e){r=s}try{n="function"==typeof clearTimeout?clearTimeout:o}catch(e){n=o}}();var u,c=[],l=!1,d=-1;function h(){l&&u&&(l=!1,u.length?c=u.concat(c):d=-1,c.length&&p())}function p(){if(!l){var e=i(h);l=!0;for(var t=c.length;t;){for(u=c,c=[];++d<t;)u&&u[d].run();d=-1,t=c.length}u=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===o||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function f(e,t){this.fun=e,this.array=t}function g(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];c.push(new f(e,t)),1!==c.length||l||i(p)},f.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=g,a.addListener=g,a.once=g,a.off=g,a.removeListener=g,a.removeAllListeners=g,a.emit=g,a.prependListener=g,a.prependOnceListener=g,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,r){"use strict";var n=r(1),a=r(41),s=r(18),o=r(43),i=r(46),u=r(47),c=r(23);e.exports=function(e){return new Promise((function(t,l){var d=e.data,h=e.headers;n.isFormData(d)&&delete h["Content-Type"];var p=new XMLHttpRequest;if(e.auth){var f=e.auth.username||"",g=e.auth.password||"";h.Authorization="Basic "+btoa(f+":"+g)}var m=o(e.baseURL,e.url);if(p.open(e.method.toUpperCase(),s(m,e.params,e.paramsSerializer),!0),p.timeout=e.timeout,p.onreadystatechange=function(){if(p&&4===p.readyState&&(0!==p.status||p.responseURL&&0===p.responseURL.indexOf("file:"))){var r="getAllResponseHeaders"in p?i(p.getAllResponseHeaders()):null,n={data:e.responseType&&"text"!==e.responseType?p.response:p.responseText,status:p.status,statusText:p.statusText,headers:r,config:e,request:p};a(t,l,n),p=null}},p.onabort=function(){p&&(l(c("Request aborted",e,"ECONNABORTED",p)),p=null)},p.onerror=function(){l(c("Network Error",e,null,p)),p=null},p.ontimeout=function(){var t="timeout of "+e.timeout+"ms exceeded";e.timeoutErrorMessage&&(t=e.timeoutErrorMessage),l(c(t,e,"ECONNABORTED",p)),p=null},n.isStandardBrowserEnv()){var C=r(48),v=(e.withCredentials||u(m))&&e.xsrfCookieName?C.read(e.xsrfCookieName):void 0;v&&(h[e.xsrfHeaderName]=v)}if("setRequestHeader"in p&&n.forEach(h,(function(e,t){void 0===d&&"content-type"===t.toLowerCase()?delete h[t]:p.setRequestHeader(t,e)})),n.isUndefined(e.withCredentials)||(p.withCredentials=!!e.withCredentials),e.responseType)try{p.responseType=e.responseType}catch(t){if("json"!==e.responseType)throw t}"function"==typeof e.onDownloadProgress&&p.addEventListener("progress",e.onDownloadProgress),"function"==typeof e.onUploadProgress&&p.upload&&p.upload.addEventListener("progress",e.onUploadProgress),e.cancelToken&&e.cancelToken.promise.then((function(e){p&&(p.abort(),l(e),p=null)})),void 0===d&&(d=null),p.send(d)}))}},function(e,t,r){"use strict";var n=r(42);e.exports=function(e,t,r,a,s){var o=new Error(e);return n(o,t,r,a,s)}},function(e,t,r){"use strict";var n=r(1);e.exports=function(e,t){t=t||{};var r={},a=["url","method","params","data"],s=["headers","auth","proxy"],o=["baseURL","url","transformRequest","transformResponse","paramsSerializer","timeout","withCredentials","adapter","responseType","xsrfCookieName","xsrfHeaderName","onUploadProgress","onDownloadProgress","maxContentLength","validateStatus","maxRedirects","httpAgent","httpsAgent","cancelToken","socketPath"];n.forEach(a,(function(e){void 0!==t[e]&&(r[e]=t[e])})),n.forEach(s,(function(a){n.isObject(t[a])?r[a]=n.deepMerge(e[a],t[a]):void 0!==t[a]?r[a]=t[a]:n.isObject(e[a])?r[a]=n.deepMerge(e[a]):void 0!==e[a]&&(r[a]=e[a])})),n.forEach(o,(function(n){void 0!==t[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])}));var i=a.concat(s).concat(o),u=Object.keys(t).filter((function(e){return-1===i.indexOf(e)}));return n.forEach(u,(function(n){void 0!==t[n]?r[n]=t[n]:void 0!==e[n]&&(r[n]=e[n])})),r}},function(e,t,r){"use strict";function n(e){this.message=e}n.prototype.toString=function(){return"Cancel"+(this.message?": "+this.message:"")},n.prototype.__CANCEL__=!0,e.exports=n},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HeaderUtils=void 0;const n=r(51);t.HeaderUtils=class{static getHeaderSignature(e,t,r){let a=e+"~"+t+"~"+r;return n.sha256(a)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserModule=void 0;const n=r(28);t.UserModule=class{constructor(){}login(e,t){return(new n.UserModuleImp).login(e,t)}forgetPassword(e){return(new n.UserModuleImp).forgetPassword(e)}changePassword(e,t){return(new n.UserModuleImp).changePassword(e,t)}getCurrentUser(){return(new n.UserModuleImp).getCurrentUser()}GetChatUsers(e){return(new n.UserModuleImp).GetChatUsers(e)}LogOutUser(){return(new n.UserModuleImp).LogOutUser()}UpdateUser(e,t){return(new n.UserModuleImp).UpdateUser(e,t)}setUserAvailability(e){return(new n.UserModuleImp).setUserAvailability(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserModuleImp=void 0;const n=r(54),a=r(0),s=r(2),o=r(10),i=r(3),u=r(7),c=r(11),l=r(12),d=r(4),h=r(5),p=r(13),f=r(14);t.UserModuleImp=class{constructor(){this.sdkconfig=null,this.userApiService=null,this.userModuleFeatures=null,this.sdkconfig=d.ConfigHelper.get_Config(),null!=this.sdkconfig?(this.userApiService=new n.UserApiService(this.sdkconfig),this.userModuleFeatures=new u.UserModuleFeatures):console.log("Module is not initialized")}login(e,t){return new Promise((r,o)=>{let u=d.ConfigHelper.get_Config();if(null!=u){h.UserHelper.clear_CurrentUser(),h.UserHelper.clear_CurrentChatUsers(),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserServerRefreshToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatServerRefreshToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups);var c=s.LocalStorageHelper.get_ObjectToken(a.CommonConstants.JSSDKFCMAccessToken),l={loginType:a.CommonConstants.LoginType,appUserId:e,password:t,deviceId:u.deviceId,deviceType:u.deviceType};l.fcmToken=null!=c&&""!=c?c:"5399ae9500202296ccb39e6893cb93e29f0e4afa0525aa370ca4b177dba780a5",new n.UserApiService(u).getUserInfo(l).then(t=>{if(200==t.status&&t.data.success){let n=t.data.result;u.userId=n.userId,u.username=e,s.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKUserAccessToken,n.token.accessToken),s.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKUserServerRefreshToken,n.token.refreshToken),n.profilePic=null!=n.profilePic?a.UserApiConstants.get_ImageUrl(u,n.profilePic):null,n.profilePicThumb=null!=n.profilePicThumb?a.UserApiConstants.get_ImageUrl(u,n.profilePicThumb):null,d.ConfigHelper.set_Config(u),(new f.ChatModuleImp).LoginIntoChatServer(n.appUserId).then(e=>{if(e){n.eRTCUserId=e.ertcId,u.eRTCUserId=e.ertcId,d.ConfigHelper.set_Config(u);var s={Id:n.userId,tenantId:u.tenantId,name:n.name,loginType:a.CommonConstants.LoginType,profilePic:n.profilePic,profilePicThumb:n.profilePicThumb,profileStatus:n.profileStatus,loginTimeStamp:n.loginTimeStamp,UserChatId:n.appUserId,ertcId:n.eRTCUserId,availabilityStatus:n.availabilityStatus,blockedStatus:n.blockedStatus};h.UserHelper.set_CurrentUser(s),r(s)}else o(new i.ertcError(t.data.errorCode,t.data.msg))}).catch(e=>{o(e)})}else o(new i.ertcError(t.data.errorCode,t.data.msg))}).catch(e=>{o(e)})}})}forgetPassword(e){return new Promise((t,r)=>{let s=d.ConfigHelper.get_Config();if(null!=s){var o={loginType:a.CommonConstants.LoginType,appUserId:e};new n.UserApiService(s).forgetPassword(o).then(e=>{200==e.status&&e.data.success?t(!0):r(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}})}changePassword(e,t){return new Promise((r,s)=>{let o=d.ConfigHelper.get_Config();if(null!=o){var u={loginType:a.CommonConstants.LoginType,appUserId:o.username,currentPassword:e,newPassword:t};new n.UserApiService(o).changePassword(u).then(e=>{200==e.status&&e.data.success?r(!0):s(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{s(e)})}})}getCurrentUser(){return new Promise((e,t)=>{e(h.UserHelper.get_CurrentUser())})}GetChatUsers(e){return new Promise((t,r)=>{this.userModuleFeatures.isSubscriptionAvailable()||r(new i.ertcError("111",c.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",c.ModuleConstants.USER_MODULE)));let n=d.ConfigHelper.get_Config(),s=h.UserHelper.get_CurrentUser();if(null!=n){let u=h.UserHelper.get_CurrentChatUsers();null!=u&&u.length>0?(t(u),this.getChatHistory()):h.UserHelper.clear_CurrentChatUsers();let c=null;e&&(c={lastId:n.moreUserData.lastUserId}),this.userApiService.getChatUsers(c).then(e=>{if(200==e.status&&e.data.success){let u=[],c=e.data.result;if(null!=c&&null!=c&&null!=c.chatUsers&&null!=c.chatUsers&&c.chatUsers.length>0){let e=[];for(let t=0;t<c.chatUsers.length;t++)e.push(c.chatUsers[t].appUserId);let l={statusKeys:["availabilityStatus","blockedStatus"],appUserIds:e};new o.ChatApiService(n).GetOtherChatUserDetails(l).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result;for(let e=0;e<c.chatUsers.length;e++){let t=r.chatUserDetails.filter(t=>t.appUserId===c.chatUsers[e].appUserId);null!=t&&t.length>0&&(c.chatUsers[e].eRTCUserId=t[0].eRTCUserId,c.chatUsers[e].availabilityStatus=t[0].statusDetails.availabilityStatus,c.chatUsers[e].blockedStatus=t[0].statusDetails.blockedStatus)}n.moreUserData={moreDataAvailable:c.moreDataAvailable},c.moreDataAvailable&&(n.moreUserData.lastUserId=c.chatUsers[c.chatUsers.length-1].userId),d.ConfigHelper.set_Config(n),c.chatUsers=this.changeImageRelativeURL(c.chatUsers,n);for(let e=0;e<c.chatUsers.length;e++){const t=c.chatUsers[e];var o={Id:t.userId,tenantId:n.tenantId,name:t.name,loginType:a.CommonConstants.LoginType,profilePic:t.profilePic,profilePicThumb:t.profilePicThumb,profileStatus:t.profileStatus,loginTimeStamp:t.loginTimeStamp,UserChatId:t.appUserId,ertcId:t.eRTCUserId,availabilityStatus:t.availabilityStatus,blockedStatus:t.blockedStatus,isBot:t.isBot};s.ertcId==o.ertcId?(h.UserHelper.clear_CurrentUser(),h.UserHelper.set_CurrentUser(o)):u.push(o),h.UserHelper.clear_CurrentChatUsers(),h.UserHelper.set_CurrentChatUsers(u)}t(u),this.getChatHistory()}else r(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}else t(u)}else r(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}})}GetUpdatedChatUsers(e){return new Promise((t,r)=>{this.userModuleFeatures.isSubscriptionAvailable()||r(new i.ertcError("111",c.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",c.ModuleConstants.USER_MODULE)));let n=d.ConfigHelper.get_Config();if(null!=n){let a=null;e&&(a={lastId:n.moreUserData.lastUserId}),this.userApiService.getChatUsers(a).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,a=[];for(let e=0;e<r.chatUsers.length;e++)a.push(r.chatUsers[e].appUserId);n.moreUserData={moreDataAvailable:r.moreDataAvailable},r.moreDataAvailable&&(n.moreUserData.lastUserId=r.chatUsers[r.chatUsers.length-1].userId),d.ConfigHelper.set_Config(n),r.chatUsers=this.changeImageRelativeURL(r.chatUsers,n),t(r)}else r(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}})}LogOutUser(){return new Promise((e,t)=>{this.userModuleFeatures.isSubscriptionAvailable()||t(new i.ertcError("111",c.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",c.ModuleConstants.USER_MODULE)));let r=d.ConfigHelper.get_Config();if(null!=r){let n={appUserId:r.username,deviceId:r.deviceId};this.userApiService.logout(n).then(n=>{200==n.status&&n.data.success?(null!=l.getMqttClient()&&l.unsubscribe(r),r.username=null,r.password=null,r.userId=null,r.eRTCUserId=null,s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserServerRefreshToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatServerRefreshToken),h.UserHelper.clear_CurrentChatUsers(),h.UserHelper.clear_CurrentUser(),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),p.db.allMessages.clear(),p.db.threadHistory.clear(),e(n.data.result.message)):t(new i.ertcError(n.data.errorCode,n.data.msg))}).catch(e=>{t(e)})}})}UpdateUser(e,t){return new Promise((r,n)=>{this.userModuleFeatures.canUpdateProfile()||n(new i.ertcError("111",c.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",c.ModuleConstants.USER_PROFILE)));let s=d.ConfigHelper.get_Config();if(null!=s){var o=new FormData;o.append("loginType","email"),""!=e&&o.append("profileStatus",e),null!=t&&o.append("profilePic",t),this.userApiService.UpdateUser(o).then(e=>{if(200==e.status&&e.data.success){const n=e.data.result;n.profilePic=null!=n.profilePic?a.UserApiConstants.get_ImageUrl(s,n.profilePic):null,n.profilePicThumb=null!=n.profilePicThumb?a.UserApiConstants.get_ImageUrl(s,n.profilePicThumb):null;let o=h.UserHelper.get_CurrentUser();null!=o&&(o.UserChatId,n.appUserId);var t={Id:n.userId,tenantId:s.tenantId,name:n.name,loginType:a.CommonConstants.LoginType,profilePic:n.profilePic,profilePicThumb:n.profilePicThumb,profileStatus:n.profileStatus,loginTimeStamp:n.loginTimeStamp,UserChatId:n.appUserId,ertcId:o.ertcId,availabilityStatus:o.availabilityStatus,blockedStatus:o.blockedStatus};h.UserHelper.set_CurrentUser(t),r(t)}else n(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})}})}setUserAvailability(e){return new Promise((t,r)=>{this.userModuleFeatures.canUpdateProfile()||r(new i.ertcError("111",c.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",c.ModuleConstants.AVAILABILITY_STATUS)));let n=d.ConfigHelper.get_Config();if(null==n)return;var u=s.LocalStorageHelper.get_ObjectToken(a.CommonConstants.JSSDKFCMAccessToken);let l={deviceId:n.deviceId,deviceType:n.deviceType,availabilityStatus:e,notificationSettings:{allowFrom:"none"}};l.fcmToken=null!=u&&""!=u?u:"5399ae9500202296ccb39e6893cb93e29f0e4afa0525aa370ca4b177dba780a5",new o.ChatApiService(n).UpdateERTCUser(l).then(e=>{200==e.status&&e.data.success?t(!0):r(new i.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})})}changeImageRelativeURL(e,t){let r=[];return e.forEach(e=>{e.profilePic=null!=e.profilePic?a.UserApiConstants.get_ImageUrl(t,e.profilePic):null,e.profilePicThumb=null!=e.profilePicThumb?a.UserApiConstants.get_ImageUrl(t,e.profilePicThumb):null,r.push(e)}),r}getChatHistory(){let e=d.ConfigHelper.get_Config();null!=e&&new o.ChatApiService(e).GetThreadHistory("","","",!0).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result.threads;p.db.threadHistory.clear().then(e=>{for(let e=0;e<t.length;e++){const r=t[e];p.db.threadHistory.get(r.thread.threadId,(function(e){null==e&&p.db.threadHistory.add(r.thread,r.thread.threadId).catch(e=>{})}))}})}}).catch(e=>{console.log(e)})}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FCMMqttCommonImp=void 0;const n=r(2),a=r(0),s=r(3),o=r(9),i=r(28),u=r(7),c=r(13),l=r(16),d=r(30),h=r(15),p=r(4),f=r(5);t.FCMMqttCommonImp=class{static processUserDBUpdated(){f.UserHelper.clear_CurrentChatUsers(),(new i.UserModuleImp).GetChatUsers(!1).then(e=>{o.EventManager.publish("UserUpdated","UserUpdated")}).catch(e=>{console.log(e)})}static processTenantConfigModified(){let e=p.ConfigHelper.get_Config(),t={deviceId:e.deviceId,deviceType:"android"};t.tenantUrl=e.tenantUrl,t.accessCode=e.accessCode,(new l.ProvisioningApiService).getTenantInfo(t).then(t=>{200==t.status&&t.data.success&&(e.TenantInfoResult=t.data.result,p.ConfigHelper.set_Config(e))}).catch(e=>{console.log(e)})}static processChatMessages(e){let t=p.ConfigHelper.get_Config(),r={id:e.msgUniqueId,tenantId:e.tenantId,timestamp:e.createdAt,message:e.message,read:0,threadType:null!=e.thread&&null!=e.thread?e.thread.threadType:"",threadId:null!=e.thread&&null!=e.thread?e.thread.threadId:"",status:s.MessageStatus.SENT,msgType:e.msgType,senderId:null!=e.sender&&null!=e.sender?e.sender.appUserId:"",mediaPath:null!=e.media&&null!=e.media?a.ChatApiConstant.get_mediaUrl(t,e.media.path):"",mediaThumbnail:null!=e.media&&null!=e.media&&null!=e.media.thumbnail?a.ChatApiConstant.get_mediaUrl(t,e.media.thumbnail):"",locationRecord:e.location,contactName:null!=e.contact&&null!=e.contact?e.contact.name:"",phoneContactRecord:null!=e.contact&&null!=e.contact?e.contact.numbers:[],emailContactRecord:null!=e.contact&&null!=e.contact?e.contact.emails:[],isFavoriteMessage:!1,gifPath:e.gify,mediaName:null!=e.media&&null!=e.media?e.media.name:""};null!=e.replyThreadFeatureData&&(r.chatThreadMetadata={parentMsgId:e.replyThreadFeatureData.baseMsgUniqueId,sendToChannel:e.replyThreadFeatureData.replyMsgConfig}),r.senderRecord={UserChatId:e.sender.appUserId,ertcId:e.sender.eRTCUserId,name:e.sender.name},c.db.allMessages.get(r.id,(function(e){null==e?c.db.allMessages.add(r,r.id).catch(e=>{}):c.db.allMessages.put(r,r.id).catch(e=>{})})),o.EventManager.publish("ChatRecieved",r)}static processMsgReadStatus(e){(new u.ChatModuleFeatures).canSendAlerts()&&(c.db.allMessages.update(e.msgUniqueId,{status:e.msgStatusEvent}),o.EventManager.publish("MessageRead",e))}static processGroupUpdate(e){let t=p.ConfigHelper.get_Config(),r=e.eventList.filter(e=>"deleted"==e.eventType);if(null!=r&&r.length>0){let t=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==t&&null==t&&(t=[]);let r=t.filter(t=>t.groupId==e.groupId);if(null!=r&&r.length>0){let e=t.indexOf(r[0]);e>-1&&t.splice(e,1)}return n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,t),void o.EventManager.publish("GroupDeleted",e.groupId)}new d.GroupChatApiService(t).GetGroupsById(e.groupId).then(r=>{if(200==r.status&&r.data.success){let i=r.data.result,u=[];for(let e=0;e<i.participants.length;e++){const t=i.participants[e];let r=null;r={ertcId:t.eRTCUserId,role:t.role,UserChatId:t.appUserId,joinedAtDate:t.joinedAtDate},u.push(r)}let l={groupId:i.groupId,tenantId:t.tenantId,threadId:i.threadId,name:i.name,groupType:i.groupType,loginType:a.CommonConstants.LoginType,groupPic:null!=i.profilePic?a.ChatApiConstant.get_mediaUrl(t,i.profilePic):null,groupThumb:null!=i.profilePicThumb?a.ChatApiConstant.get_mediaUrl(t,i.profilePicThumb):null,groupDesc:i.description,loginTimestamp:i.createdAt,groupUsers:u,freeze:null!=i.freeze&&i.freeze.enabled,deactivated:!1},d=e.eventList.filter(e=>"activated"==e.eventType);null!=d&&d.length>0&&(l.deactivated=!1);let p=e.eventList.filter(e=>"deactivated"==e.eventType);if(null!=p&&p.length>0){let t=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==t&&null==t&&(t=[]);let r=t.filter(t=>t.groupId==e.groupId);if(null!=r&&r.length>0){let e=t.indexOf(r[0]);e>-1&&(t.splice(e,1),n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,t))}return l.deactivated=!0,void o.EventManager.publish("GroupUpdated",l)}let g=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==g&&null==g&&(g=[]);let m=g.filter(e=>e.groupId==l.groupId),C=!1;if(null!=m&&m.length>0){let e=g.indexOf(m[0]);e>-1?(C=JSON.stringify(m[0])!==JSON.stringify(l),g[e]=l):g.push(l)}else g.push(l);n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,g),o.EventManager.publish("GroupUpdated",l);let v=e.eventList.filter(e=>"participantsRemoved"==e.eventType);if(null!=v&&v.length>0){let t=f.UserHelper.get_CurrentChatUser();if(e.eventTriggeredByUser.eRTCUserId!=t.ertcId&&v[0].eventData.eventTriggeredOnUserList[0].eRTCUserId==t.ertcId){let t=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==t&&null==t&&(t=[]);let r=t.filter(t=>t.groupId==e.groupId);if(null!=r&&r.length>0){let e=t.indexOf(r[0]);e>-1&&t.splice(e,1)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,t),o.EventManager.publish("CurrentUserRemoved",e.groupId)}}for(let t=0;t<e.eventList.length;t++){const r=e.eventList[t];var s=h.TransformHelper.getGroupInfoChatRow(e,r);null!=s&&(c.db.allMessages.get(s.id,(function(e){null==e&&c.db.allMessages.add(s,s.id).catch(e=>{})})),o.EventManager.publish("ChatRecieved",s))}}}).catch(e=>{console.log(e)})}static processChatReaction(e){console.log(e);let t={ertcId:e.eRTCUserId},r={threadId:e.threadId,msgUniqueId:e.msgUniqueId,emojiCode:e.emojiCode,count:e.totalCount,userRecord:t};"set"==e.action&&(r.chatReactionType=s.ChatReactionType.SET),"clear"==e.action&&(r.chatReactionType=s.ChatReactionType.CLEAR),o.EventManager.publish("ChatReaction",r)}static processChatUpdated(e){if("delete"===e.updateType){let t=[];for(let r=0;r<e.chats.length;r++){const n=e.chats[r];t.push(n.msgUniqueId),c.db.allMessages.delete(n.msgUniqueId).catch(e=>{})}o.EventManager.publish("ChatDeleted",t)}else if("edit"===e.updateType){let t=[];for(let r=0;r<e.chats.length;r++){const n=e.chats[r];let a={message:n.message,msgId:n.msgUniqueId,threadId:e.threadId,isFavoriteMessage:n.isStarred};null!=n.replyThreadFeatureData&&(a.chatThreadMetadata={parentMsgId:n.replyThreadFeatureData.baseMsgUniqueId,sendToChannel:n.replyThreadFeatureData.replyMsgConfig,parentMsg:"",chatThreadCount:0}),t.push(a),c.db.allMessages.get(a.msgId,(function(e){null!=e&&(e.message=a.message,c.db.allMessages.put(e,a.msgId).catch(e=>{}))}))}o.EventManager.publish("ChatUpdated",t)}}static processAnnouncements(e){o.EventManager.publish("Announcement",e)}static processChatSettingUpdated(e){o.EventManager.publish("ChatSettingUpdated",e)}static processChatReportUpdated(e){o.EventManager.publish("chatReportUpdated",e)}static processUserSelfUpdate(e){let t=null,r=f.UserHelper.get_CurrentChatUsers(),n=f.UserHelper.get_CurrentUser();null!=n&&n.ertcId===e.eRTCUserId?t=n:null!=(s=r.filter(t=>t.ertcId===e.eRTCUserId))&&s.length>0&&(t=s[0]);if(null==t);else{let r=e.eventList.filter(e=>e.eventType.includes("availabilityStatusChanged"));null!=r&&r.length>0&&null!=r[0].eventData&&(t.availabilityStatus=r[0].eventData.availabilityStatus)}null!=t&&(new u.UserModuleFeatures).canGetAvailabilityStatus()&&o.EventManager.publish("Availability",t);let a=e.eventList.filter(e=>e.eventType.includes("userBlockedStatusChanged"));if(null!=a&&a.length>0)for(let e=0;e<a.length;e++){let t=a[e].eventData,i=null;var s;if(null!=n&&n.ertcId===t.targetUser.eRTCUserId)i=n;else null!=(s=r.filter(e=>e.ertcId===t.targetUser.eRTCUserId))&&s.length>0&&(i=s[0]);null!=i&&(i.blockedStatus=t.blockedStatus,o.EventManager.publish("Availability",i))}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupChatApiService=void 0;const n=r(0),a=r(8);t.GroupChatApiService=class{constructor(e){this.sdkconfig=null,this.sdkconfig=e}CreateUpdateGroup(e){return a.BaseApiService.postRequest(n.GroupApiConstant.group_createUpdate(this.sdkconfig),e,this.sdkconfig)}CreateUpdateGroupWithImage(e){return a.BaseApiService.postFormDataRequest(n.GroupApiConstant.group_createUpdate(this.sdkconfig),e,this.sdkconfig)}AddParticipants(e,t){let r=n.GroupApiConstant.group_addParticipants(this.sdkconfig).replace("{groupId}",e);return a.BaseApiService.postRequest(r,t,this.sdkconfig)}RemoveProfilePic(e){let t=n.GroupApiConstant.group_removeProfilePic(this.sdkconfig).replace("{groupId}",e);return a.BaseApiService.deleteRequest(t,null,this.sdkconfig)}RemoveParticipants(e,t){let r=n.GroupApiConstant.group_removeParticipants(this.sdkconfig).replace("{groupId}",e);return a.BaseApiService.postRequest(r,t,this.sdkconfig)}GetGroupsById(e){let t=n.GroupApiConstant.group_getByGroupId(this.sdkconfig).replace("{groupId}",e);return a.BaseApiService.getRequest(t,this.sdkconfig)}GetGroupsByThreadId(e){return a.BaseApiService.getRequest(n.GroupApiConstant.group_groupByThreadI(this.sdkconfig),this.sdkconfig)}GetUserGroups(){return a.BaseApiService.getRequest(n.GroupApiConstant.group_userGroups(this.sdkconfig),this.sdkconfig)}MakeDismissActions(e,t,r){let s=n.GroupApiConstant.group_makeDismissAdmin(this.sdkconfig).replace("{groupId}",e).replace("{action}",t);return a.BaseApiService.postRequest(s,r,this.sdkconfig)}}},function(e,t,r){"use strict";var n=this&&this.__createBinding||(Object.create?function(e,t,r,n){void 0===n&&(n=r),Object.defineProperty(e,n,{enumerable:!0,get:function(){return t[r]}})}:function(e,t,r,n){void 0===n&&(n=r),e[n]=t[r]}),a=this&&this.__exportStar||function(e,t){for(var r in e)"default"===r||t.hasOwnProperty(r)||n(t,e,r)};Object.defineProperty(t,"__esModule",{value:!0});var s=r(32);Object.defineProperty(t,"TenantModule",{enumerable:!0,get:function(){return s.TenantModule}});var o=r(27);Object.defineProperty(t,"UserModule",{enumerable:!0,get:function(){return o.UserModule}});var i=r(57);Object.defineProperty(t,"ChatModule",{enumerable:!0,get:function(){return i.ChatModule}});var u=r(58);Object.defineProperty(t,"FCMModule",{enumerable:!0,get:function(){return u.FCMModule}});var c=r(60);Object.defineProperty(t,"GroupChatModule",{enumerable:!0,get:function(){return c.GroupChatModule}});var l=r(9);Object.defineProperty(t,"EventManager",{enumerable:!0,get:function(){return l.EventManager}});var d=r(62);Object.defineProperty(t,"TypingModule",{enumerable:!0,get:function(){return d.TypingModule}});var h=r(64);Object.defineProperty(t,"ChatReportModule",{enumerable:!0,get:function(){return h.ChatReportModule}});var p=r(66);Object.defineProperty(t,"eRTCSDK",{enumerable:!0,get:function(){return p.eRTCSDK}}),a(r(3),t)},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TenantModule=void 0;const n=r(33);t.TenantModule=class{constructor(){}validateTenant(e,t){return(new n.TenantModuleImp).validateTenant(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TenantModuleImp=void 0;const n=r(16),a=r(0),s=r(2),o=r(6),i=r(3),u=r(4),c=r(5);t.TenantModuleImp=class{constructor(){}validateTenant(e,t){var r=o.Guid.newGuid().toString();u.ConfigHelper.clear_Config(),c.UserHelper.clear_CurrentUser(),c.UserHelper.clear_CurrentChatUsers(),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserServerRefreshToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatAccessToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKChatServerRefreshToken),s.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups);let l={deviceId:r,deviceType:"android"};return new Promise((r,a)=>{l.tenantUrl=e,l.accessCode=t,(new n.ProvisioningApiService).getTenantInfo(l).then(t=>{200==t.status&&t.data.success?(l.tenantId=t.data.result.tenantId,l.ServerDetails=t.data.result.config.serverDetails,l.tenantUrl=e,l.TenantInfoResult=t.data.result,u.ConfigHelper.set_Config(l),r(!0)):a(new i.ertcError(t.data.errorCode,t.data.msg))}).catch(e=>{a(e)})})}}},function(e,t,r){e.exports=r(35)},function(e,t,r){"use strict";var n=r(1),a=r(17),s=r(36),o=r(24);function i(e){var t=new s(e),r=a(s.prototype.request,t);return n.extend(r,s.prototype,t),n.extend(r,t),r}var u=i(r(20));u.Axios=s,u.create=function(e){return i(o(u.defaults,e))},u.Cancel=r(25),u.CancelToken=r(49),u.isCancel=r(19),u.all=function(e){return Promise.all(e)},u.spread=r(50),e.exports=u,e.exports.default=u},function(e,t,r){"use strict";var n=r(1),a=r(18),s=r(37),o=r(38),i=r(24);function u(e){this.defaults=e,this.interceptors={request:new s,response:new s}}u.prototype.request=function(e){"string"==typeof e?(e=arguments[1]||{}).url=arguments[0]:e=e||{},(e=i(this.defaults,e)).method?e.method=e.method.toLowerCase():this.defaults.method?e.method=this.defaults.method.toLowerCase():e.method="get";var t=[o,void 0],r=Promise.resolve(e);for(this.interceptors.request.forEach((function(e){t.unshift(e.fulfilled,e.rejected)})),this.interceptors.response.forEach((function(e){t.push(e.fulfilled,e.rejected)}));t.length;)r=r.then(t.shift(),t.shift());return r},u.prototype.getUri=function(e){return e=i(this.defaults,e),a(e.url,e.params,e.paramsSerializer).replace(/^\?/,"")},n.forEach(["delete","get","head","options"],(function(e){u.prototype[e]=function(t,r){return this.request(n.merge(r||{},{method:e,url:t}))}})),n.forEach(["post","put","patch"],(function(e){u.prototype[e]=function(t,r,a){return this.request(n.merge(a||{},{method:e,url:t,data:r}))}})),e.exports=u},function(e,t,r){"use strict";var n=r(1);function a(){this.handlers=[]}a.prototype.use=function(e,t){return this.handlers.push({fulfilled:e,rejected:t}),this.handlers.length-1},a.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},a.prototype.forEach=function(e){n.forEach(this.handlers,(function(t){null!==t&&e(t)}))},e.exports=a},function(e,t,r){"use strict";var n=r(1),a=r(39),s=r(19),o=r(20);function i(e){e.cancelToken&&e.cancelToken.throwIfRequested()}e.exports=function(e){return i(e),e.headers=e.headers||{},e.data=a(e.data,e.headers,e.transformRequest),e.headers=n.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),n.forEach(["delete","get","head","post","put","patch","common"],(function(t){delete e.headers[t]})),(e.adapter||o.adapter)(e).then((function(t){return i(e),t.data=a(t.data,t.headers,e.transformResponse),t}),(function(t){return s(t)||(i(e),t&&t.response&&(t.response.data=a(t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)}))}},function(e,t,r){"use strict";var n=r(1);e.exports=function(e,t,r){return n.forEach(r,(function(r){e=r(e,t)})),e}},function(e,t,r){"use strict";var n=r(1);e.exports=function(e,t){n.forEach(e,(function(r,n){n!==t&&n.toUpperCase()===t.toUpperCase()&&(e[t]=r,delete e[n])}))}},function(e,t,r){"use strict";var n=r(23);e.exports=function(e,t,r){var a=r.config.validateStatus;!a||a(r.status)?e(r):t(n("Request failed with status code "+r.status,r.config,null,r.request,r))}},function(e,t,r){"use strict";e.exports=function(e,t,r,n,a){return e.config=t,r&&(e.code=r),e.request=n,e.response=a,e.isAxiosError=!0,e.toJSON=function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code}},e}},function(e,t,r){"use strict";var n=r(44),a=r(45);e.exports=function(e,t){return e&&!n(t)?a(e,t):t}},function(e,t,r){"use strict";e.exports=function(e){return/^([a-z][a-z\d\+\-\.]*:)?\/\//i.test(e)}},function(e,t,r){"use strict";e.exports=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e}},function(e,t,r){"use strict";var n=r(1),a=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"];e.exports=function(e){var t,r,s,o={};return e?(n.forEach(e.split("\n"),(function(e){if(s=e.indexOf(":"),t=n.trim(e.substr(0,s)).toLowerCase(),r=n.trim(e.substr(s+1)),t){if(o[t]&&a.indexOf(t)>=0)return;o[t]="set-cookie"===t?(o[t]?o[t]:[]).concat([r]):o[t]?o[t]+", "+r:r}})),o):o}},function(e,t,r){"use strict";var n=r(1);e.exports=n.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),r=document.createElement("a");function a(e){var n=e;return t&&(r.setAttribute("href",n),n=r.href),r.setAttribute("href",n),{href:r.href,protocol:r.protocol?r.protocol.replace(/:$/,""):"",host:r.host,search:r.search?r.search.replace(/^\?/,""):"",hash:r.hash?r.hash.replace(/^#/,""):"",hostname:r.hostname,port:r.port,pathname:"/"===r.pathname.charAt(0)?r.pathname:"/"+r.pathname}}return e=a(window.location.href),function(t){var r=n.isString(t)?a(t):t;return r.protocol===e.protocol&&r.host===e.host}}():function(){return!0}},function(e,t,r){"use strict";var n=r(1);e.exports=n.isStandardBrowserEnv()?{write:function(e,t,r,a,s,o){var i=[];i.push(e+"="+encodeURIComponent(t)),n.isNumber(r)&&i.push("expires="+new Date(r).toGMTString()),n.isString(a)&&i.push("path="+a),n.isString(s)&&i.push("domain="+s),!0===o&&i.push("secure"),document.cookie=i.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}}},function(e,t,r){"use strict";var n=r(25);function a(e){if("function"!=typeof e)throw new TypeError("executor must be a function.");var t;this.promise=new Promise((function(e){t=e}));var r=this;e((function(e){r.reason||(r.reason=new n(e),t(r.reason))}))}a.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},a.source=function(){var e;return{token:new a((function(t){e=t})),cancel:e}},e.exports=a},function(e,t,r){"use strict";e.exports=function(e){return function(t){return e.apply(null,t)}}},function(module,exports,__webpack_require__){(function(process,global){var __WEBPACK_AMD_DEFINE_RESULT__;!function(){"use strict";var ERROR="input is invalid type",WINDOW="object"==typeof window,root=WINDOW?window:{};root.JS_SHA256_NO_WINDOW&&(WINDOW=!1);var WEB_WORKER=!WINDOW&&"object"==typeof self,NODE_JS=!root.JS_SHA256_NO_NODE_JS&&"object"==typeof process&&process.versions&&process.versions.node;NODE_JS?root=global:WEB_WORKER&&(root=self);var COMMON_JS=!root.JS_SHA256_NO_COMMON_JS&&"object"==typeof module&&module.exports,AMD=__webpack_require__(53),ARRAY_BUFFER=!root.JS_SHA256_NO_ARRAY_BUFFER&&"undefined"!=typeof ArrayBuffer,HEX_CHARS="0123456789abcdef".split(""),EXTRA=[-2147483648,8388608,32768,128],SHIFT=[24,16,8,0],K=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],OUTPUT_TYPES=["hex","array","digest","arrayBuffer"],blocks=[];!root.JS_SHA256_NO_NODE_JS&&Array.isArray||(Array.isArray=function(e){return"[object Array]"===Object.prototype.toString.call(e)}),!ARRAY_BUFFER||!root.JS_SHA256_NO_ARRAY_BUFFER_IS_VIEW&&ArrayBuffer.isView||(ArrayBuffer.isView=function(e){return"object"==typeof e&&e.buffer&&e.buffer.constructor===ArrayBuffer});var createOutputMethod=function(e,t){return function(r){return new Sha256(t,!0).update(r)[e]()}},createMethod=function(e){var t=createOutputMethod("hex",e);NODE_JS&&(t=nodeWrap(t,e)),t.create=function(){return new Sha256(e)},t.update=function(e){return t.create().update(e)};for(var r=0;r<OUTPUT_TYPES.length;++r){var n=OUTPUT_TYPES[r];t[n]=createOutputMethod(n,e)}return t},nodeWrap=function(method,is224){var crypto=eval("require('crypto')"),Buffer=eval("require('buffer').Buffer"),algorithm=is224?"sha224":"sha256",nodeMethod=function(e){if("string"==typeof e)return crypto.createHash(algorithm).update(e,"utf8").digest("hex");if(null==e)throw new Error(ERROR);return e.constructor===ArrayBuffer&&(e=new Uint8Array(e)),Array.isArray(e)||ArrayBuffer.isView(e)||e.constructor===Buffer?crypto.createHash(algorithm).update(new Buffer(e)).digest("hex"):method(e)};return nodeMethod},createHmacOutputMethod=function(e,t){return function(r,n){return new HmacSha256(r,t,!0).update(n)[e]()}},createHmacMethod=function(e){var t=createHmacOutputMethod("hex",e);t.create=function(t){return new HmacSha256(t,e)},t.update=function(e,r){return t.create(e).update(r)};for(var r=0;r<OUTPUT_TYPES.length;++r){var n=OUTPUT_TYPES[r];t[n]=createHmacOutputMethod(n,e)}return t};function Sha256(e,t){t?(blocks[0]=blocks[16]=blocks[1]=blocks[2]=blocks[3]=blocks[4]=blocks[5]=blocks[6]=blocks[7]=blocks[8]=blocks[9]=blocks[10]=blocks[11]=blocks[12]=blocks[13]=blocks[14]=blocks[15]=0,this.blocks=blocks):this.blocks=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],e?(this.h0=3238371032,this.h1=914150663,this.h2=812702999,this.h3=4144912697,this.h4=4290775857,this.h5=1750603025,this.h6=1694076839,this.h7=3204075428):(this.h0=1779033703,this.h1=3144134277,this.h2=1013904242,this.h3=2773480762,this.h4=1359893119,this.h5=2600822924,this.h6=528734635,this.h7=1541459225),this.block=this.start=this.bytes=this.hBytes=0,this.finalized=this.hashed=!1,this.first=!0,this.is224=e}function HmacSha256(e,t,r){var n,a=typeof e;if("string"===a){var s,o=[],i=e.length,u=0;for(n=0;n<i;++n)(s=e.charCodeAt(n))<128?o[u++]=s:s<2048?(o[u++]=192|s>>6,o[u++]=128|63&s):s<55296||s>=57344?(o[u++]=224|s>>12,o[u++]=128|s>>6&63,o[u++]=128|63&s):(s=65536+((1023&s)<<10|1023&e.charCodeAt(++n)),o[u++]=240|s>>18,o[u++]=128|s>>12&63,o[u++]=128|s>>6&63,o[u++]=128|63&s);e=o}else{if("object"!==a)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR)}e.length>64&&(e=new Sha256(t,!0).update(e).array());var c=[],l=[];for(n=0;n<64;++n){var d=e[n]||0;c[n]=92^d,l[n]=54^d}Sha256.call(this,t,r),this.update(l),this.oKeyPad=c,this.inner=!0,this.sharedMemory=r}Sha256.prototype.update=function(e){if(!this.finalized){var t,r=typeof e;if("string"!==r){if("object"!==r)throw new Error(ERROR);if(null===e)throw new Error(ERROR);if(ARRAY_BUFFER&&e.constructor===ArrayBuffer)e=new Uint8Array(e);else if(!(Array.isArray(e)||ARRAY_BUFFER&&ArrayBuffer.isView(e)))throw new Error(ERROR);t=!0}for(var n,a,s=0,o=e.length,i=this.blocks;s<o;){if(this.hashed&&(this.hashed=!1,i[0]=this.block,i[16]=i[1]=i[2]=i[3]=i[4]=i[5]=i[6]=i[7]=i[8]=i[9]=i[10]=i[11]=i[12]=i[13]=i[14]=i[15]=0),t)for(a=this.start;s<o&&a<64;++s)i[a>>2]|=e[s]<<SHIFT[3&a++];else for(a=this.start;s<o&&a<64;++s)(n=e.charCodeAt(s))<128?i[a>>2]|=n<<SHIFT[3&a++]:n<2048?(i[a>>2]|=(192|n>>6)<<SHIFT[3&a++],i[a>>2]|=(128|63&n)<<SHIFT[3&a++]):n<55296||n>=57344?(i[a>>2]|=(224|n>>12)<<SHIFT[3&a++],i[a>>2]|=(128|n>>6&63)<<SHIFT[3&a++],i[a>>2]|=(128|63&n)<<SHIFT[3&a++]):(n=65536+((1023&n)<<10|1023&e.charCodeAt(++s)),i[a>>2]|=(240|n>>18)<<SHIFT[3&a++],i[a>>2]|=(128|n>>12&63)<<SHIFT[3&a++],i[a>>2]|=(128|n>>6&63)<<SHIFT[3&a++],i[a>>2]|=(128|63&n)<<SHIFT[3&a++]);this.lastByteIndex=a,this.bytes+=a-this.start,a>=64?(this.block=i[16],this.start=a-64,this.hash(),this.hashed=!0):this.start=a}return this.bytes>4294967295&&(this.hBytes+=this.bytes/4294967296<<0,this.bytes=this.bytes%4294967296),this}},Sha256.prototype.finalize=function(){if(!this.finalized){this.finalized=!0;var e=this.blocks,t=this.lastByteIndex;e[16]=this.block,e[t>>2]|=EXTRA[3&t],this.block=e[16],t>=56&&(this.hashed||this.hash(),e[0]=this.block,e[16]=e[1]=e[2]=e[3]=e[4]=e[5]=e[6]=e[7]=e[8]=e[9]=e[10]=e[11]=e[12]=e[13]=e[14]=e[15]=0),e[14]=this.hBytes<<3|this.bytes>>>29,e[15]=this.bytes<<3,this.hash()}},Sha256.prototype.hash=function(){var e,t,r,n,a,s,o,i,u,c=this.h0,l=this.h1,d=this.h2,h=this.h3,p=this.h4,f=this.h5,g=this.h6,m=this.h7,C=this.blocks;for(e=16;e<64;++e)t=((a=C[e-15])>>>7|a<<25)^(a>>>18|a<<14)^a>>>3,r=((a=C[e-2])>>>17|a<<15)^(a>>>19|a<<13)^a>>>10,C[e]=C[e-16]+t+C[e-7]+r<<0;for(u=l&d,e=0;e<64;e+=4)this.first?(this.is224?(s=300032,m=(a=C[0]-1413257819)-150054599<<0,h=a+24177077<<0):(s=704751109,m=(a=C[0]-210244248)-1521486534<<0,h=a+143694565<<0),this.first=!1):(t=(c>>>2|c<<30)^(c>>>13|c<<19)^(c>>>22|c<<10),n=(s=c&l)^c&d^u,m=h+(a=m+(r=(p>>>6|p<<26)^(p>>>11|p<<21)^(p>>>25|p<<7))+(p&f^~p&g)+K[e]+C[e])<<0,h=a+(t+n)<<0),t=(h>>>2|h<<30)^(h>>>13|h<<19)^(h>>>22|h<<10),n=(o=h&c)^h&l^s,g=d+(a=g+(r=(m>>>6|m<<26)^(m>>>11|m<<21)^(m>>>25|m<<7))+(m&p^~m&f)+K[e+1]+C[e+1])<<0,t=((d=a+(t+n)<<0)>>>2|d<<30)^(d>>>13|d<<19)^(d>>>22|d<<10),n=(i=d&h)^d&c^o,f=l+(a=f+(r=(g>>>6|g<<26)^(g>>>11|g<<21)^(g>>>25|g<<7))+(g&m^~g&p)+K[e+2]+C[e+2])<<0,t=((l=a+(t+n)<<0)>>>2|l<<30)^(l>>>13|l<<19)^(l>>>22|l<<10),n=(u=l&d)^l&h^i,p=c+(a=p+(r=(f>>>6|f<<26)^(f>>>11|f<<21)^(f>>>25|f<<7))+(f&g^~f&m)+K[e+3]+C[e+3])<<0,c=a+(t+n)<<0;this.h0=this.h0+c<<0,this.h1=this.h1+l<<0,this.h2=this.h2+d<<0,this.h3=this.h3+h<<0,this.h4=this.h4+p<<0,this.h5=this.h5+f<<0,this.h6=this.h6+g<<0,this.h7=this.h7+m<<0},Sha256.prototype.hex=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,a=this.h4,s=this.h5,o=this.h6,i=this.h7,u=HEX_CHARS[e>>28&15]+HEX_CHARS[e>>24&15]+HEX_CHARS[e>>20&15]+HEX_CHARS[e>>16&15]+HEX_CHARS[e>>12&15]+HEX_CHARS[e>>8&15]+HEX_CHARS[e>>4&15]+HEX_CHARS[15&e]+HEX_CHARS[t>>28&15]+HEX_CHARS[t>>24&15]+HEX_CHARS[t>>20&15]+HEX_CHARS[t>>16&15]+HEX_CHARS[t>>12&15]+HEX_CHARS[t>>8&15]+HEX_CHARS[t>>4&15]+HEX_CHARS[15&t]+HEX_CHARS[r>>28&15]+HEX_CHARS[r>>24&15]+HEX_CHARS[r>>20&15]+HEX_CHARS[r>>16&15]+HEX_CHARS[r>>12&15]+HEX_CHARS[r>>8&15]+HEX_CHARS[r>>4&15]+HEX_CHARS[15&r]+HEX_CHARS[n>>28&15]+HEX_CHARS[n>>24&15]+HEX_CHARS[n>>20&15]+HEX_CHARS[n>>16&15]+HEX_CHARS[n>>12&15]+HEX_CHARS[n>>8&15]+HEX_CHARS[n>>4&15]+HEX_CHARS[15&n]+HEX_CHARS[a>>28&15]+HEX_CHARS[a>>24&15]+HEX_CHARS[a>>20&15]+HEX_CHARS[a>>16&15]+HEX_CHARS[a>>12&15]+HEX_CHARS[a>>8&15]+HEX_CHARS[a>>4&15]+HEX_CHARS[15&a]+HEX_CHARS[s>>28&15]+HEX_CHARS[s>>24&15]+HEX_CHARS[s>>20&15]+HEX_CHARS[s>>16&15]+HEX_CHARS[s>>12&15]+HEX_CHARS[s>>8&15]+HEX_CHARS[s>>4&15]+HEX_CHARS[15&s]+HEX_CHARS[o>>28&15]+HEX_CHARS[o>>24&15]+HEX_CHARS[o>>20&15]+HEX_CHARS[o>>16&15]+HEX_CHARS[o>>12&15]+HEX_CHARS[o>>8&15]+HEX_CHARS[o>>4&15]+HEX_CHARS[15&o];return this.is224||(u+=HEX_CHARS[i>>28&15]+HEX_CHARS[i>>24&15]+HEX_CHARS[i>>20&15]+HEX_CHARS[i>>16&15]+HEX_CHARS[i>>12&15]+HEX_CHARS[i>>8&15]+HEX_CHARS[i>>4&15]+HEX_CHARS[15&i]),u},Sha256.prototype.toString=Sha256.prototype.hex,Sha256.prototype.digest=function(){this.finalize();var e=this.h0,t=this.h1,r=this.h2,n=this.h3,a=this.h4,s=this.h5,o=this.h6,i=this.h7,u=[e>>24&255,e>>16&255,e>>8&255,255&e,t>>24&255,t>>16&255,t>>8&255,255&t,r>>24&255,r>>16&255,r>>8&255,255&r,n>>24&255,n>>16&255,n>>8&255,255&n,a>>24&255,a>>16&255,a>>8&255,255&a,s>>24&255,s>>16&255,s>>8&255,255&s,o>>24&255,o>>16&255,o>>8&255,255&o];return this.is224||u.push(i>>24&255,i>>16&255,i>>8&255,255&i),u},Sha256.prototype.array=Sha256.prototype.digest,Sha256.prototype.arrayBuffer=function(){this.finalize();var e=new ArrayBuffer(this.is224?28:32),t=new DataView(e);return t.setUint32(0,this.h0),t.setUint32(4,this.h1),t.setUint32(8,this.h2),t.setUint32(12,this.h3),t.setUint32(16,this.h4),t.setUint32(20,this.h5),t.setUint32(24,this.h6),this.is224||t.setUint32(28,this.h7),e},HmacSha256.prototype=new Sha256,HmacSha256.prototype.finalize=function(){if(Sha256.prototype.finalize.call(this),this.inner){this.inner=!1;var e=this.array();Sha256.call(this,this.is224,this.sharedMemory),this.update(this.oKeyPad),this.update(e),Sha256.prototype.finalize.call(this)}};var exports=createMethod();exports.sha256=exports,exports.sha224=createMethod(!0),exports.sha256.hmac=createHmacMethod(),exports.sha224.hmac=createHmacMethod(!0),COMMON_JS?module.exports=exports:(root.sha256=exports.sha256,root.sha224=exports.sha224,AMD&&(__WEBPACK_AMD_DEFINE_RESULT__=function(){return exports}.call(exports,__webpack_require__,exports,module),void 0===__WEBPACK_AMD_DEFINE_RESULT__||(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()}).call(this,__webpack_require__(21),__webpack_require__(52))},function(e,t){var r;r=function(){return this}();try{r=r||new Function("return this")()}catch(e){"object"==typeof window&&(r=window)}e.exports=r},function(e,t){(function(t){e.exports=t}).call(this,{})},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.UserApiService=void 0;const n=r(0),a=r(8);t.UserApiService=class{constructor(e){this.sdkconfig=null,this.sdkconfig=e}getUserInfo(e){return a.BaseApiService.postRequest(n.UserApiConstants.get_UserLoginUrl(this.sdkconfig),e,this.sdkconfig)}forgetPassword(e){return a.BaseApiService.postRequest(n.UserApiConstants.get_ForgetPasswordUrl(this.sdkconfig),e,this.sdkconfig)}changePassword(e){return a.BaseApiService.postRequest(n.UserApiConstants.get_ChangePasswordUrl(this.sdkconfig),e,this.sdkconfig)}getChatUsers(e){let t=n.UserApiConstants.get_ChatUserUrl(this.sdkconfig);return null!=e&&null!=e.lastId&&""!=e.lastId?t=t+"?lastId="+e.lastId:null!=e&&null!=e.updateType&&""!=e.updateType&&e.lastCallTime>0&&(t=t+"?updateType="+e.updateType+"&lastCallTime="+e.lastCallTime),a.BaseApiService.getRequest(t,this.sdkconfig)}refreshToken(){return a.BaseApiService.getRequest(n.UserApiConstants.get_RefreshTokenUrl(this.sdkconfig),this.sdkconfig)}logout(e){return a.BaseApiService.postRequest(n.UserApiConstants.get_LogoutUrl(this.sdkconfig),e,this.sdkconfig)}UpdateUser(e){return a.BaseApiService.postFormDataRequest(n.UserApiConstants.get_UpdateUserUrl(this.sdkconfig),e,this.sdkconfig)}}},function(e,t,r){"use strict";r.r(t);var n=function(){return(n=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var a in t=arguments[r])Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a]);return e}).apply(this,arguments)};function a(){for(var e=0,t=0,r=arguments.length;t<r;t++)e+=arguments[t].length;var n=Array(e),a=0;for(t=0;t<r;t++)for(var s=arguments[t],o=0,i=s.length;o<i;o++,a++)n[a]=s[o];return n}var s=Object.keys,o=Array.isArray,i="undefined"!=typeof self?self:"undefined"!=typeof window?window:global;function u(e,t){return"object"!=typeof t||s(t).forEach((function(r){e[r]=t[r]})),e}"undefined"==typeof Promise||i.Promise||(i.Promise=Promise);var c=Object.getPrototypeOf,l={}.hasOwnProperty;function d(e,t){return l.call(e,t)}function h(e,t){"function"==typeof t&&(t=t(c(e))),s(t).forEach((function(r){f(e,r,t[r])}))}var p=Object.defineProperty;function f(e,t,r,n){p(e,t,u(r&&d(r,"get")&&"function"==typeof r.get?{get:r.get,set:r.set,configurable:!0}:{value:r,configurable:!0,writable:!0},n))}function g(e){return{from:function(t){return e.prototype=Object.create(t.prototype),f(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}var m=Object.getOwnPropertyDescriptor;var C=[].slice;function v(e,t,r){return C.call(e,t,r)}function y(e,t){return t(e)}function S(e){if(!e)throw new Error("Assertion Failed")}function _(e){i.setImmediate?setImmediate(e):setTimeout(e,0)}function b(e,t){return e.reduce((function(e,r,n){var a=t(r,n);return a&&(e[a[0]]=a[1]),e}),{})}function T(e,t){if(d(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var r=[],n=0,a=t.length;n<a;++n){var s=T(e,t[n]);r.push(s)}return r}var o=t.indexOf(".");if(-1!==o){var i=e[t.substr(0,o)];return void 0===i?void 0:T(i,t.substr(o+1))}}function I(e,t,r){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){S("string"!=typeof r&&"length"in r);for(var n=0,a=t.length;n<a;++n)I(e,t[n],r[n])}else{var s=t.indexOf(".");if(-1!==s){var i=t.substr(0,s),u=t.substr(s+1);if(""===u)void 0===r?o(e)&&!isNaN(parseInt(i))?e.splice(i,1):delete e[i]:e[i]=r;else{var c=e[i];c||(c=e[i]={}),I(c,u,r)}}else void 0===r?o(e)&&!isNaN(parseInt(t))?e.splice(t,1):delete e[t]:e[t]=r}}function R(e){var t={};for(var r in e)d(e,r)&&(t[r]=e[r]);return t}var A=[].concat;function E(e){return A.apply([],e)}var U="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(E([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return i[e]})),M=U.map((function(e){return i[e]})),w=b(U,(function(e){return[e,!0]}));function k(e){if(!e||"object"!=typeof e)return e;var t;if(o(e)){t=[];for(var r=0,n=e.length;r<n;++r)t.push(k(e[r]))}else if(M.indexOf(e.constructor)>=0)t=e;else for(var a in t=e.constructor?Object.create(e.constructor.prototype):{},e)d(e,a)&&(t[a]=k(e[a]));return t}var D={}.toString;function H(e){return D.call(e).slice(8,-1)}var O=function(e,t){return"Array"===t?""+e.map((function(e){return O(e,H(e))})):"ArrayBuffer"===t?""+new Uint8Array(e):"Date"===t?e.getTime():ArrayBuffer.isView(e)?""+new Uint8Array(e.buffer):e};function P(e,t,r,n){return r=r||{},n=n||"",s(e).forEach((function(a){if(d(t,a)){var s=e[a],o=t[a];if("object"==typeof s&&"object"==typeof o&&s&&o){var i=H(s),u=H(o);i===u?w[i]?O(s,i)!==O(o,u)&&(r[n+a]=t[a]):P(s,o,r,n+a+"."):r[n+a]=t[a]}else s!==o&&(r[n+a]=t[a])}else r[n+a]=void 0})),s(t).forEach((function(a){d(e,a)||(r[n+a]=t[a])})),r}var x="undefined"!=typeof Symbol&&Symbol.iterator,G=x?function(e){var t;return null!=e&&(t=e[x])&&t.apply(e)}:function(){return null},L={};function F(e){var t,r,n,a;if(1===arguments.length){if(o(e))return e.slice();if(this===L&&"string"==typeof e)return[e];if(a=G(e)){for(r=[];!(n=a.next()).done;)r.push(n.value);return r}if(null==e)return[e];if("number"==typeof(t=e.length)){for(r=new Array(t);t--;)r[t]=e[t];return r}return[e]}for(t=arguments.length,r=new Array(t);t--;)r[t]=arguments[t];return r}var N="undefined"!=typeof Symbol?function(e){return"AsyncFunction"===e[Symbol.toStringTag]}:function(){return!1},j="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function K(e,t){j=e,B=t}var B=function(){return!0},q=!new Error("").stack;function J(){if(q)try{throw new Error}catch(e){return e}return new Error}function X(e,t){var r=e.stack;return r?(t=t||0,0===r.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),r.split("\n").slice(t).filter(B).map((function(e){return"\n"+e})).join("")):""}var z=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],W=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(z),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function Y(e,t){this._e=J(),this.name=e,this.message=t}function Q(e,t){return e+". Errors: "+Object.keys(t).map((function(e){return t[e].toString()})).filter((function(e,t,r){return r.indexOf(e)===t})).join("\n")}function $(e,t,r,n){this._e=J(),this.failures=t,this.failedKeys=n,this.successCount=r,this.message=Q(e,t)}function Z(e,t){this._e=J(),this.name="BulkError",this.failures=t,this.message=Q(e,t)}g(Y).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+X(this._e,2))}},toString:function(){return this.name+": "+this.message}}),g($).from(Y),g(Z).from(Y);var ee=W.reduce((function(e,t){return e[t]=t+"Error",e}),{}),te=Y,re=W.reduce((function(e,t){var r=t+"Error";function n(e,n){this._e=J(),this.name=r,e?"string"==typeof e?(this.message=e+(n?"\n "+n:""),this.inner=n||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=V[t]||r,this.inner=null)}return g(n).from(te),e[t]=n,e}),{});re.Syntax=SyntaxError,re.Type=TypeError,re.Range=RangeError;var ne=z.reduce((function(e,t){return e[t+"Error"]=re[t],e}),{});var ae=W.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=re[t]),e}),{});function se(){}function oe(e){return e}function ie(e,t){return null==e||e===oe?t:function(r){return t(e(r))}}function ue(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function ce(e,t){return e===se?t:function(){var r=e.apply(this,arguments);void 0!==r&&(arguments[0]=r);var n=this.onsuccess,a=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return n&&(this.onsuccess=this.onsuccess?ue(n,this.onsuccess):n),a&&(this.onerror=this.onerror?ue(a,this.onerror):a),void 0!==s?s:r}}function le(e,t){return e===se?t:function(){e.apply(this,arguments);var r=this.onsuccess,n=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),r&&(this.onsuccess=this.onsuccess?ue(r,this.onsuccess):r),n&&(this.onerror=this.onerror?ue(n,this.onerror):n)}}function de(e,t){return e===se?t:function(r){var n=e.apply(this,arguments);u(r,n);var a=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var o=t.apply(this,arguments);return a&&(this.onsuccess=this.onsuccess?ue(a,this.onsuccess):a),s&&(this.onerror=this.onerror?ue(s,this.onerror):s),void 0===n?void 0===o?void 0:o:u(n,o)}}function he(e,t){return e===se?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function pe(e,t){return e===se?t:function(){var r=e.apply(this,arguments);if(r&&"function"==typeof r.then){for(var n=this,a=arguments.length,s=new Array(a);a--;)s[a]=arguments[a];return r.then((function(){return t.apply(n,s)}))}return t.apply(this,arguments)}}ae.ModifyError=$,ae.DexieError=Y,ae.BulkError=Z;var fe={},ge="undefined"==typeof Promise?[]:function(){var e=Promise.resolve();if("undefined"==typeof crypto||!crypto.subtle)return[e,e.__proto__,e];var t=crypto.subtle.digest("SHA-512",new Uint8Array([0]));return[t,t.__proto__,e]}(),me=ge[0],Ce=ge[1],ve=ge[2],ye=Ce&&Ce.then,Se=me&&me.constructor,_e=!!ve,be=!1,Te=ve?function(){ve.then(Je)}:i.setImmediate?setImmediate.bind(null,Je):i.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){Je(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(Je,0)},Ie=function(e,t){He.push([e,t]),Ae&&(Te(),Ae=!1)},Re=!0,Ae=!0,Ee=[],Ue=[],Me=null,we=oe,ke={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ft,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{ft(e[0],e[1])}catch(e){}}))}},De=ke,He=[],Oe=0,Pe=[];function xe(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=se,this._lib=!1;var t=this._PSD=De;if(j&&(this._stackHolder=J(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==fe)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ne(this,this._value))}this._state=null,this._value=null,++t.ref,Fe(this,e)}var Ge={get:function(){var e=De,t=tt;function r(r,n){var a=this,s=!e.global&&(e!==De||t!==tt);s&&st();var o=new xe((function(t,o){Ke(a,new Le(ht(r,e,s),ht(n,e,s),t,o,e))}));return j&&qe(o,this),o}return r.prototype=fe,r},set:function(e){f(this,"then",e&&e.prototype===fe?Ge:{get:function(){return e},set:Ge.set})}};function Le(e,t,r,n,a){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=r,this.reject=n,this.psd=a}function Fe(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var r=e._lib&&Xe();t&&"function"==typeof t.then?Fe(e,(function(e,r){t instanceof xe?t._then(e,r):t.then(e,r)})):(e._state=!0,e._value=t,je(e)),r&&ze()}}),Ne.bind(null,e))}catch(t){Ne(e,t)}}function Ne(e,t){if(Ue.push(t),null===e._state){var r=e._lib&&Xe();t=we(t),e._state=!1,e._value=t,j&&null!==t&&"object"==typeof t&&!t._promise&&function(e,t,r){try{e.apply(null,r)}catch(e){t&&t(e)}}((function(){var r=function e(t,r){var n;return m(t,r)||(n=c(t))&&e(n,r)}(t,"stack");t._promise=e,f(t,"stack",{get:function(){return be?r&&(r.get?r.get.apply(t):r.value):e.stack}})})),function(e){Ee.some((function(t){return t._value===e._value}))||Ee.push(e)}(e),je(e),r&&ze()}}function je(e){var t=e._listeners;e._listeners=[];for(var r=0,n=t.length;r<n;++r)Ke(e,t[r]);var a=e._PSD;--a.ref||a.finalize(),0===Oe&&(++Oe,Ie((function(){0==--Oe&&We()}),[]))}function Ke(e,t){if(null!==e._state){var r=e._state?t.onFulfilled:t.onRejected;if(null===r)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Oe,Ie(Be,[r,e,t])}else e._listeners.push(t)}function Be(e,t,r){try{Me=t;var n,a=t._value;t._state?n=e(a):(Ue.length&&(Ue=[]),n=e(a),-1===Ue.indexOf(a)&&function(e){var t=Ee.length;for(;t;)if(Ee[--t]._value===e._value)return void Ee.splice(t,1)}(t)),r.resolve(n)}catch(e){r.reject(e)}finally{Me=null,0==--Oe&&We(),--r.psd.ref||r.psd.finalize()}}function qe(e,t){var r=t?t._numPrev+1:0;r<100&&(e._prev=t,e._numPrev=r)}function Je(){Xe()&&ze()}function Xe(){var e=Re;return Re=!1,Ae=!1,e}function ze(){var e,t,r;do{for(;He.length>0;)for(e=He,He=[],r=e.length,t=0;t<r;++t){var n=e[t];n[0].apply(null,n[1])}}while(He.length>0);Re=!0,Ae=!0}function We(){var e=Ee;Ee=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Pe.slice(0),r=t.length;r;)t[--r]()}function Ve(e){return new xe(fe,!1,e)}function Ye(e,t){var r=De;return function(){var n=Xe(),a=De;try{return ct(r,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{ct(a,!1),n&&ze()}}}h(xe.prototype,{then:Ge,_then:function(e,t){Ke(this,new Le(null,null,e,t,De))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],r=arguments[1];return"function"==typeof t?this.then(null,(function(e){return e instanceof t?r(e):Ve(e)})):this.then(null,(function(e){return e&&e.name===t?r(e):Ve(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),Ve(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{be=!0;var e=function e(t,r,n){if(r.length===n)return r;var a="";if(!1===t._state){var s,o,i=t._value;null!=i?(s=i.name||"Error",o=i.message||i,a=X(i,0)):(s=i,o=""),r.push(s+(o?": "+o:"")+a)}j&&((a=X(t._stackHolder,2))&&-1===r.indexOf(a)&&r.push(a),t._prev&&e(t._prev,r,n));return r}(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{be=!1}}},timeout:function(e,t){var r=this;return e<1/0?new xe((function(n,a){var s=setTimeout((function(){return a(new re.Timeout(t))}),e);r.then(n,a).finally(clearTimeout.bind(null,s))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&f(xe.prototype,Symbol.toStringTag,"Dexie.Promise"),ke.env=lt(),h(xe,{all:function(){var e=F.apply(null,arguments).map(ot);return new xe((function(t,r){0===e.length&&t([]);var n=e.length;e.forEach((function(a,s){return xe.resolve(a).then((function(r){e[s]=r,--n||t(e)}),r)}))}))},resolve:function(e){if(e instanceof xe)return e;if(e&&"function"==typeof e.then)return new xe((function(t,r){e.then(t,r)}));var t=new xe(fe,!0,e);return qe(t,Me),t},reject:Ve,race:function(){var e=F.apply(null,arguments).map(ot);return new xe((function(t,r){e.map((function(e){return xe.resolve(e).then(t,r)}))}))},PSD:{get:function(){return De},set:function(e){return De=e}},newPSD:nt,usePSD:dt,scheduler:{get:function(){return Ie},set:function(e){Ie=e}},rejectionMapper:{get:function(){return we},set:function(e){we=e}},follow:function(e,t){return new xe((function(r,n){return nt((function(t,r){var n=De;n.unhandleds=[],n.onunhandled=r,n.finalize=ue((function(){var e=this;!function(e){Pe.push((function t(){e(),Pe.splice(Pe.indexOf(t),1)})),++Oe,Ie((function(){0==--Oe&&We()}),[])}((function(){0===e.unhandleds.length?t():r(e.unhandleds[0])}))}),n.finalize),e()}),t,r,n)}))}}),Se&&(Se.allSettled&&f(xe,"allSettled",(function(){var e=F.apply(null,arguments).map(ot);return new xe((function(t){0===e.length&&t([]);var r=e.length,n=new Array(r);e.forEach((function(e,a){return xe.resolve(e).then((function(e){return n[a]={status:"fulfilled",value:e}}),(function(e){return n[a]={status:"rejected",reason:e}})).then((function(){return--r||t(n)}))}))}))})),Se.any&&"undefined"!=typeof AggregateError&&f(xe,"any",(function(){var e=F.apply(null,arguments).map(ot);return new xe((function(t,r){0===e.length&&r(new AggregateError([]));var n=e.length,a=new Array(n);e.forEach((function(e,s){return xe.resolve(e).then((function(e){return t(e)}),(function(e){a[s]=e,--n||r(new AggregateError(a))}))}))}))})));var Qe={awaits:0,echoes:0,id:0},$e=0,Ze=[],et=0,tt=0,rt=0;function nt(e,t,r,n){var a=De,s=Object.create(a);s.parent=a,s.ref=0,s.global=!1,s.id=++rt;var o=ke.env;s.env=_e?{Promise:xe,PromiseProp:{value:xe,configurable:!0,writable:!0},all:xe.all,race:xe.race,allSettled:xe.allSettled,any:xe.any,resolve:xe.resolve,reject:xe.reject,nthen:pt(o.nthen,s),gthen:pt(o.gthen,s)}:{},t&&u(s,t),++a.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var i=dt(s,e,r,n);return 0===s.ref&&s.finalize(),i}function at(){return Qe.id||(Qe.id=++$e),++Qe.awaits,Qe.echoes+=100,Qe.id}function st(e){!Qe.awaits||e&&e!==Qe.id||(0==--Qe.awaits&&(Qe.id=0),Qe.echoes=100*Qe.awaits)}function ot(e){return Qe.echoes&&e&&e.constructor===Se?(at(),e.then((function(e){return st(),e}),(function(e){return st(),gt(e)}))):e}function it(e){++tt,Qe.echoes&&0!=--Qe.echoes||(Qe.echoes=Qe.id=0),Ze.push(De),ct(e,!0)}function ut(){var e=Ze[Ze.length-1];Ze.pop(),ct(e,!1)}function ct(e,t){var r,n=De;if((t?!Qe.echoes||et++&&e===De:!et||--et&&e===De)||(r=t?it.bind(null,e):ut,ye.call(me,r)),e!==De&&(De=e,n===ke&&(ke.env=lt()),_e)){var a=ke.env.Promise,s=e.env;Ce.then=s.nthen,a.prototype.then=s.gthen,(n.global||e.global)&&(Object.defineProperty(i,"Promise",s.PromiseProp),a.all=s.all,a.race=s.race,a.resolve=s.resolve,a.reject=s.reject,s.allSettled&&(a.allSettled=s.allSettled),s.any&&(a.any=s.any))}}function lt(){var e=i.Promise;return _e?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(i,"Promise"),all:e.all,race:e.race,allSettled:e.allSettled,any:e.any,resolve:e.resolve,reject:e.reject,nthen:Ce.then,gthen:e.prototype.then}:{}}function dt(e,t,r,n,a){var s=De;try{return ct(e,!0),t(r,n,a)}finally{ct(s,!1)}}function ht(e,t,r){return"function"!=typeof e?e:function(){var n=De;r&&at(),ct(t,!0);try{return e.apply(this,arguments)}finally{ct(n,!1)}}}function pt(e,t){return function(r,n){return e.call(this,ht(r,t,!1),ht(n,t,!1))}}-1===(""+ye).indexOf("[native code]")&&(at=st=se);function ft(e,t){var r;try{r=t.onuncatched(e)}catch(e){}if(!1!==r)try{var n,a={promise:t,reason:e};if(i.document&&document.createEvent?((n=document.createEvent("Event")).initEvent("unhandledrejection",!0,!0),u(n,a)):i.CustomEvent&&u(n=new CustomEvent("unhandledrejection",{detail:a}),a),n&&i.dispatchEvent&&(dispatchEvent(n),!i.PromiseRejectionEvent&&i.onunhandledrejection))try{i.onunhandledrejection(n)}catch(e){}j&&n&&!n.defaultPrevented&&console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var gt=xe.reject;var mt=String.fromCharCode(65535),Ct="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",vt=[],yt="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),St=yt,_t=yt,bt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};function Tt(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}var It={type:3,lower:-1/0,lowerOpen:!1,upper:[[]],upperOpen:!1},Rt=function(){function e(){}return e.prototype._trans=function(e,t,r){var n=this._tx||De.trans,a=this.name;function s(e,r,n){if(!n.schema[a])throw new re.NotFound("Table "+a+" not part of transaction");return t(n.idbtrans,n)}var o=Xe();try{return n&&n.db===this.db?n===De.trans?n._promise(e,s,r):nt((function(){return n._promise(e,s,r)}),{trans:n,transless:De.transless||De}):function e(t,r,n,a){if(t._state.openComplete||De.letThrough){var s=t._createTransaction(r,n,t._dbSchema);try{s.create()}catch(e){return gt(e)}return s._promise(r,(function(e,t){return nt((function(){return De.trans=s,a(e,t,s)}))})).then((function(e){return s._completion.then((function(){return e}))}))}if(!t._state.isBeingOpened){if(!t._options.autoOpen)return gt(new re.DatabaseClosed);t.open().catch(se)}return t._state.dbReadyPromise.then((function(){return e(t,r,n,a)}))}(this.db,e,[this.name],s)}finally{o&&ze()}},e.prototype.get=function(e,t){var r=this;return e&&e.constructor===Object?this.where(e).first(t):this._trans("readonly",(function(t){return r.core.get({trans:t,key:e}).then((function(e){return r.hook.reading.fire(e)}))})).then(t)},e.prototype.where=function(e){if("string"==typeof e)return new this.db.WhereClause(this,e);if(o(e))return new this.db.WhereClause(this,"["+e.join("+")+"]");var t=s(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var r=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(r&&this.db._maxKey!==mt)return this.where(r.name).equals(r.keyPath.map((function(t){return e[t]})));!r&&j&&console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var n=this.schema.idxByName,a=this.db._deps.indexedDB;function i(e,t){try{return 0===a.cmp(e,t)}catch(e){return!1}}var u=t.reduce((function(t,r){var a=t[0],s=t[1],u=n[r],c=e[r];return[a||u,a||!u?Tt(s,u&&u.multi?function(e){var t=T(e,r);return o(t)&&t.some((function(e){return i(c,e)}))}:function(e){return i(c,T(e,r))}):s]}),[null,null]),c=u[0],l=u[1];return c?this.where(c.name).equals(e[c.keyPath]).filter(l):r?this.filter(l):this.where(t).equals("")},e.prototype.filter=function(e){return this.toCollection().and(e)},e.prototype.count=function(e){return this.toCollection().count(e)},e.prototype.offset=function(e){return this.toCollection().offset(e)},e.prototype.limit=function(e){return this.toCollection().limit(e)},e.prototype.each=function(e){return this.toCollection().each(e)},e.prototype.toArray=function(e){return this.toCollection().toArray(e)},e.prototype.toCollection=function(){return new this.db.Collection(new this.db.WhereClause(this))},e.prototype.orderBy=function(e){return new this.db.Collection(new this.db.WhereClause(this,o(e)?"["+e.join("+")+"]":e))},e.prototype.reverse=function(){return this.toCollection().reverse()},e.prototype.mapToClass=function(e){this.schema.mappedClass=e;var t=function(t){if(!t)return t;var r=Object.create(e.prototype);for(var n in t)if(d(t,n))try{r[n]=t[n]}catch(e){}return r};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=t,this.hook("reading",t),e},e.prototype.defineClass=function(){return this.mapToClass((function(e){u(this,e)}))},e.prototype.add=function(e,t){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"add",keys:null!=t?[t]:null,values:[e]})})).then((function(e){return e.numFailures?xe.reject(e.failures[0]):e.lastResult})).then((function(t){if(!r.core.schema.primaryKey.outbound)try{I(e,r.core.schema.primaryKey.keyPath,t)}catch(e){}return t}))},e.prototype.update=function(e,t){if("object"!=typeof t||o(t))throw new re.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||o(e))return this.where(":id").equals(e).modify(t);s(t).forEach((function(r){I(e,r,t[r])}));var r=T(e,this.schema.primKey.keyPath);return void 0===r?gt(new re.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(r).modify(t)},e.prototype.put=function(e,t){var r=this;return this._trans("readwrite",(function(n){return r.core.mutate({trans:n,type:"put",values:[e],keys:null!=t?[t]:null})})).then((function(e){return e.numFailures?xe.reject(e.failures[0]):e.lastResult})).then((function(t){if(!r.core.schema.primaryKey.outbound)try{I(e,r.core.schema.primaryKey.keyPath,t)}catch(e){}return t}))},e.prototype.delete=function(e){var t=this;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:[e]})})).then((function(e){return e.numFailures?xe.reject(e.failures[0]):void 0}))},e.prototype.clear=function(){var e=this;return this._trans("readwrite",(function(t){return e.core.mutate({trans:t,type:"deleteRange",range:It})})).then((function(e){return e.numFailures?xe.reject(e.failures[0]):void 0}))},e.prototype.bulkGet=function(e){var t=this;return this._trans("readonly",(function(r){return t.core.getMany({keys:e,trans:r})}))},e.prototype.bulkAdd=function(e,t,r){var n=this,a=Array.isArray(t)?t:void 0,s=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){if(!n.core.schema.primaryKey.outbound&&a)throw new re.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var r=e.length;return n.core.mutate({trans:t,type:"add",keys:a,values:e,wantResults:s}).then((function(e){var t=e.numFailures,a=e.results,o=e.lastResult,i=e.failures;if(0===t)return s?a:o;throw new Z(n.name+".bulkAdd(): "+t+" of "+r+" operations failed",Object.keys(i).map((function(e){return i[e]})))}))}))},e.prototype.bulkPut=function(e,t,r){var n=this,a=Array.isArray(t)?t:void 0,s=(r=r||(a?void 0:t))?r.allKeys:void 0;return this._trans("readwrite",(function(t){if(!n.core.schema.primaryKey.outbound&&a)throw new re.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(a&&a.length!==e.length)throw new re.InvalidArgument("Arguments objects and keys must have the same length");var r=e.length;return n.core.mutate({trans:t,type:"put",keys:a,values:e,wantResults:s}).then((function(e){var t=e.numFailures,a=e.results,o=e.lastResult,i=e.failures;if(0===t)return s?a:o;throw new Z(n.name+".bulkPut(): "+t+" of "+r+" operations failed",Object.keys(i).map((function(e){return i[e]})))}))}))},e.prototype.bulkDelete=function(e){var t=this,r=e.length;return this._trans("readwrite",(function(r){return t.core.mutate({trans:r,type:"delete",keys:e})})).then((function(e){var n=e.numFailures,a=e.lastResult,s=e.failures;if(0===n)return a;throw new Z(t.name+".bulkDelete(): "+n+" of "+r+" operations failed",s)}))},e}();function At(e){var t={},r=function(r,n){if(n){for(var a=arguments.length,s=new Array(a-1);--a;)s[a-1]=arguments[a];return t[r].subscribe.apply(null,s),e}if("string"==typeof r)return t[r]};r.addEventType=i;for(var n=1,a=arguments.length;n<a;++n)i(arguments[n]);return r;function i(e,n,a){if("object"==typeof e)return u(e);n||(n=he),a||(a=se);var s={subscribers:[],fire:a,subscribe:function(e){-1===s.subscribers.indexOf(e)&&(s.subscribers.push(e),s.fire=n(s.fire,e))},unsubscribe:function(e){s.subscribers=s.subscribers.filter((function(t){return t!==e})),s.fire=s.subscribers.reduce(n,a)}};return t[e]=r[e]=s,s}function u(e){s(e).forEach((function(t){var r=e[t];if(o(r))i(t,e[t][0],e[t][1]);else{if("asap"!==r)throw new re.InvalidArgument("Invalid event config");var n=i(t,oe,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){_((function(){e.apply(null,t)}))}))}))}}))}}function Et(e,t){return g(t).from({prototype:e}),t}function Ut(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Mt(e,t){e.filter=Tt(e.filter,t)}function wt(e,t,r){var n=e.replayFilter;e.replayFilter=n?function(){return Tt(n(),t())}:t,e.justLimit=r&&!n}function kt(e,t){if(e.isPrimKey)return t.primaryKey;var r=t.getIndexByKeyPath(e.index);if(!r)throw new re.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return r}function Dt(e,t,r){var n=kt(e,t.schema);return t.openCursor({trans:r,values:!e.keysOnly,reverse:"prev"===e.dir,unique:!!e.unique,query:{index:n,range:e.range}})}function Ht(e,t,r,n){var a=e.replayFilter?Tt(e.filter,e.replayFilter()):e.filter;if(e.or){var s={},o=function(e,r,n){if(!a||a(r,n,(function(e){return r.stop(e)}),(function(e){return r.fail(e)}))){var o=r.primaryKey,i=""+o;"[object ArrayBuffer]"===i&&(i=""+new Uint8Array(o)),d(s,i)||(s[i]=!0,t(e,r,n))}};return Promise.all([e.or._iterate(o,r),Ot(Dt(e,n,r),e.algorithm,o,!e.keysOnly&&e.valueMapper)])}return Ot(Dt(e,n,r),Tt(e.algorithm,a),t,!e.keysOnly&&e.valueMapper)}function Ot(e,t,r,n){var a=Ye(n?function(e,t,a){return r(n(e),t,a)}:r);return e.then((function(e){if(e)return e.start((function(){var r=function(){return e.continue()};t&&!t(e,(function(e){return r=e}),(function(t){e.stop(t),r=se}),(function(t){e.fail(t),r=se}))||a(e.value,e,(function(e){return r=e})),r()}))}))}var Pt=function(){function e(){}return e.prototype._read=function(e,t){var r=this._ctx;return r.error?r.table._trans(null,gt.bind(null,r.error)):r.table._trans("readonly",e).then(t)},e.prototype._write=function(e){var t=this._ctx;return t.error?t.table._trans(null,gt.bind(null,t.error)):t.table._trans("readwrite",e,"locked")},e.prototype._addAlgorithm=function(e){var t=this._ctx;t.algorithm=Tt(t.algorithm,e)},e.prototype._iterate=function(e,t){return Ht(this._ctx,e,t,this._ctx.table.core)},e.prototype.clone=function(e){var t=Object.create(this.constructor.prototype),r=Object.create(this._ctx);return e&&u(r,e),t._ctx=r,t},e.prototype.raw=function(){return this._ctx.valueMapper=null,this},e.prototype.each=function(e){var t=this._ctx;return this._read((function(r){return Ht(t,e,r,t.table.core)}))},e.prototype.count=function(e){var t=this;return this._read((function(e){var r=t._ctx,n=r.table.core;if(Ut(r,!0))return n.count({trans:e,query:{index:kt(r,n.schema),range:r.range}}).then((function(e){return Math.min(e,r.limit)}));var a=0;return Ht(r,(function(){return++a,!1}),e,n).then((function(){return a}))})).then(e)},e.prototype.sortBy=function(e,t){var r=e.split(".").reverse(),n=r[0],a=r.length-1;function s(e,t){return t?s(e[r[t]],t-1):e[n]}var o="next"===this._ctx.dir?1:-1;function i(e,t){var r=s(e,a),n=s(t,a);return r<n?-o:r>n?o:0}return this.toArray((function(e){return e.sort(i)})).then(t)},e.prototype.toArray=function(e){var t=this;return this._read((function(e){var r=t._ctx;if("next"===r.dir&&Ut(r,!0)&&r.limit>0){var n=r.valueMapper,a=kt(r,r.table.core.schema);return r.table.core.query({trans:e,limit:r.limit,values:!0,query:{index:a,range:r.range}}).then((function(e){var t=e.result;return n?t.map(n):t}))}var s=[];return Ht(r,(function(e){return s.push(e)}),e,r.table.core).then((function(){return s}))}),e)},e.prototype.offset=function(e){var t=this._ctx;return e<=0||(t.offset+=e,Ut(t)?wt(t,(function(){var t=e;return function(e,r){return 0===t||(1===t?(--t,!1):(r((function(){e.advance(t),t=0})),!1))}})):wt(t,(function(){var t=e;return function(){return--t<0}}))),this},e.prototype.limit=function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),wt(this._ctx,(function(){var t=e;return function(e,r,n){return--t<=0&&r(n),t>=0}}),!0),this},e.prototype.until=function(e,t){return Mt(this._ctx,(function(r,n,a){return!e(r.value)||(n(a),t)})),this},e.prototype.first=function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},e.prototype.last=function(e){return this.reverse().first(e)},e.prototype.filter=function(e){var t,r;return Mt(this._ctx,(function(t){return e(t.value)})),t=this._ctx,r=e,t.isMatch=Tt(t.isMatch,r),this},e.prototype.and=function(e){return this.filter(e)},e.prototype.or=function(e){return new this.db.WhereClause(this._ctx.table,e,this)},e.prototype.reverse=function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},e.prototype.desc=function(){return this.reverse()},e.prototype.eachKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.key,r)}))},e.prototype.eachUniqueKey=function(e){return this._ctx.unique="unique",this.eachKey(e)},e.prototype.eachPrimaryKey=function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,r){e(r.primaryKey,r)}))},e.prototype.keys=function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.key)})).then((function(){return r})).then(e)},e.prototype.primaryKeys=function(e){var t=this._ctx;if("next"===t.dir&&Ut(t,!0)&&t.limit>0)return this._read((function(e){var r=kt(t,t.table.core.schema);return t.table.core.query({trans:e,values:!1,limit:t.limit,query:{index:r,range:t.range}})})).then((function(e){return e.result})).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)},e.prototype.uniqueKeys=function(e){return this._ctx.unique="unique",this.keys(e)},e.prototype.firstKey=function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},e.prototype.lastKey=function(e){return this.reverse().firstKey(e)},e.prototype.distinct=function(){var e=this._ctx,t=e.index&&e.table.schema.idxByName[e.index];if(!t||!t.multi)return this;var r={};return Mt(this._ctx,(function(e){var t=e.primaryKey.toString(),n=d(r,t);return r[t]=!0,!n})),this},e.prototype.modify=function(e){var t=this,r=this._ctx;return this._write((function(n){var a;if("function"==typeof e)a=e;else{var o=s(e),i=o.length;a=function(t){for(var r=!1,n=0;n<i;++n){var a=o[n],s=e[a];T(t,a)!==s&&(I(t,a,s),r=!0)}return r}}var u=r.table.core,c=u.schema.primaryKey,l=c.outbound,d=c.extractKey,h="testmode"in Rr?1:2e3,p=t.db.core.cmp,f=[],g=0,m=[],C=function(e,t){var r=t.failures,n=t.numFailures;g+=e-n;for(var a=0,o=s(r);a<o.length;a++){var i=o[a];f.push(r[i])}};return t.clone().primaryKeys().then((function(e){var t=function(r){var s=Math.min(h,e.length-r);return u.getMany({trans:n,keys:e.slice(r,r+s)}).then((function(o){for(var i=[],c=[],f=l?[]:null,g=[],m=0;m<s;++m){var v=o[m],y={value:k(v),primKey:e[r+m]};!1!==a.call(y,y.value,y)&&(null==y.value?g.push(e[r+m]):l||0===p(d(v),d(y.value))?(c.push(y.value),l&&f.push(e[r+m])):(g.push(e[r+m]),i.push(y.value)))}return Promise.resolve(i.length>0&&u.mutate({trans:n,type:"add",values:i}).then((function(e){for(var t in e.failures)g.splice(parseInt(t),1);C(i.length,e)}))).then((function(e){return c.length>0&&u.mutate({trans:n,type:"put",keys:f,values:c}).then((function(e){return C(c.length,e)}))})).then((function(){return g.length>0&&u.mutate({trans:n,type:"delete",keys:g}).then((function(e){return C(g.length,e)}))})).then((function(){return e.length>r+s&&t(r+h)}))}))};return t(0).then((function(){if(f.length>0)throw new $("Error modifying one or more objects",f,g,m);return e.length}))}))}))},e.prototype.delete=function(){var e=this._ctx,t=e.range;return Ut(e)&&(e.isPrimKey&&!_t||3===t.type)?this._write((function(r){var n=e.table.core.schema.primaryKey,a=t;return e.table.core.count({trans:r,query:{index:n,range:a}}).then((function(t){return e.table.core.mutate({trans:r,type:"deleteRange",range:a}).then((function(e){var r=e.failures,n=(e.lastResult,e.results,e.numFailures);if(n)throw new $("Could not delete some values",Object.keys(r).map((function(e){return r[e]})),t-n);return t-n}))}))})):this.modify((function(e,t){return t.value=null}))},e}();function xt(e,t){return e<t?-1:e===t?0:1}function Gt(e,t){return e>t?-1:e===t?0:1}function Lt(e,t,r){var n=e instanceof qt?new e.Collection(e):e;return n._ctx.error=r?new r(t):new TypeError(t),n}function Ft(e){return new e.Collection(e,(function(){return Bt("")})).limit(0)}function Nt(e,t,r,n,a,s){for(var o=Math.min(e.length,n.length),i=-1,u=0;u<o;++u){var c=t[u];if(c!==n[u])return a(e[u],r[u])<0?e.substr(0,u)+r[u]+r.substr(u+1):a(e[u],n[u])<0?e.substr(0,u)+n[u]+r.substr(u+1):i>=0?e.substr(0,i)+t[i]+r.substr(i+1):null;a(e[u],c)<0&&(i=u)}return o<n.length&&"next"===s?e+r.substr(e.length):o<e.length&&"prev"===s?e.substr(0,r.length):i<0?null:e.substr(0,i)+n[i]+r.substr(i+1)}function jt(e,t,r,n){var a,s,o,i,u,c,l,d=r.length;if(!r.every((function(e){return"string"==typeof e})))return Lt(e,"String expected.");function h(e){a=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),s=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),o="next"===e?xt:Gt;var t=r.map((function(e){return{lower:s(e),upper:a(e)}})).sort((function(e,t){return o(e.lower,t.lower)}));i=t.map((function(e){return e.upper})),u=t.map((function(e){return e.lower})),c=e,l="next"===e?"":n}h("next");var p=new e.Collection(e,(function(){return Kt(i[0],u[d-1]+n)}));p._ondirectionchange=function(e){h(e)};var f=0;return p._addAlgorithm((function(e,r,n){var a=e.key;if("string"!=typeof a)return!1;var h=s(a);if(t(h,u,f))return!0;for(var p=null,g=f;g<d;++g){var m=Nt(a,h,i[g],u[g],o,c);null===m&&null===p?f=g+1:(null===p||o(p,m)>0)&&(p=m)}return r(null!==p?function(){e.continue(p+l)}:n),!1})),p}function Kt(e,t,r,n){return{type:2,lower:e,upper:t,lowerOpen:r,upperOpen:n}}function Bt(e){return{type:1,lower:e,upper:e}}var qt=function(){function e(){}return Object.defineProperty(e.prototype,"Collection",{get:function(){return this._ctx.table.db.Collection},enumerable:!0,configurable:!0}),e.prototype.between=function(e,t,r,n){r=!1!==r,n=!0===n;try{return this._cmp(e,t)>0||0===this._cmp(e,t)&&(r||n)&&(!r||!n)?Ft(this):new this.Collection(this,(function(){return Kt(e,t,!r,!n)}))}catch(e){return Lt(this,Ct)}},e.prototype.equals=function(e){return new this.Collection(this,(function(){return Bt(e)}))},e.prototype.above=function(e){return null==e?Lt(this,Ct):new this.Collection(this,(function(){return Kt(e,void 0,!0)}))},e.prototype.aboveOrEqual=function(e){return null==e?Lt(this,Ct):new this.Collection(this,(function(){return Kt(e,void 0,!1)}))},e.prototype.below=function(e){return null==e?Lt(this,Ct):new this.Collection(this,(function(){return Kt(void 0,e,!1,!0)}))},e.prototype.belowOrEqual=function(e){return null==e?Lt(this,Ct):new this.Collection(this,(function(){return Kt(void 0,e)}))},e.prototype.startsWith=function(e){return"string"!=typeof e?Lt(this,"String expected."):this.between(e,e+mt,!0,!0)},e.prototype.startsWithIgnoreCase=function(e){return""===e?this.startsWith(e):jt(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],mt)},e.prototype.equalsIgnoreCase=function(e){return jt(this,(function(e,t){return e===t[0]}),[e],"")},e.prototype.anyOfIgnoreCase=function(){var e=F.apply(L,arguments);return 0===e.length?Ft(this):jt(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},e.prototype.startsWithAnyOfIgnoreCase=function(){var e=F.apply(L,arguments);return 0===e.length?Ft(this):jt(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,mt)},e.prototype.anyOf=function(){var e=this,t=F.apply(L,arguments),r=this._cmp;try{t.sort(r)}catch(e){return Lt(this,Ct)}if(0===t.length)return Ft(this);var n=new this.Collection(this,(function(){return Kt(t[0],t[t.length-1])}));n._ondirectionchange=function(n){r="next"===n?e._ascending:e._descending,t.sort(r)};var a=0;return n._addAlgorithm((function(e,n,s){for(var o=e.key;r(o,t[a])>0;)if(++a===t.length)return n(s),!1;return 0===r(o,t[a])||(n((function(){e.continue(t[a])})),!1)})),n},e.prototype.notEqual=function(e){return this.inAnyRange([[-1/0,e],[e,this.db._maxKey]],{includeLowers:!1,includeUppers:!1})},e.prototype.noneOf=function(){var e=F.apply(L,arguments);if(0===e.length)return new this.Collection(this);try{e.sort(this._ascending)}catch(e){return Lt(this,Ct)}var t=e.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[-1/0,t]]}),null);return t.push([e[e.length-1],this.db._maxKey]),this.inAnyRange(t,{includeLowers:!1,includeUppers:!1})},e.prototype.inAnyRange=function(e,t){var r=this,n=this._cmp,a=this._ascending,s=this._descending,o=this._min,i=this._max;if(0===e.length)return Ft(this);if(!e.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&a(e[0],e[1])<=0})))return Lt(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",re.InvalidArgument);var u=!t||!1!==t.includeLowers,c=t&&!0===t.includeUppers;var l,d=a;function h(e,t){return d(e[0],t[0])}try{(l=e.reduce((function(e,t){for(var r=0,a=e.length;r<a;++r){var s=e[r];if(n(t[0],s[1])<0&&n(t[1],s[0])>0){s[0]=o(s[0],t[0]),s[1]=i(s[1],t[1]);break}}return r===a&&e.push(t),e}),[])).sort(h)}catch(e){return Lt(this,Ct)}var p=0,f=c?function(e){return a(e,l[p][1])>0}:function(e){return a(e,l[p][1])>=0},g=u?function(e){return s(e,l[p][0])>0}:function(e){return s(e,l[p][0])>=0};var m=f,C=new this.Collection(this,(function(){return Kt(l[0][0],l[l.length-1][1],!u,!c)}));return C._ondirectionchange=function(e){"next"===e?(m=f,d=a):(m=g,d=s),l.sort(h)},C._addAlgorithm((function(e,t,n){for(var s=e.key;m(s);)if(++p===l.length)return t(n),!1;return!!function(e){return!f(e)&&!g(e)}(s)||(0===r._cmp(s,l[p][1])||0===r._cmp(s,l[p][0])||t((function(){d===a?e.continue(l[p][0]):e.continue(l[p][1])})),!1)})),C},e.prototype.startsWithAnyOf=function(){var e=F.apply(L,arguments);return e.every((function(e){return"string"==typeof e}))?0===e.length?Ft(this):this.inAnyRange(e.map((function(e){return[e,e+mt]}))):Lt(this,"startsWithAnyOf() only works with strings")},e}();function Jt(e){return 1===e.length?e[0]:e}function Xt(e){try{return e.only([[]]),[[]]}catch(e){return mt}}function zt(e){return Ye((function(t){return Wt(t),e(t.target.error),!1}))}function Wt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}var Vt=function(){function e(){}return e.prototype._lock=function(){return S(!De.global),++this._reculock,1!==this._reculock||De.global||(De.lockOwnerFor=this),this},e.prototype._unlock=function(){if(S(!De.global),0==--this._reculock)for(De.global||(De.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{dt(e[1],e[0])}catch(e){}}return this},e.prototype._locked=function(){return this._reculock&&De.lockOwnerFor!==this},e.prototype.create=function(e){var t=this;if(!this.mode)return this;var r=this.db.idbdb,n=this.db._state.dbOpenError;if(S(!this.idbtrans),!e&&!r)switch(n&&n.name){case"DatabaseClosedError":throw new re.DatabaseClosed(n);case"MissingAPIError":throw new re.MissingAPI(n.message,n);default:throw new re.OpenFailed(n)}if(!this.active)throw new re.TransactionInactive;return S(null===this._completion._state),(e=this.idbtrans=e||r.transaction(Jt(this.storeNames),this.mode)).onerror=Ye((function(r){Wt(r),t._reject(e.error)})),e.onabort=Ye((function(r){Wt(r),t.active&&t._reject(new re.Abort(e.error)),t.active=!1,t.on("abort").fire(r)})),e.oncomplete=Ye((function(){t.active=!1,t._resolve()})),this},e.prototype._promise=function(e,t,r){var n=this;if("readwrite"===e&&"readwrite"!==this.mode)return gt(new re.ReadOnly("Transaction is readonly"));if(!this.active)return gt(new re.TransactionInactive);if(this._locked())return new xe((function(a,s){n._blockedFuncs.push([function(){n._promise(e,t,r).then(a,s)},De])}));if(r)return nt((function(){var e=new xe((function(e,r){n._lock();var a=t(e,r,n);a&&a.then&&a.then(e,r)}));return e.finally((function(){return n._unlock()})),e._lib=!0,e}));var a=new xe((function(e,r){var a=t(e,r,n);a&&a.then&&a.then(e,r)}));return a._lib=!0,a},e.prototype._root=function(){return this.parent?this.parent._root():this},e.prototype.waitFor=function(e){var t=this._root(),r=xe.resolve(e);if(t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return r}));else{t._waitingFor=r,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var a=t._waitingFor;return new xe((function(e,n){r.then((function(r){return t._waitingQueue.push(Ye(e.bind(null,r)))}),(function(e){return t._waitingQueue.push(Ye(n.bind(null,e)))})).finally((function(){t._waitingFor===a&&(t._waitingFor=null)}))}))},e.prototype.abort=function(){this.active&&this._reject(new re.Abort),this.active=!1},e.prototype.table=function(e){var t=this._memoizedTables||(this._memoizedTables={});if(d(t,e))return t[e];var r=this.schema[e];if(!r)throw new re.NotFound("Table "+e+" not part of transaction");var n=new this.db.Table(e,r,this);return n.core=this.db.core.table(e),t[e]=n,n},e}();function Yt(e,t,r,n,a,s,o){return{name:e,keyPath:t,unique:r,multi:n,auto:a,compound:s,src:(r&&!o?"&":"")+(n?"*":"")+(a?"++":"")+Qt(t)}}function Qt(e){return"string"==typeof e?e:e?"["+[].join.call(e,"+")+"]":""}function $t(e,t,r){return{name:e,primKey:t,indexes:r,mappedClass:null,idxByName:b(r,(function(e){return[e.name,e]}))}}function Zt(e){return null==e?function(){}:"string"==typeof e?function(e){return 1===e.split(".").length?function(t){return t[e]}:function(t){return T(t,e)}}(e):function(t){return T(t,e)}}function er(e,t){return"delete"===t.type?t.keys:t.keys||t.values.map(e.extractKey)}function tr(e){return[].slice.call(e)}var rr=0;function nr(e){return null==e?":id":"string"==typeof e?e:"["+e.join("+")+"]"}function ar(e,t,r,n){var s=t.cmp.bind(t);function i(e){if(3===e.type)return null;if(4===e.type)throw new Error("Cannot convert never type to IDBKeyRange");var t=e.lower,n=e.upper,a=e.lowerOpen,s=e.upperOpen;return void 0===t?void 0===n?null:r.upperBound(n,!!s):void 0===n?r.lowerBound(t,!!a):r.bound(t,n,!!a,!!s)}var u=function(e,t){var r=tr(e.objectStoreNames);return{schema:{name:e.name,tables:r.map((function(e){return t.objectStore(e)})).map((function(e){var t=e.keyPath,r=e.autoIncrement,n=o(t),a=null==t,s={},i={name:e.name,primaryKey:{name:null,isPrimaryKey:!0,outbound:a,compound:n,keyPath:t,autoIncrement:r,unique:!0,extractKey:Zt(t)},indexes:tr(e.indexNames).map((function(t){return e.index(t)})).map((function(e){var t=e.name,r=e.unique,n=e.multiEntry,a=e.keyPath,i={name:t,compound:o(a),keyPath:a,unique:r,multiEntry:n,extractKey:Zt(a)};return s[nr(a)]=i,i})),getIndexByKeyPath:function(e){return s[nr(e)]}};return s[":id"]=i.primaryKey,null!=t&&(s[nr(t)]=i.primaryKey),i}))},hasGetAll:r.length>0&&"getAll"in t.objectStore(r[0])&&!("undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604)}}(e,n),c=u.schema,l=u.hasGetAll,d=c.tables.map((function(e){return function(e){var t=e.name;return{name:t,schema:e,mutate:function(r){var n=r.trans,s=r.type,o=r.keys,u=r.values,c=r.range,l=r.wantResults;return new Promise((function(r,d){r=Ye(r);var h=n.objectStore(t),p=null==h.keyPath,f="put"===s||"add"===s;if(!f&&"delete"!==s&&"deleteRange"!==s)throw new Error("Invalid operation type: "+s);var g=(o||u||{length:1}).length;if(o&&u&&o.length!==u.length)throw new Error("Given keys array must have same length as given values array.");if(0===g)return r({numFailures:0,failures:{},results:[],lastResult:void 0});var m,C=l&&a(o||er(e.primaryKey,{type:s,keys:o,values:u})),v=[],y=0,S=function(e){++y,Wt(e),C&&(C[e.target._reqno]=void 0),v[e.target._reqno]=e.target.error},_=function(e){var t=e.target;C[t._reqno]=t.result};if("deleteRange"===s){if(4===c.type)return r({numFailures:y,failures:v,results:C,lastResult:void 0});m=3===c.type?h.clear():h.delete(i(c))}else{var b=f?p?[u,o]:[u,null]:[o,null],T=b[0],I=b[1];if(f)for(var R=0;R<g;++R)(m=I&&void 0!==I[R]?h[s](T[R],I[R]):h[s](T[R]))._reqno=R,C&&void 0===C[R]&&(m.onsuccess=_),m.onerror=S;else for(R=0;R<g;++R)(m=h[s](T[R]))._reqno=R,m.onerror=S}var A=function(e){var t=e.target.result;C&&(C[g-1]=t),r({numFailures:y,failures:v,results:C,lastResult:t})};m.onerror=function(e){S(e),A(e)},m.onsuccess=A}))},getMany:function(e){var r=e.trans,n=e.keys;return new Promise((function(e,a){e=Ye(e);for(var s,o=r.objectStore(t),i=n.length,u=new Array(i),c=0,l=0,d=function(t){var r=t.target;null!=(u[r._pos]=r.result)&&0,++l===c&&e(u)},h=zt(a),p=0;p<i;++p){null!=n[p]&&((s=o.get(n[p]))._pos=p,s.onsuccess=d,s.onerror=h,++c)}0===c&&e(u)}))},get:function(e){var r=e.trans,n=e.key;return new Promise((function(e,a){e=Ye(e);var s=r.objectStore(t).get(n);s.onsuccess=function(t){return e(t.target.result)},s.onerror=zt(a)}))},query:function(e){return function(r){return new Promise((function(n,a){n=Ye(n);var s=r.trans,o=r.values,u=r.limit,c=r.query,l=u===1/0?void 0:u,d=c.index,h=c.range,p=s.objectStore(t),f=d.isPrimaryKey?p:p.index(d.name),g=i(h);if(0===u)return n({result:[]});if(e){var m=o?f.getAll(g,l):f.getAllKeys(g,l);m.onsuccess=function(e){return n({result:e.target.result})},m.onerror=zt(a)}else{var C=0,v=o||!("openKeyCursor"in f)?f.openCursor(g):f.openKeyCursor(g),y=[];v.onsuccess=function(e){var t=v.result;return t?(y.push(o?t.value:t.primaryKey),++C===u?n({result:y}):void t.continue()):n({result:y})},v.onerror=zt(a)}}))}}(l),openCursor:function(e){var r=e.trans,n=e.values,a=e.query,s=e.reverse,o=e.unique;return new Promise((function(e,u){e=Ye(e);var c=a.index,l=a.range,d=r.objectStore(t),h=c.isPrimaryKey?d:d.index(c.name),p=s?o?"prevunique":"prev":o?"nextunique":"next",f=n||!("openKeyCursor"in h)?h.openCursor(i(l),p):h.openKeyCursor(i(l),p);f.onerror=zt(u),f.onsuccess=Ye((function(t){var n=f.result;if(n){n.___id=++rr,n.done=!1;var a=n.continue.bind(n),s=n.continuePrimaryKey;s&&(s=s.bind(n));var o=n.advance.bind(n),i=function(){throw new Error("Cursor not stopped")};n.trans=r,n.stop=n.continue=n.continuePrimaryKey=n.advance=function(){throw new Error("Cursor not started")},n.fail=Ye(u),n.next=function(){var e=this,t=1;return this.start((function(){return t--?e.continue():e.stop()})).then((function(){return e}))},n.start=function(e){var t=new Promise((function(e,t){e=Ye(e),f.onerror=zt(t),n.fail=t,n.stop=function(t){n.stop=n.continue=n.continuePrimaryKey=n.advance=i,e(t)}})),r=function(){if(f.result)try{e()}catch(e){n.fail(e)}else n.done=!0,n.start=function(){throw new Error("Cursor behind last entry")},n.stop()};return f.onsuccess=Ye((function(e){f.onsuccess=r,r()})),n.continue=a,n.continuePrimaryKey=s,n.advance=o,r(),t},e(n)}else e(null)}),u)}))},count:function(e){var r=e.query,n=e.trans,a=r.index,s=r.range;return new Promise((function(e,r){var o=n.objectStore(t),u=a.isPrimaryKey?o:o.index(a.name),c=i(s),l=c?u.count(c):u.count();l.onsuccess=Ye((function(t){return e(t.target.result)})),l.onerror=zt(r)}))}}}(e)})),h={};return d.forEach((function(e){return h[e.name]=e})),{stack:"dbcore",transaction:e.transaction.bind(e),table:function(e){if(!h[e])throw new Error("Table '"+e+"' not found");return h[e]},cmp:s,MIN_KEY:-1/0,MAX_KEY:Xt(r),schema:c}}function sr(e,t,r,a){var s=r.IDBKeyRange;return{dbcore:function(e,t){return t.reduce((function(e,t){var r=t.create;return n(n({},e),r(e))}),e)}(ar(t,r.indexedDB,s,a),e.dbcore)}}function or(e,t){var r=t.db,n=sr(e._middlewares,r,e._deps,t);e.core=n.dbcore,e.tables.forEach((function(t){var r=t.name;e.core.schema.tables.some((function(e){return e.name===r}))&&(t.core=e.core.table(r),e[r]instanceof e.Table&&(e[r].core=t.core))}))}function ir(e,t,r,n){r.forEach((function(r){var a=n[r];t.forEach((function(t){r in t||(t===e.Transaction.prototype||t instanceof e.Transaction?f(t,r,{get:function(){return this.table(r)},set:function(e){p(this,r,{value:e,writable:!0,configurable:!0,enumerable:!0})}}):t[r]=new e.Table(r,a))}))}))}function ur(e,t){t.forEach((function(t){for(var r in t)t[r]instanceof e.Table&&delete t[r]}))}function cr(e,t){return e._cfg.version-t._cfg.version}function lr(e,t,r,n){var a=e._dbSchema,o=e._createTransaction("readwrite",e._storeNames,a);o.create(r),o._completion.catch(n);var i=o._reject.bind(o),u=De.transless||De;nt((function(){De.trans=o,De.transless=u,0===t?(s(a).forEach((function(e){dr(r,e,a[e].primKey,a[e].indexes)})),or(e,r),xe.follow((function(){return e.on.populate.fire(o)})).catch(i)):function(e,t,r,n){var a=[],o=e._versions,i=e._dbSchema=pr(e,e.idbdb,n),u=!1;function c(){return a.length?xe.resolve(a.shift()(r.idbtrans)).then(c):xe.resolve()}return o.filter((function(e){return e._cfg.version>=t})).forEach((function(o){a.push((function(){var a=i,c=o._cfg.dbschema;fr(e,a,n),fr(e,c,n),i=e._dbSchema=c;var l=function(e,t){var r,n={del:[],add:[],change:[]};for(r in e)t[r]||n.del.push(r);for(r in t){var a=e[r],s=t[r];if(a){var o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(a.primKey.src===s.primKey.src||yt){var i=a.idxByName,u=s.idxByName,c=void 0;for(c in i)u[c]||o.del.push(c);for(c in u){var l=i[c],d=u[c];l?l.src!==d.src&&o.change.push(d):o.add.push(d)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}else o.recreate=!0,n.change.push(o)}else n.add.push([r,s])}return n}(a,c);l.add.forEach((function(e){dr(n,e[0],e[1].primKey,e[1].indexes)})),l.change.forEach((function(e){if(e.recreate)throw new re.Upgrade("Not yet support for changing primary key");var t=n.objectStore(e.name);e.add.forEach((function(e){return hr(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),hr(t,e)})),e.del.forEach((function(e){return t.deleteIndex(e)}))}));var d=o._cfg.contentUpgrade;if(d&&o._cfg.version>t){or(e,n),u=!0;var h=R(c);l.del.forEach((function(e){h[e]=a[e]})),ur(e,[e.Transaction.prototype]),ir(e,[e.Transaction.prototype],s(h),h),r.schema=h;var p,f=N(d);f&&at();var g=xe.follow((function(){if((p=d(r))&&f){var e=st.bind(null,null);p.then(e,e)}}));return p&&"function"==typeof p.then?xe.resolve(p):g.then((function(){return p}))}})),a.push((function(t){u&&St||function(e,t){for(var r=0;r<t.db.objectStoreNames.length;++r){var n=t.db.objectStoreNames[r];null==e[n]&&t.db.deleteObjectStore(n)}}(o._cfg.dbschema,t);ur(e,[e.Transaction.prototype]),ir(e,[e.Transaction.prototype],e._storeNames,e._dbSchema),r.schema=e._dbSchema}))})),c().then((function(){var e,t;t=n,s(e=i).forEach((function(r){t.db.objectStoreNames.contains(r)||dr(t,r,e[r].primKey,e[r].indexes)}))}))}(e,t,o,r).catch(i)}))}function dr(e,t,r,n){var a=e.db.createObjectStore(t,r.keyPath?{keyPath:r.keyPath,autoIncrement:r.auto}:{autoIncrement:r.auto});return n.forEach((function(e){return hr(a,e)})),a}function hr(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function pr(e,t,r){var n={};return v(t.objectStoreNames,0).forEach((function(e){for(var t=r.objectStore(e),a=t.keyPath,s=Yt(Qt(a),a||"",!1,!1,!!t.autoIncrement,a&&"string"!=typeof a,!0),o=[],i=0;i<t.indexNames.length;++i){var u=t.index(t.indexNames[i]);a=u.keyPath;var c=Yt(u.name,a,!!u.unique,!!u.multiEntry,!1,a&&"string"!=typeof a,!1);o.push(c)}n[e]=$t(e,s,o)})),n}function fr(e,t,r){for(var n=r.db.objectStoreNames,a=0;a<n.length;++a){var s=n[a],o=r.objectStore(s);e._hasGetAll="getAll"in o;for(var u=0;u<o.indexNames.length;++u){var c=o.indexNames[u],l=o.index(c).keyPath,d="string"==typeof l?l:"["+v(l).join("+")+"]";if(t[s]){var h=t[s].idxByName[d];h&&(h.name=c,delete t[s].idxByName[d],t[s].idxByName[c]=h)}}}"undefined"!=typeof navigator&&/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&i.WorkerGlobalScope&&i instanceof i.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(e._hasGetAll=!1)}var gr,mr=function(){function e(){}return e.prototype._parseStoresSpec=function(e,t){s(e).forEach((function(r){if(null!==e[r]){var n=e[r].split(",").map((function(e,t){var r=(e=e.trim()).replace(/([&*]|\+\+)/g,""),n=/^\[/.test(r)?r.match(/^\[(.*)\]$/)[1].split("+"):r;return Yt(r,n||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),o(n),0===t)})),a=n.shift();if(a.multi)throw new re.Schema("Primary key cannot be multi-valued");n.forEach((function(e){if(e.auto)throw new re.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new re.Schema("Index must have a name and cannot be an empty string")})),t[r]=$t(r,a,n)}}))},e.prototype.stores=function(e){var t=this.db;this._cfg.storesSource=this._cfg.storesSource?u(this._cfg.storesSource,e):e;var r=t._versions,n={},a={};return r.forEach((function(e){u(n,e._cfg.storesSource),a=e._cfg.dbschema={},e._parseStoresSpec(n,a)})),t._dbSchema=a,ur(t,[t._allTables,t,t.Transaction.prototype]),ir(t,[t._allTables,t,t.Transaction.prototype,this._cfg.tables],s(a),a),t._storeNames=s(a),this},e.prototype.upgrade=function(e){return this._cfg.contentUpgrade=e,this},e}();function Cr(e){return nt((function(){return De.letThrough=!0,e()}))}function vr(e){var t=e._state,r=e._deps.indexedDB;if(t.isBeingOpened||e.idbdb)return t.dbReadyPromise.then((function(){return t.dbOpenError?gt(t.dbOpenError):e}));j&&(t.openCanceller._stackHolder=J()),t.isBeingOpened=!0,t.dbOpenError=null,t.openComplete=!1;var n=t.dbReadyResolve,a=null;return xe.race([t.openCanceller,new xe((function(n,o){if(!r)throw new re.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var i=e.name,u=t.autoSchema?r.open(i):r.open(i,Math.round(10*e.verno));if(!u)throw new re.MissingAPI("IndexedDB API not available");u.onerror=zt(o),u.onblocked=Ye(e._fireOnBlocked),u.onupgradeneeded=Ye((function(n){if(a=u.transaction,t.autoSchema&&!e._options.allowEmptyDB){u.onerror=Wt,a.abort(),u.result.close();var s=r.deleteDatabase(i);s.onsuccess=s.onerror=Ye((function(){o(new re.NoSuchDatabase("Database "+i+" doesnt exist"))}))}else{a.onerror=zt(o);var c=n.oldVersion>Math.pow(2,62)?0:n.oldVersion;e.idbdb=u.result,lr(e,c/10,a,o)}}),o),u.onsuccess=Ye((function(){a=null;var r=e.idbdb=u.result,o=v(r.objectStoreNames);if(o.length>0)try{var c=r.transaction(Jt(o),"readonly");t.autoSchema?function(e,t,r){e.verno=t.version/10;var n=e._dbSchema=pr(0,t,r);e._storeNames=v(t.objectStoreNames,0),ir(e,[e._allTables],s(n),n)}(e,r,c):fr(e,e._dbSchema,c),or(e,c)}catch(e){}vt.push(e),r.onversionchange=Ye((function(r){t.vcFired=!0,e.on("versionchange").fire(r)})),gr.add(i),n()}),o)}))]).then((function(){return t.onReadyBeingFired=[],xe.resolve(Cr(e.on.ready.fire)).then((function e(){if(t.onReadyBeingFired.length>0){var r=t.onReadyBeingFired.reduce(pe,se);return t.onReadyBeingFired=[],xe.resolve(Cr(r)).then(e)}}))})).finally((function(){t.onReadyBeingFired=null})).then((function(){return t.isBeingOpened=!1,e})).catch((function(r){try{a&&a.abort()}catch(e){}return t.isBeingOpened=!1,e.close(),t.dbOpenError=r,gt(t.dbOpenError)})).finally((function(){t.openComplete=!0,n()}))}function yr(e){var t=function(t){return e.next(t)},r=a(t),n=a((function(t){return e.throw(t)}));function a(e){return function(t){var a=e(t),s=a.value;return a.done?s:s&&"function"==typeof s.then?s.then(r,n):o(s)?Promise.all(s).then(r,n):r(s)}}return a(t)()}function Sr(e,t,r){var n=arguments.length;if(n<2)throw new re.InvalidArgument("Too few arguments");for(var a=new Array(n-1);--n;)a[n-1]=arguments[n];r=a.pop();var s=E(a);return[e,s,r]}function _r(e,t,r,n,a){return xe.resolve().then((function(){var s=De.transless||De,o=e._createTransaction(t,r,e._dbSchema,n),i={trans:o,transless:s};n?o.idbtrans=n.idbtrans:o.create();var u,c=N(a);c&&at();var l=xe.follow((function(){if(u=a.call(o,o))if(c){var e=st.bind(null,null);u.then(e,e)}else"function"==typeof u.next&&"function"==typeof u.throw&&(u=yr(u))}),i);return(u&&"function"==typeof u.then?xe.resolve(u).then((function(e){return o.active?e:gt(new re.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return u}))).then((function(e){return n&&o._resolve(),o._completion.then((function(){return e}))})).catch((function(e){return o._reject(e),gt(e)}))}))}function br(e,t,r){for(var n=o(e)?e.slice():[e],a=0;a<r;++a)n.push(t);return n}var Tr={stack:"dbcore",name:"VirtualIndexMiddleware",level:1,create:function(e){return n(n({},e),{table:function(t){var r=e.table(t),a=r.schema,s={},o=[];function i(e,t,r){var a=nr(e),u=s[a]=s[a]||[],c=null==e?0:"string"==typeof e?1:e.length,l=t>0,d=n(n({},r),{isVirtual:l,isPrimaryKey:!l&&r.isPrimaryKey,keyTail:t,keyLength:c,extractKey:Zt(e),unique:!l&&r.unique});(u.push(d),d.isPrimaryKey||o.push(d),c>1)&&i(2===c?e[0]:e.slice(0,c-1),t+1,r);return u.sort((function(e,t){return e.keyTail-t.keyTail})),d}var u=i(a.primaryKey.keyPath,0,a.primaryKey);s[":id"]=[u];for(var c=0,l=a.indexes;c<l.length;c++){var d=l[c];i(d.keyPath,0,d)}function h(t){var r,a,s=t.query.index;return s.isVirtual?n(n({},t),{query:{index:s,range:(r=t.query.range,a=s.keyTail,{type:1===r.type?2:r.type,lower:br(r.lower,r.lowerOpen?e.MAX_KEY:e.MIN_KEY,a),lowerOpen:!0,upper:br(r.upper,r.upperOpen?e.MIN_KEY:e.MAX_KEY,a),upperOpen:!0})}}):t}return n(n({},r),{schema:n(n({},a),{primaryKey:u,indexes:o,getIndexByKeyPath:function(e){var t=s[nr(e)];return t&&t[0]}}),count:function(e){return r.count(h(e))},query:function(e){return r.query(h(e))},openCursor:function(t){var n=t.query.index,a=n.keyTail,s=n.isVirtual,o=n.keyLength;if(!s)return r.openCursor(t);return r.openCursor(h(t)).then((function(r){return r&&function(r){return Object.create(r,{continue:{value:function(n){null!=n?r.continue(br(n,t.reverse?e.MAX_KEY:e.MIN_KEY,a)):t.unique?r.continue(br(r.key,t.reverse?e.MIN_KEY:e.MAX_KEY,a)):r.continue()}},continuePrimaryKey:{value:function(t,n){r.continuePrimaryKey(br(t,e.MAX_KEY,a),n)}},key:{get:function(){var e=r.key;return 1===o?e[0]:e.slice(0,o)}},value:{get:function(){return r.value}}})}(r)}))}})}})}},Ir={stack:"dbcore",name:"HooksMiddleware",level:2,create:function(e){return n(n({},e),{table:function(t){var r=e.table(t),s=r.schema.primaryKey;return n(n({},r),{mutate:function(e){var o=De.trans,i=o.table(t).hook,u=i.deleting,c=i.creating,l=i.updating;switch(e.type){case"add":if(c.fire===se)break;return o._promise("readwrite",(function(){return d(e)}),!0);case"put":if(c.fire===se&&l.fire===se)break;return o._promise("readwrite",(function(){return d(e)}),!0);case"delete":if(u.fire===se)break;return o._promise("readwrite",(function(){return d(e)}),!0);case"deleteRange":if(u.fire===se)break;return o._promise("readwrite",(function(){return function(e){return function e(t,a,o){return r.query({trans:t,values:!1,query:{index:s,range:a},limit:o}).then((function(r){var s=r.result;return d({type:"delete",keys:s,trans:t}).then((function(r){return r.numFailures>0?Promise.reject(r.failures[0]):s.length<o?{failures:[],numFailures:0,lastResult:void 0}:e(t,n(n({},a),{lower:s[s.length-1],lowerOpen:!0}),o)}))}))}(e.trans,e.range,1e4)}(e)}),!0)}return r.mutate(e);function d(e){var t=De.trans,o=e.keys||er(s,e);if(!o)throw new Error("Keys missing");return"delete"!==(e="add"===e.type||"put"===e.type?n(n({},e),{keys:o,wantResults:!0}):n({},e)).type&&(e.values=a(e.values)),e.keys&&(e.keys=a(e.keys)),function(e,t,r){return"add"===t.type?Promise.resolve(new Array(t.values.length)):e.getMany({trans:t.trans,keys:r})}(r,e,o).then((function(n){var a=o.map((function(r,a){var o=n[a],i={onerror:null,onsuccess:null};if("delete"===e.type)u.fire.call(i,r,o,t);else if("add"===e.type||void 0===o){var d=c.fire.call(i,r,e.values[a],t);null==r&&null!=d&&(r=d,e.keys[a]=r,s.outbound||I(e.values[a],s.keyPath,r))}else{var h=P(o,e.values[a]),p=l.fire.call(i,h,r,o,t);if(p){var f=e.values[a];Object.keys(p).forEach((function(e){I(f,e,p[e])}))}}return i}));return r.mutate(e).then((function(t){for(var r=t.failures,s=t.results,i=t.numFailures,u=t.lastResult,c=0;c<o.length;++c){var l=s?s[c]:o[c],d=a[c];null==l?d.onerror&&d.onerror(r[c]):d.onsuccess&&d.onsuccess("put"===e.type&&n[c]?e.values[c]:l)}return{failures:r,results:s,numFailures:i,lastResult:u}})).catch((function(e){return a.forEach((function(t){return t.onerror&&t.onerror(e)})),Promise.reject(e)}))}))}}})}})}},Rr=function(){function e(t,r){var a=this;this._middlewares={},this.verno=0;var s=e.dependencies;this._options=r=n({addons:e.addons,autoOpen:!0,indexedDB:s.indexedDB,IDBKeyRange:s.IDBKeyRange},r),this._deps={indexedDB:r.indexedDB,IDBKeyRange:r.IDBKeyRange};var o=r.addons;this._dbSchema={},this._versions=[],this._storeNames=[],this._allTables={},this.idbdb=null;var i,u={dbOpenError:null,isBeingOpened:!1,onReadyBeingFired:null,openComplete:!1,dbReadyResolve:se,dbReadyPromise:null,cancelOpen:se,openCanceller:null,autoSchema:!0};u.dbReadyPromise=new xe((function(e){u.dbReadyResolve=e})),u.openCanceller=new xe((function(e,t){u.cancelOpen=t})),this._state=u,this.name=t,this.on=At(this,"populate","blocked","versionchange",{ready:[pe,se]}),this.on.ready.subscribe=y(this.on.ready.subscribe,(function(t){return function(r,n){e.vip((function(){var e=a._state;if(e.openComplete)e.dbOpenError||xe.resolve().then(r),n&&t(r);else if(e.onReadyBeingFired)e.onReadyBeingFired.push(r),n&&t(r);else{t(r);var s=a;n||t((function e(){s.on.ready.unsubscribe(r),s.on.ready.unsubscribe(e)}))}}))}})),this.Collection=(i=this,Et(Pt.prototype,(function(e,t){this.db=i;var r=It,n=null;if(t)try{r=t()}catch(e){n=e}var a=e._ctx,s=a.table,o=s.hook.reading.fire;this._ctx={table:s,index:a.index,isPrimKey:!a.index||s.schema.primKey.keyPath&&a.index===s.schema.primKey.name,range:r,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:n,or:a.or,valueMapper:o!==oe?o:null}}))),this.Table=function(e){return Et(Rt.prototype,(function(t,r,n){this.db=e,this._tx=n,this.name=t,this.schema=r,this.hook=e._allTables[t]?e._allTables[t].hook:At(null,{creating:[ce,se],reading:[ie,oe],updating:[de,se],deleting:[le,se]})}))}(this),this.Transaction=function(e){return Et(Vt.prototype,(function(t,r,n,a){var s=this;this.db=e,this.mode=t,this.storeNames=r,this.schema=n,this.idbtrans=null,this.on=At(this,"complete","error","abort"),this.parent=a||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new xe((function(e,t){s._resolve=e,s._reject=t})),this._completion.then((function(){s.active=!1,s.on.complete.fire()}),(function(e){var t=s.active;return s.active=!1,s.on.error.fire(e),s.parent?s.parent._reject(e):t&&s.idbtrans&&s.idbtrans.abort(),gt(e)}))}))}(this),this.Version=function(e){return Et(mr.prototype,(function(t){this.db=e,this._cfg={version:t,storesSource:null,dbschema:{},tables:{},contentUpgrade:null}}))}(this),this.WhereClause=function(e){return Et(qt.prototype,(function(t,r,n){this.db=e,this._ctx={table:t,index:":id"===r?null:r,or:n};var a=e._deps.indexedDB;if(!a)throw new re.MissingAPI("indexedDB API missing");this._cmp=this._ascending=a.cmp.bind(a),this._descending=function(e,t){return a.cmp(t,e)},this._max=function(e,t){return a.cmp(e,t)>0?e:t},this._min=function(e,t){return a.cmp(e,t)<0?e:t},this._IDBKeyRange=e._deps.IDBKeyRange}))}(this),this.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+a.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+a.name+"'. Closing db now to resume the delete request."),a.close()})),this.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+a.name+"') was blocked"):console.warn("Upgrade '"+a.name+"' blocked by other connection holding version "+e.oldVersion/10)})),this._maxKey=Xt(r.IDBKeyRange),this._createTransaction=function(e,t,r,n){return new a.Transaction(e,t,r,n)},this._fireOnBlocked=function(e){a.on("blocked").fire(e),vt.filter((function(e){return e.name===a.name&&e!==a&&!e._state.vcFired})).map((function(t){return t.on("versionchange").fire(e)}))},this.use(Tr),this.use(Ir),o.forEach((function(e){return e(a)}))}return e.prototype.version=function(e){if(isNaN(e)||e<.1)throw new re.Type("Given version is not a positive number");if(e=Math.round(10*e)/10,this.idbdb||this._state.isBeingOpened)throw new re.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=this._versions,r=t.filter((function(t){return t._cfg.version===e}))[0];return r||(r=new this.Version(e),t.push(r),t.sort(cr),r.stores({}),this._state.autoSchema=!1,r)},e.prototype._whenReady=function(e){var t=this;return this._state.openComplete||De.letThrough?e():new xe((function(e,r){if(!t._state.isBeingOpened){if(!t._options.autoOpen)return void r(new re.DatabaseClosed);t.open().catch(se)}t._state.dbReadyPromise.then(e,r)})).then(e)},e.prototype.use=function(e){var t=e.stack,r=e.create,n=e.level,a=e.name;a&&this.unuse({stack:t,name:a});var s=this._middlewares[t]||(this._middlewares[t]=[]);return s.push({stack:t,create:r,level:null==n?10:n,name:a}),s.sort((function(e,t){return e.level-t.level})),this},e.prototype.unuse=function(e){var t=e.stack,r=e.name,n=e.create;return t&&this._middlewares[t]&&(this._middlewares[t]=this._middlewares[t].filter((function(e){return n?e.create!==n:!!r&&e.name!==r}))),this},e.prototype.open=function(){return vr(this)},e.prototype.close=function(){var e=vt.indexOf(this),t=this._state;if(e>=0&&vt.splice(e,1),this.idbdb){try{this.idbdb.close()}catch(e){}this.idbdb=null}this._options.autoOpen=!1,t.dbOpenError=new re.DatabaseClosed,t.isBeingOpened&&t.cancelOpen(t.dbOpenError),t.dbReadyPromise=new xe((function(e){t.dbReadyResolve=e})),t.openCanceller=new xe((function(e,r){t.cancelOpen=r}))},e.prototype.delete=function(){var e=this,t=arguments.length>0,r=this._state;return new xe((function(n,a){var s=function(){e.close();var t=e._deps.indexedDB.deleteDatabase(e.name);t.onsuccess=Ye((function(){gr.remove(e.name),n()})),t.onerror=zt(a),t.onblocked=e._fireOnBlocked};if(t)throw new re.InvalidArgument("Arguments not allowed in db.delete()");r.isBeingOpened?r.dbReadyPromise.then(s):s()}))},e.prototype.backendDB=function(){return this.idbdb},e.prototype.isOpen=function(){return null!==this.idbdb},e.prototype.hasBeenClosed=function(){var e=this._state.dbOpenError;return e&&"DatabaseClosed"===e.name},e.prototype.hasFailed=function(){return null!==this._state.dbOpenError},e.prototype.dynamicallyOpened=function(){return this._state.autoSchema},Object.defineProperty(e.prototype,"tables",{get:function(){var e=this;return s(this._allTables).map((function(t){return e._allTables[t]}))},enumerable:!0,configurable:!0}),e.prototype.transaction=function(){var e=Sr.apply(this,arguments);return this._transaction.apply(this,e)},e.prototype._transaction=function(e,t,r){var n=this,a=De.trans;a&&a.db===this&&-1===e.indexOf("!")||(a=null);var s,o,i=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{if(o=t.map((function(e){var t=e instanceof n.Table?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t})),"r"==e||"readonly"===e)s="readonly";else{if("rw"!=e&&"readwrite"!=e)throw new re.InvalidArgument("Invalid transaction mode: "+e);s="readwrite"}if(a){if("readonly"===a.mode&&"readwrite"===s){if(!i)throw new re.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");a=null}a&&o.forEach((function(e){if(a&&-1===a.storeNames.indexOf(e)){if(!i)throw new re.SubTransaction("Table "+e+" not included in parent transaction.");a=null}})),i&&a&&!a.active&&(a=null)}}catch(e){return a?a._promise(null,(function(t,r){r(e)})):gt(e)}var u=_r.bind(null,this,s,o,a,r);return a?a._promise(s,u,"lock"):De.trans?dt(De.transless,(function(){return n._whenReady(u)})):this._whenReady(u)},e.prototype.table=function(e){if(!d(this._allTables,e))throw new re.InvalidTable("Table "+e+" does not exist");return this._allTables[e]},e}(),Ar=Rr;h(Ar,n(n({},ae),{delete:function(e){return new Ar(e).delete()},exists:function(e){return new Ar(e,{addons:[]}).open().then((function(e){return e.close(),!0})).catch("NoSuchDatabaseError",(function(){return!1}))},getDatabaseNames:function(e){return gr?gr.getDatabaseNames().then(e):xe.resolve([])},defineClass:function(){return function(e){u(this,e)}},ignoreTransaction:function(e){return De.trans?dt(De.transless,e):e()},vip:Cr,async:function(e){return function(){try{var t=yr(e.apply(this,arguments));return t&&"function"==typeof t.then?t:xe.resolve(t)}catch(e){return gt(e)}}},spawn:function(e,t,r){try{var n=yr(e.apply(r,t||[]));return n&&"function"==typeof n.then?n:xe.resolve(n)}catch(e){return gt(e)}},currentTransaction:{get:function(){return De.trans||null}},waitFor:function(e,t){var r=xe.resolve("function"==typeof e?Ar.ignoreTransaction(e):e).timeout(t||6e4);return De.trans?De.trans.waitFor(r):r},Promise:xe,debug:{get:function(){return j},set:function(e){K(e,"dexie"===e?function(){return!0}:bt)}},derive:g,extend:u,props:h,override:y,Events:At,getByKeyPath:T,setByKeyPath:I,delByKeyPath:function(e,t){"string"==typeof t?I(e,t,void 0):"length"in t&&[].map.call(t,(function(t){I(e,t,void 0)}))},shallowClone:R,deepClone:k,getObjectDiff:P,asap:_,minKey:-1/0,addons:[],connections:vt,errnames:ee,dependencies:function(){try{return{indexedDB:i.indexedDB||i.mozIndexedDB||i.webkitIndexedDB||i.msIndexedDB,IDBKeyRange:i.IDBKeyRange||i.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:"3.0.1",version:"3.0.1".split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,r){return e+t/Math.pow(10,2*r)})),default:Ar,Dexie:Ar})),Ar.maxKey=Xt(Ar.dependencies.IDBKeyRange),function(e){try{gr=function(e){var t,r=e&&"function"==typeof e.databases;if(!r){var n=new Rr("__dbnames",{addons:[]});n.version(1).stores({dbnames:"name"}),t=n.table("dbnames")}return{getDatabaseNames:function(){return r?xe.resolve(e.databases()).then((function(e){return e.map((function(e){return e.name})).filter((function(e){return"__dbnames"!==e}))})):t.toCollection().primaryKeys()},add:function(e){return!r&&"__dbnames"!==e&&t.put({name:e}).catch(se)},remove:function(e){return!r&&"__dbnames"!==e&&t.delete(e).catch(se)}}}(e)}catch(e){}}(Rr.dependencies.indexedDB),xe.rejectionMapper=function(e,t){if(!e||e instanceof Y||e instanceof TypeError||e instanceof SyntaxError||!e.name||!ne[e.name])return e;var r=new ne[e.name](t||e.message,e);return"stack"in e&&f(r,"stack",{get:function(){return this.inner.stack}}),r},K(j,bt),t.default=Rr},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ThreadHelper=void 0;const n=r(10),a=r(4);class s{static get_AllThreadHistory(){if(null!=this.threadHistory)return this.threadHistory;{let e=a.ConfigHelper.get_Config();new n.ChatApiService(e).GetThreadHistory("","","",!0).then(e=>{if(200==e.status&&e.data.success)return this.threadHistory=e.data.result,this.threadHistory}).catch(e=>{console.log(e)})}}static Transform_ThreadHistoryAPI_Result_To_ThreadSDKResult(e){let t={threadId:e.threadId,tenantId:e.tenantId,threadType:e.threadType,createdAt:e.createdAt,participants:[]},r=e.participants;for(let e=0;e<r.length;e++){const a=r[e];var n={ertcId:a.eRTCUserId,UserChatId:a.appUserId};t.participants.push(n)}if("single"==t.threadType){n={ertcId:e.user.eRTCUserId,UserChatId:e.user.appUserId,name:e.user.name};t.user=n}else t.group={groupId:e.group.groupId,name:e.group.name,groupPic:e.group.profilePic,groupThumb:e.group.profilePicThumb,freeze:null!=e.group.freeze&&e.group.freeze.enabled};return t}static Transform_ThreadResultAPI_Result_To_ThreadSDKResult(e){let t={threadId:e.threadId,tenantId:e.tenantId,threadType:e.threadType,createdAt:e.createdAt,participants:[]},r=e.participants;for(let e=0;e<r.length;e++){var n={ertcId:r[e].user};t.participants.push(n)}return t}}t.ThreadHelper=s,s.threadHistory=null},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatModule=void 0;const n=r(14);t.ChatModule=class{constructor(){}createThread(e){return(new n.ChatModuleImp).createThread(e)}getThread(e){return(new n.ChatModuleImp).getThread(e)}sendMessage(e,t){return(new n.ChatModuleImp).sendMessage(e,t)}sendMultipleMessages(e){return(new n.ChatModuleImp).sendMultipleMessages(e)}blockUnblockUser(e,t){return(new n.ChatModuleImp).blockUnblockUser(e,t)}InitializeQueue(){return(new n.ChatModuleImp).InitializeQueue()}msgReadStatus(e,t){return(new n.ChatModuleImp).msgReadStatus(e,t)}getMessages(e){return(new n.ChatModuleImp).getMessages(e)}markAsFavorite(e,t){return(new n.ChatModuleImp).markAsFavorite(e,t)}getAllFavoriteMessages(e){return(new n.ChatModuleImp).getAllFavoriteMessages(e)}getAllFavoriteMessagesByThreadId(e){return(new n.ChatModuleImp).getAllFavoriteMessagesByThreadId(e)}sendReaction(e,t){return(new n.ChatModuleImp).sendReaction(e,t)}deleteChat(e){return(new n.ChatModuleImp).deleteChat(e)}messageHistory(e){return(new n.ChatModuleImp).chatHistory(e)}FollowThreads(e){return(new n.ChatModuleImp).FollowThreads(e)}searchMessageHistory(e,t,r,a,s){return(new n.ChatModuleImp).searchMessageHistory(e,t,r,a,s)}searchLocalMessageHistory(e,t){return(new n.ChatModuleImp).searchLocalMessageHistory(e,t)}updateMessage(e){return(new n.ChatModuleImp).updateMessage(e)}threadHistory(e,t,r,a){return(new n.ChatModuleImp).threadHistory(e,t,r,a)}chatSettings(){return(new n.ChatModuleImp).chatSettings()}LoginIntoChatServer(e){return(new n.ChatModuleImp).LoginIntoChatServer(e)}getMessageFromLocalStorage(e){return(new n.ChatModuleImp).getMessageFromLocalStorage(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FCMModule=void 0;const n=r(59);t.FCMModule=class{constructor(){}onMessageReceived(e){(new n.FCMModuleImp).onMessageReceived(e)}clearNotification(e){(new n.FCMModuleImp).clearNotification(e)}registerFCMToServer(e,t){(new n.FCMModuleImp).registerFCMToServer(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.FCMModuleImp=void 0;const n=r(2),a=r(0),s=r(14),o=r(29);t.FCMModuleImp=class{constructor(){this.sdkconfig=null}onMessageReceived(e){try{let t,r;if(null!=e&&null!=e.data&&null!=e.data.eventType&&null!=e.data.message)t=e.data.eventType,r=e.data.message;else if(null!=e&&null!=e.data&&null!=e.data.firebaseMessagingData&&null!=e.data.firebaseMessagingData.data&&null!=e.data.firebaseMessagingData.data.eventType&&null!=e.data.firebaseMessagingData.data.message)t=e.data.firebaseMessagingData.data.eventType,r=e.data.firebaseMessagingData.data.message;else{if(null==e||null==e.data||null==e.data.data||null==e.data.data.eventType||null==e.data.data.message)return;t=e.data.data.eventType,r=e.data.data.message}if(t.includes("userDbUpdated"))o.FCMMqttCommonImp.processUserDBUpdated();else if(t.includes("tenantConfigUpdated"))o.FCMMqttCommonImp.processTenantConfigModified();else if("chat"==t){let e=JSON.parse(r);o.FCMMqttCommonImp.processChatMessages(e)}else if(t.includes("msgReadStatus")){let e=JSON.parse(r);o.FCMMqttCommonImp.processMsgReadStatus(e)}else if(t.includes("groupUpdated")){let e=JSON.parse(r);o.FCMMqttCommonImp.processGroupUpdate(e)}else if(t.includes(a.CommonConstants.CHAT_REACTION)){let e=JSON.parse(r);o.FCMMqttCommonImp.processChatReaction(e)}else if(t.includes(a.CommonConstants.CHAT_UPDATED)){let e=JSON.parse(r);o.FCMMqttCommonImp.processChatUpdated(e)}else if(t.includes(a.CommonConstants.USER_SELF_UPDATE)){let e=JSON.parse(r);o.FCMMqttCommonImp.processUserSelfUpdate(e)}else if(t.includes("announcement")){let e=JSON.parse(r);o.FCMMqttCommonImp.processAnnouncements(e)}else if(t.includes("chatSettingUpdated")){let e=JSON.parse(r);o.FCMMqttCommonImp.processChatSettingUpdated(e)}else if(t.includes("chatReportUpdated")){let e=JSON.parse(r);o.FCMMqttCommonImp.processChatReportUpdated(e)}}catch(e){console.log(e)}}clearNotification(e){}registerFCMToServer(e,t){try{n.LocalStorageHelper.get_ObjectToken(a.CommonConstants.JSSDKFCMAccessToken)!=e&&(n.LocalStorageHelper.set_ObjectToken(a.CommonConstants.JSSDKFCMAccessToken,e),(new s.ChatModuleImp).LoginIntoChatServer(t).then(e=>{}).catch(e=>{console.log(e)}))}catch(e){console.log(e)}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupChatModule=void 0;const n=r(61);t.GroupChatModule=class{constructor(){}getGroups(){return(new n.GroupChatModuleImp).getGroups()}getGroupById(e){return(new n.GroupChatModuleImp).getGroupById(e)}createGroup(e,t){return null!=t?(new n.GroupChatModuleImp).createGroupWithImage(e,t):(new n.GroupChatModuleImp).createGroup(e)}updateGroup(e,t,r,a,s){return(new n.GroupChatModuleImp).updateGroup(e,t,r,a,s)}addParticipants(e,t){return(new n.GroupChatModuleImp).addParticipants(e,t)}removeParticipants(e,t){return(new n.GroupChatModuleImp).removeParticipants(e,t)}addAdmin(e,t){return(new n.GroupChatModuleImp).addAdmin(e,t)}removeAdmin(e,t){return(new n.GroupChatModuleImp).removeAdmin(e,t)}exitGroup(e){return(new n.GroupChatModuleImp).exitGroup(e)}removeGroupPic(e){return(new n.GroupChatModuleImp).removeGroupPic(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.GroupChatModuleImp=void 0;const n=r(2),a=r(0),s=r(30),o=r(3),i=r(7),u=r(11),c=r(4);t.GroupChatModuleImp=class{constructor(){this.sdkconfig=null,this.groupChatApiService=null,this.groupChatModuleFeatures=null,this.sdkconfig=c.ConfigHelper.get_Config(),null!=this.sdkconfig?this.groupChatModuleFeatures=new i.GroupModuleFeatures:console.log("Module is not initialized")}getGroups(){return new Promise((e,t)=>{if(this.groupChatModuleFeatures.isSubscriptionAvailable())try{let r=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);if(null!=r&&null!=r&&r.length>0)return void e(r);n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.GetUserGroups().then(r=>{if(200==r.status&&r.data.success){let t=r.data.result.groups,s=[];if(null!=t&&null!=t){let r=[];for(let e=0;e<t.length;e++){const n=t[e];let a=this.groupChatApiService.GetGroupsById(n.groupId);r.push(a)}Promise.all(r).then(t=>{for(let e=0;e<t.length;e++){const r=t[e].data.result;s.push(this.returnUserGroup(r))}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,s),e(s)})}else e(s)}else t(new o.ertcError(r.data.errorCode,r.data.msg))}).catch(e=>{t(e)})}catch(e){t(e)}else t(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.GROUP)))})}getGroupById(e){return new Promise((t,r)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||r(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{let i=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);if(null!=i&&null!=i&&i.length>0){let r=i.filter(t=>t.groupId==e);null!=r&&r.length>0&&t(r[0])}this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.GetGroupsById(e).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result;t(this.returnUserGroup(r))}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}createGroup(e){return new Promise((t,r)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||r(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config();let i=[];for(let t=0;t<e.groupUsers.length;t++){const r=e.groupUsers[t];i.push(r.UserChatId)}let u={description:e.groupDesc,groupType:e.groupType,name:e.name,participants:i};this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.CreateUpdateGroup(u).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,s=this.returnUserGroup(r),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]),o.push(s),n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),t(s)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}createGroupWithImage(e,t){return new Promise((r,i)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||i(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config();let u=[];for(let t=0;t<e.groupUsers.length;t++){const r=e.groupUsers[t];u.push(r.UserChatId)}var l=new FormData;l.append("name",e.name),l.append("groupType",e.groupType),l.append("description",e.groupDesc),l.append("participants",JSON.stringify(u)),null!=t&&l.append("profilePic",t),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.CreateUpdateGroupWithImage(l).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,s=this.returnUserGroup(t),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);o[e]=s}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),r(s)}else i(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{i(e)})}catch(e){i(e)}})}updateGroup(e,t,r,i,l){return new Promise((d,h)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||h(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config();var p=new FormData;p.append("groupId",e),p.append("name",t),p.append("groupType",l),p.append("description",r),null!=i&&p.append("profilePic",i),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.CreateUpdateGroupWithImage(p).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,r=this.returnUserGroup(t),s=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==s&&null==s&&(s=[]);let o=s.filter(e=>e.groupId==r.groupId);if(null!=o&&o.length>0){let e=s.indexOf(o[0]);s[e]=r}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,s),d(r)}else h(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{h(e)})}catch(e){h(e)}})}addParticipants(e,t){return new Promise((r,i)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||i(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.AddParticipants(e,{participants:t}).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,s=this.returnUserGroup(t),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);o[e]=s}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),r(s)}else i(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{i(e)})}catch(e){i(e)}})}removeParticipants(e,t){return new Promise((r,i)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||i(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.RemoveParticipants(e,{participants:t}).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,s=this.returnUserGroup(t),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);e>-1?o[e]=s:o.push(s)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),r(s)}else i(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{i(e)})}catch(e){i(e)}})}addAdmin(e,t){return new Promise((r,i)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||i(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config();let u={targetAppUserId:t};this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.MakeDismissActions(e,"make",u).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,s=this.returnUserGroup(t),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);e>-1?o[e]=s:o.push(s)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),r(s)}else i(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{i(e)})}catch(e){i(e)}})}removeAdmin(e,t){return new Promise((r,i)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||i(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config();let u={targetAppUserId:t};this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.MakeDismissActions(e,"dismiss",u).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result,s=this.returnUserGroup(t),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);e>-1?o[e]=s:o.push(s)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),r(s)}else i(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{i(e)})}catch(e){i(e)}})}exitGroup(e){return new Promise((t,r)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||r(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.RemoveParticipants(e,{participants:[this.sdkconfig.username]}).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,s=this.returnUserGroup(r),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);e>-1&&o.splice(e,1)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),t(s),t(this.returnUserGroup(r))}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}removeGroupPic(e){return new Promise((t,r)=>{this.groupChatModuleFeatures.isSubscriptionAvailable()||r(new o.ertcError("111",u.ModuleConstants.GENERIC_MESSAGE.replace("{PLACEHOLDER}",u.ModuleConstants.CHAT)));try{this.sdkconfig=c.ConfigHelper.get_Config(),this.groupChatApiService=new s.GroupChatApiService(this.sdkconfig),this.groupChatApiService.RemoveProfilePic(e).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,s=this.returnUserGroup(r),o=n.LocalStorageHelper.get_Object(a.CommonConstants.JSSDKUserGroups);null==o&&null==o&&(o=[]);let i=o.filter(e=>e.groupId==s.groupId);if(null!=i&&i.length>0){let e=o.indexOf(i[0]);e>-1?o[e]=s:o.push(s)}n.LocalStorageHelper.RemoveItem(a.CommonConstants.JSSDKUserGroups),n.LocalStorageHelper.set_Object(a.CommonConstants.JSSDKUserGroups,o),t(s)}else r(new o.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}returnUserGroup(e){let t=[];for(let r=0;r<e.participants.length;r++){const n=e.participants[r];let a={ertcId:n.eRTCUserId,role:n.role,UserChatId:n.appUserId,joinedAtDate:n.joinedAtDate};t.push(a)}return{groupId:e.groupId,tenantId:this.sdkconfig.tenantId,threadId:e.threadId,name:e.name,groupType:e.groupType,loginType:a.CommonConstants.LoginType,groupPic:null!=e.profilePic?a.ChatApiConstant.get_mediaUrl(this.sdkconfig,e.profilePic):null,groupThumb:null!=e.profilePicThumb?a.ChatApiConstant.get_mediaUrl(this.sdkconfig,e.profilePicThumb):null,groupDesc:e.description,loginTimestamp:e.createdAt,groupUsers:t,freeze:null!=e.freeze&&e.freeze.enabled,deactivated:!1}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypingModule=void 0;const n=r(63);t.TypingModule=class{constructor(){}typingStatus(e){return(new n.TypingModuleImp).typingStatus(e)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TypingModuleImp=void 0;const n=r(0),a=r(4),s=r(7),o=r(2),i=r(5),u=r(12);t.TypingModuleImp=class{constructor(){}typingStatus(e){try{if((new s.TypingModuleFeatures).isSubscriptionAvailable()&&null!=u.getMqttClient()){let t=a.ConfigHelper.get_Config(),r=i.UserHelper.get_CurrentChatUser(),s=[];if("single"==e.threadType)s.push(e.userId);else{let t=o.LocalStorageHelper.get_Object(n.CommonConstants.JSSDKUserGroups);null==t&&null==t&&(t=[]);let r=t.filter(t=>t.threadId==e.threadId);if(null!=r&&r.length>0)for(let e=0;e<r[0].groupUsers.length;e++){const t=r[0].groupUsers[e];s.push(t.ertcId)}}const c={tenantId:t.tenantId,threadId:e.threadId,participants:s,eRTCUserId:t.eRTCUserId,typingStatusEvent:e.typingStatus,name:r.name};u.TypingStatusOn(c)}}catch(e){}}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatReportModule=void 0;const n=r(65);t.ChatReportModule=class{constructor(){}CreateChatReport(e){return(new n.ChatReportModuleImp).CreateChatReport(e)}UpdateChatReport(e){return(new n.ChatReportModuleImp).UpdateChatReport(e)}DeleteChatReport(e){return(new n.ChatReportModuleImp).DeleteChatReport(e)}ChatReportById(e){return(new n.ChatReportModuleImp).GetChatReportById(e)}ChatReportList(e,t,r,a,s,o){return(new n.ChatReportModuleImp).ChatReportList(e,t,r,a,s,o)}ResolveReport(e,t){return(new n.ChatReportModuleImp).ResolveReport(e,t)}}},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.ChatReportModuleImp=void 0;const n=r(10),a=r(3),s=r(4),o=r(15);class i{constructor(){this.sdkconfig=null,this.chatReportApiService=null,this.sdkconfig=s.ConfigHelper.get_Config(),null!=this.sdkconfig?this.chatReportApiService=new n.ChatReportApiService(this.sdkconfig):console.log("Module is not initialized")}CreateChatReport(e){return new Promise((t,r)=>{try{this.sdkconfig=s.ConfigHelper.get_Config();let n={msgUniqueId:e.chatId,category:e.category};""!=e.reason&&(n.reason=e.reason),this.chatReportApiService.CreateChatReport(n).then(e=>{200==e.status&&e.data.success?t(e.data.result.chatReportId):r(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}UpdateChatReport(e){return new Promise((t,r)=>{try{this.sdkconfig=s.ConfigHelper.get_Config();let n={category:e.category};""!=e.reason&&(n.reason=e.reason),this.chatReportApiService.UpdateChatReport(n,e.chatId).then(e=>{200==e.status&&e.data.success?t(e.data.result.chatReportId):r(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}ResolveReport(e,t){return new Promise((r,n)=>{try{this.chatReportApiService.ResolveChatReport(e,t).then(e=>{200==e.status&&e.data.success?r(e.data.result.message):n(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{n(e)})}catch(e){n(e)}})}DeleteChatReport(e){return new Promise((t,r)=>{try{this.sdkconfig=s.ConfigHelper.get_Config(),this.chatReportApiService.DeleteChatReport(e).then(e=>{200==e.status&&e.data.success?t(!0):r(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}GetChatReportById(e){return new Promise((t,r)=>{try{this.sdkconfig=s.ConfigHelper.get_Config(),this.chatReportApiService.GetChatReportById(e).then(e=>{if(200==e.status&&e.data.success){let r=e.data.result,n=i.MapGlobalContactChatReportFromApiResult(r);t(n)}else r(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{r(e)})}catch(e){r(e)}})}ChatReportList(e,t,r,n,u,c){return new Promise((l,d)=>{try{this.sdkconfig=s.ConfigHelper.get_Config(),this.chatReportApiService.ChatReportList(e,t,r,n,u,c).then(e=>{if(200==e.status&&e.data.success){let t=e.data.result.chatReports,r=[];if(null!=t&&t.length>0)for(let e=0;e<t.length;e++){const n=t[e];let a=i.MapGlobalContactChatReportFromApiResult(n);a.chat=o.TransformHelper.buildMessageRecord(n.chat,n.chat.threadId,null,null),r.push(a)}l(r)}else d(new a.ertcError(e.data.errorCode,e.data.msg))}).catch(e=>{d(e)})}catch(e){d(e)}})}static MapGlobalContactChatReportFromApiResult(e){let t={tenantId:e.tenantId,chatReportId:e.chatReportId,category:e.category,reason:e.reason};t.channelAdminStatus={status:e.channelAdminStatus.status,createdAt:e.channelAdminStatus.createdAt},t.tenantAdminStatus={status:e.tenantAdminStatus.status,createdAt:e.tenantAdminStatus.createdAt};var r={ertcId:e.reporterERTCUser.eRTCUserId,UserChatId:e.reporterERTCUser.appUserId,name:e.reporterERTCUser.name};return t.reporterUser=r,t}}t.ChatReportModuleImp=i},function(e,t,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.eRTCSDK=void 0;const n=r(0),a=r(2);t.eRTCSDK=class{constructor(){}initialise(e){null!=e&&""!=e?a.LocalStorageHelper.set_Object(n.CommonConstants.JSSDKPackageName,e):console.log("Package name is required.")}}}])}));